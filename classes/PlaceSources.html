<!DOCTYPE html>
<html lang="en">
<head>
    <title>PlaceSources</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/panel.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/turbolinks.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/search_index.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../panel/tree.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searchdoc.js" type="text/javascript" charset="utf-8"></script>
<meta name="data-rel-prefix" content="../">
<meta name="data-tree-keys" content='["PlaceSources"]'>


    <meta property="og:title" value="PlaceSources">

  
    
    <meta name="description" content="encoding: utf-8  Just a place to shove some useful data &amp; functionality related to place sources.">
    <meta property="og:description" content="encoding: utf-8  Just a place to shove some useful data &amp; functionality related to place sources.">
  

    <meta name="keywords" content="PlaceSources class, new_place_from_census_shape, new_place_from_esri_world_shape, new_place_from_cpad_units_fee">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Module</span>
            PlaceSources
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/lib/place_sources_rb.html">lib/place_sources.rb</a></li>
            
        </ul>
        
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>encoding: utf-8</p>

<pre><code>Just a place to shove some useful data &amp; functionality related to place
sources.  Note that all source shapefiles must be have a geographic
projection and lat/lon coordinates using a NAD83 / WGS84 datum.  If your
shapefile has a properly defined projection, converting it is pretty simple
with OGR (http://gdal.org/ogr/):
 ogr2ogr -t_srs &quot;+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs&quot; Units_Fee_09_longlat.shp Units_Fee_09.shp
</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new_place_from_census_shape">new_place_from_census_shape</a>,
              </li>
            
              
              <li>
                <a href="#method-c-new_place_from_cpad_units_fee">new_place_from_cpad_units_fee</a>,
              </li>
            
              
              <li>
                <a href="#method-c-new_place_from_esri_world_shape">new_place_from_esri_world_shape</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">FIPS_STATES</td>
            <td>=</td>
            <td class="attr-value">{
&#39;01&#39; =&gt; &#39;Alabama&#39;,
&#39;02&#39; =&gt; &#39;Alaska&#39;,
&#39;04&#39; =&gt; &#39;Arizona&#39;,
&#39;05&#39; =&gt; &#39;Arkansas&#39;,
&#39;06&#39; =&gt; &#39;California&#39;,
&#39;08&#39; =&gt; &#39;Colorado&#39;,
&#39;09&#39; =&gt; &#39;Connecticut&#39;,
&#39;10&#39; =&gt; &#39;Delaware&#39;,
&#39;11&#39; =&gt; &#39;District of Columbia&#39;,
&#39;12&#39; =&gt; &#39;Florida&#39;,
&#39;13&#39; =&gt; &#39;Georgia&#39;,
&#39;15&#39; =&gt; &#39;Hawaii&#39;,
&#39;16&#39; =&gt; &#39;Idaho&#39;,
&#39;17&#39; =&gt; &#39;Illinois&#39;,
&#39;18&#39; =&gt; &#39;Indiana&#39;,
&#39;19&#39; =&gt; &#39;Iowa&#39;,
&#39;20&#39; =&gt; &#39;Kansas&#39;,
&#39;21&#39; =&gt; &#39;Kentucky&#39;,
&#39;22&#39; =&gt; &#39;Louisiana&#39;,
&#39;23&#39; =&gt; &#39;Maine&#39;,
&#39;24&#39; =&gt; &#39;Maryland&#39;,
&#39;25&#39; =&gt; &#39;Massachusetts&#39;,
&#39;26&#39; =&gt; &#39;Michigan&#39;,
&#39;27&#39; =&gt; &#39;Minnesota&#39;,
&#39;28&#39; =&gt; &#39;Mississippi&#39;,
&#39;29&#39; =&gt; &#39;Missouri&#39;,
&#39;30&#39; =&gt; &#39;Montana&#39;,
&#39;31&#39; =&gt; &#39;Nebraska&#39;,
&#39;32&#39; =&gt; &#39;Nevada&#39;,
&#39;33&#39; =&gt; &#39;New Hampshire&#39;,
&#39;34&#39; =&gt; &#39;New Jersey&#39;,
&#39;35&#39; =&gt; &#39;New Mexico&#39;,
&#39;36&#39; =&gt; &#39;New York&#39;,
&#39;37&#39; =&gt; &#39;North Carolina&#39;,
&#39;38&#39; =&gt; &#39;North Dakota&#39;,
&#39;39&#39; =&gt; &#39;Ohio&#39;,
&#39;40&#39; =&gt; &#39;Oklahoma&#39;,
&#39;41&#39; =&gt; &#39;Oregon&#39;,
&#39;42&#39; =&gt; &#39;Pennsylvania&#39;,
&#39;44&#39; =&gt; &#39;Rhode Island&#39;,
&#39;45&#39; =&gt; &#39;South Carolina&#39;,
&#39;46&#39; =&gt; &#39;South Dakota&#39;,
&#39;47&#39; =&gt; &#39;Tennessee&#39;,
&#39;48&#39; =&gt; &#39;Texas&#39;,
&#39;49&#39; =&gt; &#39;Utah&#39;,
&#39;50&#39; =&gt; &#39;Vermont&#39;,
&#39;51&#39; =&gt; &#39;Virginia&#39;,
&#39;53&#39; =&gt; &#39;Washington&#39;,
&#39;54&#39; =&gt; &#39;West Virginia&#39;,
&#39;55&#39; =&gt; &#39;Wisconsin&#39;,
&#39;56&#39; =&gt; &#39;Wyoming&#39;
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Federal Information Processing Standard (FIPS) state codes Just the 50 states for now.  From <a href="http://www.itl.nist.gov/fipspubs/fip5-2.htm">www.itl.nist.gov/fipspubs/fip5-2.htm</a></p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">FIPS_STATE_CODES</td>
            <td>=</td>
            <td class="attr-value">{
&#39;01&#39; =&gt; &#39;AL&#39;,
&#39;02&#39; =&gt; &#39;AK&#39;,
&#39;04&#39; =&gt; &#39;AZ&#39;,
&#39;05&#39; =&gt; &#39;AR&#39;,
&#39;06&#39; =&gt; &#39;CA&#39;,
&#39;08&#39; =&gt; &#39;CO&#39;,
&#39;09&#39; =&gt; &#39;CT&#39;,
&#39;10&#39; =&gt; &#39;DE&#39;,
&#39;11&#39; =&gt; &#39;DC&#39;,
&#39;12&#39; =&gt; &#39;FL&#39;,
&#39;13&#39; =&gt; &#39;GA&#39;,
&#39;15&#39; =&gt; &#39;HI&#39;,
&#39;16&#39; =&gt; &#39;ID&#39;,
&#39;17&#39; =&gt; &#39;IL&#39;,
&#39;18&#39; =&gt; &#39;IN&#39;,
&#39;19&#39; =&gt; &#39;IA&#39;,
&#39;20&#39; =&gt; &#39;KS&#39;,
&#39;21&#39; =&gt; &#39;KY&#39;,
&#39;22&#39; =&gt; &#39;LA&#39;,
&#39;23&#39; =&gt; &#39;ME&#39;,
&#39;24&#39; =&gt; &#39;MD&#39;,
&#39;25&#39; =&gt; &#39;MA&#39;,
&#39;26&#39; =&gt; &#39;MI&#39;,
&#39;27&#39; =&gt; &#39;MD&#39;,
&#39;28&#39; =&gt; &#39;MS&#39;,
&#39;29&#39; =&gt; &#39;MO&#39;,
&#39;30&#39; =&gt; &#39;MT&#39;,
&#39;31&#39; =&gt; &#39;NE&#39;,
&#39;32&#39; =&gt; &#39;NV&#39;,
&#39;33&#39; =&gt; &#39;NH&#39;,
&#39;34&#39; =&gt; &#39;NJ&#39;,
&#39;35&#39; =&gt; &#39;NM&#39;,
&#39;36&#39; =&gt; &#39;NY&#39;,
&#39;37&#39; =&gt; &#39;NC&#39;,
&#39;38&#39; =&gt; &#39;ND&#39;,
&#39;39&#39; =&gt; &#39;OH&#39;,
&#39;40&#39; =&gt; &#39;OK&#39;,
&#39;41&#39; =&gt; &#39;OR&#39;,
&#39;42&#39; =&gt; &#39;PA&#39;,
&#39;44&#39; =&gt; &#39;RI&#39;,
&#39;45&#39; =&gt; &#39;SC&#39;,
&#39;46&#39; =&gt; &#39;SD&#39;,
&#39;47&#39; =&gt; &#39;TN&#39;,
&#39;48&#39; =&gt; &#39;TX&#39;,
&#39;49&#39; =&gt; &#39;UT&#39;,
&#39;50&#39; =&gt; &#39;VT&#39;,
&#39;51&#39; =&gt; &#39;VA&#39;,
&#39;53&#39; =&gt; &#39;WA&#39;,
&#39;54&#39; =&gt; &#39;WV&#39;,
&#39;55&#39; =&gt; &#39;WI&#39;,
&#39;56&#39; =&gt; &#39;WY&#39;
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">LSAD</td>
            <td>=</td>
            <td class="attr-value">{
&#39;01&#39; =&gt; &#39;state&#39;,                  # state or statistical equivalent of a state      -    state or statistical equivalent of a state
&#39;03&#39; =&gt; &#39;city&#39;,                   # city and borough        City and Borough       legal county equivalent in Alaska
&#39;04&#39; =&gt; &#39;county&#39;,                 # borough Borough legal county equivalent in Alaska
&#39;05&#39; =&gt; &#39;county&#39;,                 # census area     Census Area statistical equivalent of a county in Alaska
&#39;06&#39; =&gt; &#39;county&#39;,                 # county  County   county in 48 states
&#39;07&#39; =&gt; &#39;county&#39;,                 # district        District       legal county equivalent in American Samoa
&#39;08&#39; =&gt; &#39;city&#39;,                   # independent city        city   legal county equivalent in Maryland, Missouri, and Virginia
&#39;09&#39; =&gt; &#39;city&#39;,                   # independent city        -      legal county equivalent in Nevada
&#39;10&#39; =&gt; &#39;county&#39;,                 # island  Island   legal county equivalent in the U.S. Virgin Islands
&#39;11&#39; =&gt; &#39;county&#39;,                 # island  -        legal county equivalent in American Samoa and Marshall Islands 
&#39;12&#39; =&gt; &#39;county&#39;,                 # municipality    Municipality       legal county equivalent in the Northern Mariana Islands and Marshall Islands
&#39;13&#39; =&gt; &#39;county&#39;,                 # municipio       Municipio     legal county equivalent in Puerto Rico
&#39;14&#39; =&gt; &#39;county&#39;,                 # -       -     legal county equivalent (used for District of Columbia and Guam)
&#39;15&#39; =&gt; &#39;county&#39;,                 # parish  Parish   legal county equivalent in Louisiana
&#39;19&#39; =&gt; &#39;reservation&#39;,            # reservation     Reservation legal county subdivision equivalent in Maine and New York (coextensive with all or part of an American Indian reservation)
&#39;20&#39; =&gt; &#39;barrio&#39;,                 # barrio  barrio   legal county subdivision in Puerto Rico
&#39;21&#39; =&gt; &#39;borough&#39;,                # borough borough legal county subdivision in New York; legal county subdivision equivalent in New Jersey and Pennsylvania
&#39;22&#39; =&gt; &#39;census&#39;,                 # census county division  CCD      statistical equivalent of a county subdivision in                            21 States
&#39;23&#39; =&gt; &#39;census&#39;,                 # census subarea  census subarea   statistical equivalent of a county subdivision in Alaska
&#39;24&#39; =&gt; &#39;census subdistrict&#39;,     # census subdistrict      subdistrict  legal county subdivision equivalent in the U.S. Virgin Islands
&#39;25&#39; =&gt; &#39;city&#39;,                   # city    city       legal county subdivision equivalent in 20 States and the District of Columbia
&#39;26&#39; =&gt; &#39;county&#39;,                 # county  county   legal county subdivision in American Samoa
&#39;27&#39; =&gt; &#39;district&#39;,               # district (election magisterial, or municipal, or road)  district legal county subdivision in Pennsylvania, Virginia, West Virginia, Guam, and Northern Mariana Islands
&#39;28&#39; =&gt; &#39;district&#39;,               # district (assessment, election, magisterial, super-visor&#39;s, parish governing authority,or municipal)    -  legal county subdivision in Louisiana, Maryland, Mississippi, Virginia, and West Virginia
&#39;29&#39; =&gt; &#39;election precinct&#39;,      # election precinct       precinct      legal county subdivision in Illinois and Nebraska
&#39;30&#39; =&gt; &#39;election precinct&#39;,      # election precinct       -     legal county subdivision in Illinois and Nebraska
&#39;31&#39; =&gt; &#39;gore&#39;,                   # gore    gore       legal county subdivision in Maine and Vermont
&#39;32&#39; =&gt; &#39;grant&#39;,                  # grant   grant     legal county subdivision in New Hampshire and Vermont
&#39;33&#39; =&gt; &#39;city&#39;,                   # independent city        city   legal county subdivision equivalent in Maryland, Missouri, and Virginia
&#39;34&#39; =&gt; &#39;city&#39;,                   # independent city        -      legal county subdivision equivalent in Nevada
&#39;35&#39; =&gt; &#39;island&#39;,                 # island  -        legal county subdivision in American Samoa 
&#39;36&#39; =&gt; &#39;location&#39;,               # location        location       legal county subdivision in New Hampshire
&#39;38&#39; =&gt; &#39;location&#39;,               # -       -     legal county subdivision equivalent for Arlington County, Virginia
&#39;39&#39; =&gt; &#39;plantation&#39;,             # plantation      plantation   legal county subdivision in Maine
&#39;40&#39; =&gt; &#39;plantation&#39;,             # -       -     legal county subdivision not defined
&#39;41&#39; =&gt; &#39;barrio-pueblo&#39;,          # barrio-pueblo   barrio-pueblo     legal county subdivision in Puerto Rico
&#39;42&#39; =&gt; &#39;purchase&#39;,               # purchase        purchase       legal county subdivision in New Hampshire
&#39;43&#39; =&gt; &#39;city&#39;,                   # town    town       legal county subdivision in eight States; legal county subdivision equivalent in New Jersey, North Carolina, Pennsylvania, and South Dakota
&#39;44&#39; =&gt; &#39;city&#39;,                   # township        township       legal county subdivision in 16 states
&#39;45&#39; =&gt; &#39;city&#39;,                   # township        -      legal county subdivision in Kansas, Minnesota, Nebraska, and North Carolina
&#39;46&#39; =&gt; &#39;unorganized territory&#39;,  # unorganized territory   UT        statistical equivalent of a county subdivision in 10 States
&#39;47&#39; =&gt; &#39;city&#39;,                   # village village legal county subdivision equivalent in New Jersey, Ohio, South Dakota, and Wisconsin
&#39;49&#39; =&gt; &#39;city&#39;,                   # charter township        charter township       legal county subdivision in Michigan
&#39;51&#39; =&gt; &#39;subbarrio&#39;,              # subbarrio       subbarrio     legal sub-MCD in Puerto Rico
&#39;53&#39; =&gt; &#39;city&#39;,                   # city and borough        city and borough       incorporated place in Alaska
&#39;54&#39; =&gt; &#39;city&#39;,                   # municipality    municipality       incorporated place in Alaska
&#39;55&#39; =&gt; &#39;city&#39;,                   # comunidad       comunidad     statistical equivalent of a place in Puerto Rico
&#39;56&#39; =&gt; &#39;city&#39;,                   # borough borough incorporated place in Connecticut, New Jersey, and Pennsylvania
&#39;57&#39; =&gt; &#39;city&#39;,                   # census designated place CDP     statistical equivalent of a place in all 50 states, Guam, Northern Mariana Islands, and the U.S. Virgin Islands
&#39;58&#39; =&gt; &#39;city&#39;,                   # city    city       incorporated place in 49 States (not Hawaii) and District of Columbia
&#39;59&#39; =&gt; &#39;city&#39;,                   # city    -  incorporated place having no legaldescription in three states; place equivalent in five states
&#39;60&#39; =&gt; &#39;city&#39;,                   # town    town       incorporated place in 30 States and the U.S. Virgin Islands
&#39;61&#39; =&gt; &#39;city&#39;,                   # village village incorporated place in 20 States and traditional place in American Samoa
&#39;62&#39; =&gt; &#39;zona urbana&#39;,            # zona urbana     zona urbana statistical equivalent of a place in Puerto Rico
&#39;65&#39; =&gt; &#39;consolidated city&#39;,      # consolidated city       city  consolidated city in Connecticut, Georgia, and Indiana
&#39;66&#39; =&gt; &#39;consolidated city&#39;,      # consolidated city       -     consolidated city (with unique description or no description)
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>abbreviated and condensed US Census Legal/Statistical Area Description Codes Several have been mapped to place types that seem right for iNat <a href="http://www2.census.gov/geo/tiger/tiger2k/a2kapg.txt">www2.census.gov/geo/tiger/tiger2k/a2kapg.txt</a></p></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-new_place_from_census_shape">
            
              <b>new_place_from_census_shape</b>(shape, options = {})
            
            <a href="../classes/PlaceSources.html#method-c-new_place_from_census_shape" name="method-c-new_place_from_census_shape" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>We use the state, county, and place census shapefiles, all of which can be obtained from <a href="http://www2.census.gov/cgi-bin/shapefiles/national-files">www2.census.gov/cgi-bin/shapefiles/national-files</a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-new_place_from_census_shape_source')" id="l_method-c-new_place_from_census_shape_source">show</a>
                

                

                
              </p>
              <div id="method-c-new_place_from_census_shape_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File lib/place_sources.rb</span>
<span class="line-num">187</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">new_place_from_census_shape</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">188</span>   <span class="ruby-identifier">options</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">clone</span>
<span class="line-num">189</span>   <span class="ruby-identifier">data</span> = <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">data</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">attributes</span>
<span class="line-num">190</span>   <span class="ruby-identifier">name</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;NAME&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;NAME10&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;NAMELSAD&quot;</span>]
<span class="line-num">191</span>   <span class="ruby-identifier">options</span>[<span class="ruby-value">:name</span>] = <span class="ruby-identifier">name</span>
<span class="line-num">192</span>   <span class="ruby-identifier">state_code</span> = <span class="ruby-constant">FIPS_STATE_CODES</span>[<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;STATEFP&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;STATE&quot;</span>]]
<span class="line-num">193</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:place_type_name</span>]
<span class="line-num">194</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;State&#39;</span>
<span class="line-num">195</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:place_type</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">PLACE_TYPE_CODES</span>[<span class="ruby-string">&#39;State&#39;</span>]
<span class="line-num">196</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:admin_level</span>] = <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">STATE_LEVEL</span>
<span class="line-num">197</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:parent</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Place</span>.<span class="ruby-identifier">place_type</span>(<span class="ruby-string">&#39;Country&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;name LIKE &#39;United States%&#39;&quot;</span>).<span class="ruby-identifier">first</span>
<span class="line-num">198</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:code</span>] = <span class="ruby-identifier">state_code</span>
<span class="line-num">199</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;County&#39;</span>
<span class="line-num">200</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:place_type</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">PLACE_TYPE_CODES</span>[<span class="ruby-string">&#39;County&#39;</span>]
<span class="line-num">201</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:admin_level</span>] = <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">COUNTY_LEVEL</span>
<span class="line-num">202</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:code</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;COUNTY&#39;</span>]
<span class="line-num">203</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:parent</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Place</span>.<span class="ruby-identifier">place_type</span>(<span class="ruby-string">&#39;State&#39;</span>).<span class="ruby-identifier">where</span>(
<span class="line-num">204</span>       <span class="ruby-value">code:</span> <span class="ruby-identifier">state_code</span>,
<span class="line-num">205</span>       <span class="ruby-value">name:</span> <span class="ruby-constant">FIPS_STATES</span>[<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;STATEFP&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;STATE&#39;</span>]]
<span class="line-num">206</span>     ).<span class="ruby-identifier">first</span>
<span class="line-num">207</span>   <span class="ruby-keyword">end</span>
<span class="line-num">208</span>   
<span class="line-num">209</span>   <span class="ruby-comment"># The county files often contain a lot of weird county-like stuff that we</span>
<span class="line-num">210</span>   <span class="ruby-comment"># probably don&#39;t want...</span>
<span class="line-num">211</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:place_type_name</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;County&#39;</span>
<span class="line-num">212</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">LSAD</span>[<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;LSAD&#39;</span>]] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;county&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;LSAD&#39;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;county&#39;</span>
<span class="line-num">213</span>   <span class="ruby-keyword">end</span>
<span class="line-num">214</span>   
<span class="line-num">215</span>   <span class="ruby-identifier">place</span> = <span class="ruby-constant">Place</span>.<span class="ruby-identifier">new_from_shape</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">216</span>   
<span class="line-num">217</span>   <span class="ruby-comment"># Using FIPS codes for source identifiers.  Note that for counties and places</span>
<span class="line-num">218</span>   <span class="ruby-comment"># they are ONLY unique whithin their state</span>
<span class="line-num">219</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">source_identifier</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:place_type_name</span>]
<span class="line-num">220</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;State&#39;</span>
<span class="line-num">221</span>     <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;STATEFP&#39;</span>]
<span class="line-num">222</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;County&#39;</span>
<span class="line-num">223</span>     <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;GEOID&#39;</span>]
<span class="line-num">224</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;place&#39;</span>
<span class="line-num">225</span>     <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;PLACEFP&#39;</span>]
<span class="line-num">226</span>   <span class="ruby-keyword">end</span>
<span class="line-num">227</span>   
<span class="line-num">228</span>   <span class="ruby-identifier">place</span>
<span class="line-num">229</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new_place_from_cpad_units_fee">
            
              <b>new_place_from_cpad_units_fee</b>(shape, options = {})
            
            <a href="../classes/PlaceSources.html#method-c-new_place_from_cpad_units_fee" name="method-c-new_place_from_cpad_units_fee" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>CPAD is the California Protected Areas Database, an awesome shapefile of protected parcels from the state assembled by the GreenInfo Network: <a href="http://www.calands.org">www.calands.org</a>.  Note that the dataset comes projected in California Teale-Albers, which, aside from being projected, uses a completely different coordinate system, so you will need to project it into lat/lon using the NAD83 / WGS 84 datum for use in iNat.  You can do this very easily with OGR (<a href="http://gdal.org/ogr">gdal.org/ogr</a>/):</p>

<pre><code>ogr2ogr -t_srs &quot;+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs&quot; Units_Fee_09_longlat.shp Units_Fee_09.shp
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-new_place_from_cpad_units_fee_source')" id="l_method-c-new_place_from_cpad_units_fee_source">show</a>
                

                

                
              </p>
              <div id="method-c-new_place_from_cpad_units_fee_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File lib/place_sources.rb</span>
<span class="line-num">257</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">new_place_from_cpad_units_fee</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">258</span>   <span class="ruby-identifier">data</span> = <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">data</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">attributes</span>
<span class="line-num">259</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> [<span class="ruby-string">&#39;XA&#39;</span>, <span class="ruby-string">&#39;No Access&#39;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;Access&#39;</span>])
<span class="line-num">260</span>   <span class="ruby-identifier">place</span> = <span class="ruby-constant">Place</span>.<span class="ruby-identifier">new_from_shape</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">261</span>   
<span class="line-num">262</span>   <span class="ruby-identifier">name</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;Unit_Name&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;UNIT_NAME&#39;</span>]
<span class="line-num">263</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/SP$/</span>, <span class="ruby-string">&#39;State Park&#39;</span>)
<span class="line-num">264</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/SB$/</span>, <span class="ruby-string">&#39;State Beach&#39;</span>)
<span class="line-num">265</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/NP$/</span>, <span class="ruby-string">&#39;National Park&#39;</span>)
<span class="line-num">266</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/NM$/</span>, <span class="ruby-string">&#39;National Monument&#39;</span>)
<span class="line-num">267</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/NF$/</span>, <span class="ruby-string">&#39;National Forest&#39;</span>)
<span class="line-num">268</span>   <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/WA$/</span>, <span class="ruby-string">&#39;Wildlife Area&#39;</span>)
<span class="line-num">269</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>
<span class="line-num">270</span>   
<span class="line-num">271</span>   <span class="ruby-identifier">unit_id</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;UNIT_ID&#39;</span>]
<span class="line-num">272</span>   
<span class="line-num">273</span>   <span class="ruby-comment"># Sometimes single parks have many units, so we lump them</span>
<span class="line-num">274</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">source_name</span> = <span class="ruby-identifier">name</span>
<span class="line-num">275</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">source_identifier</span> = <span class="ruby-identifier">unit_id</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">unit_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
<span class="line-num">276</span>   
<span class="line-num">277</span>   <span class="ruby-comment"># Try to find a parent anyway by looking for the</span>
<span class="line-num">278</span>   <span class="ruby-comment"># smallest place whose bounding box contains this one&#39;s.  This also</span>
<span class="line-num">279</span>   <span class="ruby-comment"># ignores places with iNat place types, like the &quot;Open Space&quot; type used</span>
<span class="line-num">280</span>   <span class="ruby-comment"># for CPAD places</span>
<span class="line-num">281</span>   <span class="ruby-identifier">parent</span> = <span class="ruby-constant">Place</span>.<span class="ruby-identifier">containing_bbox</span>(<span class="ruby-identifier">place</span>.<span class="ruby-identifier">swlat</span>, <span class="ruby-identifier">place</span>.<span class="ruby-identifier">swlng</span>, <span class="ruby-identifier">place</span>.<span class="ruby-identifier">nelat</span>,
<span class="line-num">282</span>     <span class="ruby-identifier">place</span>.<span class="ruby-identifier">nelng</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;place_type &lt; 100&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;bbox_area ASC&quot;</span>).<span class="ruby-identifier">first</span>
<span class="line-num">283</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">parent</span> = <span class="ruby-identifier">parent</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent</span>
<span class="line-num">284</span>   
<span class="line-num">285</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">place_type</span> = <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">PLACE_TYPE_CODES</span>[<span class="ruby-string">&#39;Open Space&#39;</span>]
<span class="line-num">286</span>   
<span class="line-num">287</span>   <span class="ruby-identifier">place</span>
<span class="line-num">288</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new_place_from_esri_world_shape">
            
              <b>new_place_from_esri_world_shape</b>(shape, options = {})
            
            <a href="../classes/PlaceSources.html#method-c-new_place_from_esri_world_shape" name="method-c-new_place_from_esri_world_shape" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>ESRI world political boundaries are a pretty commonly used dataset for demos and the like.  You can get a copy from the UNEP GEO Data Portal: <a href="http://geodata.grid.unep.ch">geodata.grid.unep.ch</a>/ (search for &#39;boundaries&#39;).  Note that this file is of dubious utility, because it tends to not have national boundaries for large nations (like the US) opting instead for state borders, so you might only want to work with extractions (e.g. states of  India).  Might want to write a script that derives national boundaries…</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-new_place_from_esri_world_shape_source')" id="l_method-c-new_place_from_esri_world_shape_source">show</a>
                

                

                
              </p>
              <div id="method-c-new_place_from_esri_world_shape_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File lib/place_sources.rb</span>
<span class="line-num">240</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">new_place_from_esri_world_shape</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">241</span>   <span class="ruby-identifier">data</span> = <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">data</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">shape</span>.<span class="ruby-identifier">attributes</span>
<span class="line-num">242</span>   <span class="ruby-identifier">place</span> = <span class="ruby-constant">Place</span>.<span class="ruby-identifier">new_from_shape</span>(<span class="ruby-identifier">shape</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">243</span>   <span class="ruby-identifier">place</span>.<span class="ruby-identifier">source_identifier</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;FIPS_ADMIN&#39;</span>]
<span class="line-num">244</span>   <span class="ruby-identifier">place</span>
<span class="line-num">245</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
    
  
</div>

    </main>
  </body>
</html>
