<!DOCTYPE html>
<html lang="en">
<head>
    <title>ListedTaxon</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/panel.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/turbolinks.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/search_index.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../panel/tree.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searchdoc.js" type="text/javascript" charset="utf-8"></script>
<meta name="data-rel-prefix" content="../">
<meta name="data-tree-keys" content='["ListedTaxon"]'>


    <meta property="og:title" value="ListedTaxon">

  
    
    <meta name="description" content="Join model for Lists and Taxa.">
    <meta property="og:description" content="Join model for Lists and Taxa.">
  

    <meta name="keywords" content="ListedTaxon class, ancestry, to_s, to_plain_s, not_on_a_comprehensive_check_list, existing_comprehensive_list, existing_comprehensive_listed_taxon, absent_only_if_not_confirming_observations, list_rules_pass, taxon_matches_observation, taxon_matches_curator_identification?, check_list_editability, establishment_means_allowed, set_old_list, set_user_id, set_source_id, set_updater_id, set_place_id, set_establishment_means, set_primary_listing, sync_parent_check_list, sync_species_if_infraspecies, index_taxon, update_cache_columns, set_cache_columns, update_cache_columns_for_check_list, propagate_establishment_means, bubble_up_establishment_means, trickle_down_establishment_means, has_atlas_or_complete_set?, log_create, log_destroy, log_create_if_taxon_id_changed, cache_columns, earliest_and_latest_ids, update_cache_columns_for, species_for_infraspecies, get_defaults_for_taxon_place, nilify_blanks, occurrence_status, occurrence_status=, is_present?, is_absent?, editable_by?, removable_by?, citation_object, auto_removable_from_check_list?, introduced?, native?, endemic?, taxon_name, taxon_common_name, user_login, expire_caches, expire_caches_for, merge, observed_in_place?, merge_duplicates, update_for_taxon_change, related_listed_taxa, other_primary_listed_taxa?, multiple_primary_listed_taxa?, primary_listed_taxon, check_primary_listing, can_set_as_primary?, remove_other_primary_listings, reassign_primary_listed_taxon, update_on_related_listed_taxa, make_primary_if_no_primary_exists, place_ancestor_ids_sql, primary_occurrence_status, primary_establishment_means, update_and_primary, as_indexed_json, establishment_means_label, establishment_means_description, reindex_observations_later, reindex_observations">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            ListedTaxon
            
                <span class="parent">&lt;
                    
                    <a href="ApplicationRecord.html">ApplicationRecord</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/app/models/listed_taxon_rb.html">app/models/listed_taxon.rb</a></li>
            
            <li><a href="../files/app/models/place_rb.html">app/models/place.rb</a></li>
            
            <li><a href="../files/app/models/taxon_rb.html">app/models/taxon.rb</a></li>
            
            <li><a href="../files/lib/observation_search_rb.html">lib/observation_search.rb</a></li>
            
        </ul>
        
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Join model for Lists and Taxa.  In addition to storing a reference to the last observed taxon (saving some db time), this model&#39;s validation makes sure a taxon passes all of a list&#39;s ListRules.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-absent_only_if_not_confirming_observations">absent_only_if_not_confirming_observations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ancestry">ancestry</a>,
              </li>
            
              
              <li>
                <a href="#method-i-as_indexed_json">as_indexed_json</a>,
              </li>
            
              
              <li>
                <a href="#method-i-auto_removable_from_check_list-3F">auto_removable_from_check_list?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-bubble_up_establishment_means">bubble_up_establishment_means</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-cache_columns">cache_columns</a>,
              </li>
            
              
              <li>
                <a href="#method-i-can_set_as_primary-3F">can_set_as_primary?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-check_list_editability">check_list_editability</a>,
              </li>
            
              
              <li>
                <a href="#method-i-check_primary_listing">check_primary_listing</a>,
              </li>
            
              
              <li>
                <a href="#method-i-citation_object">citation_object</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-earliest_and_latest_ids">earliest_and_latest_ids</a>,
              </li>
            
              
              <li>
                <a href="#method-i-editable_by-3F">editable_by?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-endemic-3F">endemic?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-establishment_means_allowed">establishment_means_allowed</a>,
              </li>
            
              
              <li>
                <a href="#method-i-establishment_means_description">establishment_means_description</a>,
              </li>
            
              
              <li>
                <a href="#method-i-establishment_means_label">establishment_means_label</a>,
              </li>
            
              
              <li>
                <a href="#method-i-existing_comprehensive_list">existing_comprehensive_list</a>,
              </li>
            
              
              <li>
                <a href="#method-i-existing_comprehensive_listed_taxon">existing_comprehensive_listed_taxon</a>,
              </li>
            
              
              <li>
                <a href="#method-i-expire_caches">expire_caches</a>,
              </li>
            
              
              <li>
                <a href="#method-c-expire_caches_for">expire_caches_for</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-get_defaults_for_taxon_place">get_defaults_for_taxon_place</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-has_atlas_or_complete_set-3F">has_atlas_or_complete_set?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-index_taxon">index_taxon</a>,
              </li>
            
              
              <li>
                <a href="#method-i-introduced-3F">introduced?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-is_absent-3F">is_absent?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-is_present-3F">is_present?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-list_rules_pass">list_rules_pass</a>,
              </li>
            
              
              <li>
                <a href="#method-i-log_create">log_create</a>,
              </li>
            
              
              <li>
                <a href="#method-i-log_create_if_taxon_id_changed">log_create_if_taxon_id_changed</a>,
              </li>
            
              
              <li>
                <a href="#method-i-log_destroy">log_destroy</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-make_primary_if_no_primary_exists">make_primary_if_no_primary_exists</a>,
              </li>
            
              
              <li>
                <a href="#method-i-merge">merge</a>,
              </li>
            
              
              <li>
                <a href="#method-c-merge_duplicates">merge_duplicates</a>,
              </li>
            
              
              <li>
                <a href="#method-i-multiple_primary_listed_taxa-3F">multiple_primary_listed_taxa?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-native-3F">native?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-nilify_blanks">nilify_blanks</a>,
              </li>
            
              
              <li>
                <a href="#method-i-not_on_a_comprehensive_check_list">not_on_a_comprehensive_check_list</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-observed_in_place-3F">observed_in_place?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-occurrence_status">occurrence_status</a>,
              </li>
            
              
              <li>
                <a href="#method-i-occurrence_status-3D">occurrence_status=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-other_primary_listed_taxa-3F">other_primary_listed_taxa?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-place_ancestor_ids_sql">place_ancestor_ids_sql</a>,
              </li>
            
              
              <li>
                <a href="#method-i-primary_establishment_means">primary_establishment_means</a>,
              </li>
            
              
              <li>
                <a href="#method-i-primary_listed_taxon">primary_listed_taxon</a>,
              </li>
            
              
              <li>
                <a href="#method-i-primary_occurrence_status">primary_occurrence_status</a>,
              </li>
            
              
              <li>
                <a href="#method-i-propagate_establishment_means">propagate_establishment_means</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-reassign_primary_listed_taxon">reassign_primary_listed_taxon</a>,
              </li>
            
              
              <li>
                <a href="#method-c-reindex_observations">reindex_observations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-reindex_observations_later">reindex_observations_later</a>,
              </li>
            
              
              <li>
                <a href="#method-i-related_listed_taxa">related_listed_taxa</a>,
              </li>
            
              
              <li>
                <a href="#method-i-removable_by-3F">removable_by?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-remove_other_primary_listings">remove_other_primary_listings</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-set_cache_columns">set_cache_columns</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_establishment_means">set_establishment_means</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_old_list">set_old_list</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_place_id">set_place_id</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_primary_listing">set_primary_listing</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_source_id">set_source_id</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_updater_id">set_updater_id</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_user_id">set_user_id</a>,
              </li>
            
              
              <li>
                <a href="#method-c-species_for_infraspecies">species_for_infraspecies</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_parent_check_list">sync_parent_check_list</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_species_if_infraspecies">sync_species_if_infraspecies</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-taxon_common_name">taxon_common_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_matches_curator_identification-3F">taxon_matches_curator_identification?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_matches_observation">taxon_matches_observation</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_name">taxon_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-to_plain_s">to_plain_s</a>,
              </li>
            
              
              <li>
                <a href="#method-i-to_s">to_s</a>,
              </li>
            
              
              <li>
                <a href="#method-i-trickle_down_establishment_means">trickle_down_establishment_means</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update_and_primary">update_and_primary</a>,
              </li>
            
              
              <li>
                <a href="#method-i-update_cache_columns">update_cache_columns</a>,
              </li>
            
              
              <li>
                <a href="#method-c-update_cache_columns_for">update_cache_columns_for</a>,
              </li>
            
              
              <li>
                <a href="#method-i-update_cache_columns_for_check_list">update_cache_columns_for_check_list</a>,
              </li>
            
              
              <li>
                <a href="#method-c-update_for_taxon_change">update_for_taxon_change</a>,
              </li>
            
              
              <li>
                <a href="#method-i-update_on_related_listed_taxa">update_on_related_listed_taxa</a>,
              </li>
            
              
              <li>
                <a href="#method-i-user_login">user_login</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ALPHABETICAL_ORDER</td>
            <td>=</td>
            <td class="attr-value">&quot;alphabetical&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">CHECK_LIST_FIELDS</td>
            <td>=</td>
            <td class="attr-value">%w(place_id occurrence_status establishment_means)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">ESTABLISHMENT_MEANS</td>
            <td>=</td>
            <td class="attr-value">%w(native endemic introduced)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">INTRODUCED_EQUIVALENTS</td>
            <td>=</td>
            <td class="attr-value">%w(introduced)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">NATIVE_EQUIVALENTS</td>
            <td>=</td>
            <td class="attr-value">%w(native endemic)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OCCURRENCE_STATUSES</td>
            <td>=</td>
            <td class="attr-value">OCCURRENCE_STATUS_LEVELS.values</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OCCURRENCE_STATUS_DESCRIPTIONS</td>
            <td>=</td>
            <td class="attr-value">ActiveSupport::OrderedHash.new</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OCCURRENCE_STATUS_LEVELS</td>
            <td>=</td>
            <td class="attr-value">{
60 =&gt; &quot;present&quot;,
50 =&gt; &quot;common&quot;,
40 =&gt; &quot;uncommon&quot;,
30 =&gt; &quot;irregular&quot;,
20 =&gt; &quot;doubtful&quot;,
10 =&gt; &quot;absent&quot;
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OCCURRENCE_STATUS_LEVELS_BY_NAME</td>
            <td>=</td>
            <td class="attr-value">OCCURRENCE_STATUS_LEVELS.invert</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">ORDERS</td>
            <td>=</td>
            <td class="attr-value">[ALPHABETICAL_ORDER, TAXONOMIC_ORDER]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">PRESENT_EQUIVALENTS</td>
            <td>=</td>
            <td class="attr-value">[PRESENT, COMMON, UNCOMMON]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">TAXONOMIC_ORDER</td>
            <td>=</td>
            <td class="attr-value">&quot;taxonomic&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <h2 class="sectiontitle">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>extra</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>force_trickle_down_establishment_means</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>force_update_cache_columns</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>html</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>old_list</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>skip_index_taxon</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>skip_species_for_infraspecies</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>skip_sync_with_parent</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>skip_update_cache_columns</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-earliest_and_latest_ids">
            
              <b>earliest_and_latest_ids</b>(options)
            
            <a href="../classes/ListedTaxon.html#method-c-earliest_and_latest_ids" name="method-c-earliest_and_latest_ids" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-earliest_and_latest_ids_source')" id="l_method-c-earliest_and_latest_ids_source">show</a>
                

                

                
              </p>
              <div id="method-c-earliest_and_latest_ids_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">576</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">earliest_and_latest_ids</span>(<span class="ruby-identifier">options</span>)
<span class="line-num">577</span>   <span class="ruby-identifier">earliest_id</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">578</span>   <span class="ruby-identifier">latest_id</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">579</span>   <span class="ruby-keyword">return</span> [ <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">0</span> ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:filters</span>]
<span class="line-num">580</span>   <span class="ruby-identifier">search_params</span> = { <span class="ruby-value">filters:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:filters</span>].<span class="ruby-identifier">dup</span> }
<span class="line-num">581</span>   <span class="ruby-identifier">search_params</span>[<span class="ruby-value">:size</span>] = <span class="ruby-value">1</span>
<span class="line-num">582</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:range_filters</span>]
<span class="line-num">583</span>     <span class="ruby-identifier">search_params</span>[<span class="ruby-value">:filters</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:range_filters</span>]
<span class="line-num">584</span>   <span class="ruby-keyword">end</span>
<span class="line-num">585</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">586</span>     <span class="ruby-comment"># fetch the total and the earliest and latest observations</span>
<span class="line-num">587</span>     <span class="ruby-comment"># in a single ES query with the top_hits aggregation</span>
<span class="line-num">588</span>     <span class="ruby-identifier">rs</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_search</span>(<span class="ruby-identifier">search_params</span>.<span class="ruby-identifier">merge</span>(
<span class="line-num">589</span>       <span class="ruby-value">size:</span> <span class="ruby-value">0</span>,
<span class="line-num">590</span>       <span class="ruby-value">track_total_hits:</span> <span class="ruby-keyword">true</span>,
<span class="line-num">591</span>       <span class="ruby-value">aggregate:</span> {
<span class="line-num">592</span>         <span class="ruby-value">earliest:</span> {
<span class="line-num">593</span>           <span class="ruby-value">top_hits:</span> {
<span class="line-num">594</span>             <span class="ruby-value">sort:</span> [
<span class="line-num">595</span>               { (<span class="ruby-identifier">options</span>[<span class="ruby-value">:earliest_sort_field</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;observed_on&quot;</span>) <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">order:</span> <span class="ruby-string">&quot;asc&quot;</span>, <span class="ruby-value">unmapped_type:</span> <span class="ruby-string">&quot;long&quot;</span> } },
<span class="line-num">596</span>               { <span class="ruby-value">id:</span> <span class="ruby-value">:asc</span> }
<span class="line-num">597</span>             ],
<span class="line-num">598</span>             <span class="ruby-value">_source:</span> { <span class="ruby-value">includes:</span> [ <span class="ruby-string">&quot;id&quot;</span> ] },
<span class="line-num">599</span>             <span class="ruby-value">size:</span> <span class="ruby-value">1</span>
<span class="line-num">600</span>           }
<span class="line-num">601</span>         },
<span class="line-num">602</span>         <span class="ruby-value">latest:</span> {
<span class="line-num">603</span>           <span class="ruby-value">top_hits:</span> {
<span class="line-num">604</span>             <span class="ruby-value">sort:</span> [
<span class="line-num">605</span>               { <span class="ruby-value">observed_on:</span> { <span class="ruby-value">order:</span> <span class="ruby-string">&quot;desc&quot;</span>, <span class="ruby-value">unmapped_type:</span> <span class="ruby-string">&quot;long&quot;</span> } },
<span class="line-num">606</span>               { <span class="ruby-value">id:</span> <span class="ruby-value">:desc</span> }
<span class="line-num">607</span>             ],
<span class="line-num">608</span>             <span class="ruby-value">_source:</span> { <span class="ruby-value">includes:</span> [ <span class="ruby-string">&quot;id&quot;</span> ] },
<span class="line-num">609</span>             <span class="ruby-value">size:</span> <span class="ruby-value">1</span>
<span class="line-num">610</span>           }
<span class="line-num">611</span>         }
<span class="line-num">612</span>       }
<span class="line-num">613</span>     ))
<span class="line-num">614</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">rs</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">total_entries</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>
<span class="line-num">615</span>       <span class="ruby-identifier">earliest_id</span> = <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>.<span class="ruby-identifier">earliest</span>.<span class="ruby-identifier">hits</span>.<span class="ruby-identifier">hits</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">_source</span>.<span class="ruby-identifier">id</span>
<span class="line-num">616</span>       <span class="ruby-identifier">latest_id</span> = <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>.<span class="ruby-identifier">latest</span>.<span class="ruby-identifier">hits</span>.<span class="ruby-identifier">hits</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">_source</span>.<span class="ruby-identifier">id</span>
<span class="line-num">617</span>       <span class="ruby-identifier">total</span> = <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">total_entries</span>
<span class="line-num">618</span>     <span class="ruby-keyword">end</span>
<span class="line-num">619</span>     [ <span class="ruby-identifier">earliest_id</span>, <span class="ruby-identifier">latest_id</span>, <span class="ruby-identifier">total</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>]
<span class="line-num">620</span>   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Elasticsearch</span><span class="ruby-operator">::</span><span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>,
<span class="line-num">621</span>          <span class="ruby-constant">Elasticsearch</span><span class="ruby-operator">::</span><span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">BadRequest</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
<span class="line-num">622</span>     <span class="ruby-constant">Logstasher</span>.<span class="ruby-identifier">write_exception</span>(<span class="ruby-identifier">e</span>, <span class="ruby-value">reference:</span> <span class="ruby-string">&quot;ListedTaxon.earliest_and_latest_ids failed&quot;</span>)
<span class="line-num">623</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;[Error] ListedTaxon::earliest_and_latest_ids failed: #{ e }&quot;</span>
<span class="line-num">624</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Backtrace:\n#{ e.backtrace[0..30].join(&quot;\n&quot;) }\n...&quot;</span>
<span class="line-num">625</span>     [ <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">0</span> ]
<span class="line-num">626</span>   <span class="ruby-keyword">end</span>
<span class="line-num">627</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-expire_caches_for">
            
              <b>expire_caches_for</b>(taxon)
            
            <a href="../classes/ListedTaxon.html#method-c-expire_caches_for" name="method-c-expire_caches_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-expire_caches_for_source')" id="l_method-c-expire_caches_for_source">show</a>
                

                

                
              </p>
              <div id="method-c-expire_caches_for_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">769</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">expire_caches_for</span>(<span class="ruby-identifier">taxon</span>)
<span class="line-num">770</span>   <span class="ruby-identifier">taxon</span> = <span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">taxon</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Taxon</span>)
<span class="line-num">771</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">772</span>   <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">listed_taxa</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:list</span>, <span class="ruby-value">:place</span>).<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lt</span><span class="ruby-operator">|</span>
<span class="line-num">773</span>     <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">expire_caches</span>
<span class="line-num">774</span>   <span class="ruby-keyword">end</span>
<span class="line-num">775</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-get_defaults_for_taxon_place">
            
              <b>get_defaults_for_taxon_place</b>( place,taxon, options = { } )
            
            <a href="../classes/ListedTaxon.html#method-c-get_defaults_for_taxon_place" name="method-c-get_defaults_for_taxon_place" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-get_defaults_for_taxon_place_source')" id="l_method-c-get_defaults_for_taxon_place_source">show</a>
                

                

                
              </p>
              <div id="method-c-get_defaults_for_taxon_place_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">654</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_defaults_for_taxon_place</span>( <span class="ruby-identifier">place</span>,<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = { } )
<span class="line-num">655</span>   <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">100</span>
<span class="line-num">656</span>   <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>] = <span class="ruby-value">200</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span>
<span class="line-num">657</span>   <span class="ruby-identifier">taxon</span> = <span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">find_by_id</span>( <span class="ruby-identifier">taxon</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Taxon</span> )
<span class="line-num">658</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">659</span>   <span class="ruby-identifier">place</span> = <span class="ruby-constant">Place</span>.<span class="ruby-identifier">find_by_id</span>( <span class="ruby-identifier">place</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Place</span> )
<span class="line-num">660</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place</span>
<span class="line-num">661</span>   <span class="ruby-identifier">place_descendant_ids</span> = <span class="ruby-identifier">place</span>.<span class="ruby-identifier">descendants</span>.
<span class="line-num">662</span>     <span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;admin_level IN ( ? )&quot;</span>, [<span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">COUNTRY_LEVEL</span>, <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">STATE_LEVEL</span>, <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">COUNTY_LEVEL</span>] ).<span class="ruby-identifier">pluck</span>( <span class="ruby-value">:id</span> )
<span class="line-num">663</span>   <span class="ruby-identifier">place_with_descendant_ids</span> = [ <span class="ruby-identifier">place</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">place_descendant_ids</span> ].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>
<span class="line-num">664</span>   <span class="ruby-identifier">lt</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">includes</span>( <span class="ruby-value">:place</span>, <span class="ruby-value">:taxon</span> ).<span class="ruby-identifier">joins</span>( { <span class="ruby-value">list:</span> <span class="ruby-value">:check_list_place</span> } ).<span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;lists.type = &#39;CheckList&#39;&quot;</span> ).
<span class="line-num">665</span>   <span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;listed_taxa.taxon_id IN ( ? )&quot;</span>, <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">subtree_ids</span> ).
<span class="line-num">666</span>   <span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;listed_taxa.place_id IN ( ? )&quot;</span>, <span class="ruby-identifier">place_with_descendant_ids</span> ).<span class="ruby-identifier">limit</span>( <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>] )
<span class="line-num">667</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-merge_duplicates">
            
              <b>merge_duplicates</b>(options = {})
            
            <a href="../classes/ListedTaxon.html#method-c-merge_duplicates" name="method-c-merge_duplicates" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-merge_duplicates_source')" id="l_method-c-merge_duplicates_source">show</a>
                

                

                
              </p>
              <div id="method-c-merge_duplicates_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">794</span>   <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">merge_duplicates</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">795</span>     <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:debug</span>)
<span class="line-num">796</span>     <span class="ruby-identifier">where</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k} = #{v}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; AND &#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">797</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">&lt;&lt;-SQL</span>
<span class="line-num">798</span> <span class="ruby-value">      SELECT list_id, taxon_id, array_agg(id) AS ids, count(*) 
<span class="line-num">799</span>       FROM listed_taxa
<span class="line-num">800</span>       #{&quot;WHERE #{where}&quot; if where}
<span class="line-num">801</span>       GROUP BY list_id, taxon_id HAVING count(*) &gt; 1
<span class="line-num">802</span> </span><span class="ruby-identifier">    SQL</span>
<span class="line-num">803</span>     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Finding listed taxa WHERE #{where}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
<span class="line-num">804</span>     <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\s+/</span>, <span class="ruby-string">&#39; &#39;</span>).<span class="ruby-identifier">strip</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">805</span>       <span class="ruby-identifier">to_merge_ids</span> = <span class="ruby-identifier">row</span>[<span class="ruby-string">&#39;ids&#39;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[\{\}]/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">sort</span>
<span class="line-num">806</span>       <span class="ruby-identifier">lt</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">to_merge_ids</span>.<span class="ruby-identifier">first</span>)
<span class="line-num">807</span>       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;lt: #{lt}, merging #{to_merge_ids}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
<span class="line-num">808</span>       <span class="ruby-identifier">rejects</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-identifier">to_merge_ids</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
<span class="line-num">809</span> 
<span class="line-num">810</span>       <span class="ruby-comment"># remove the rejects from the list before merging to avoid alread-on-list validation errors</span>
<span class="line-num">811</span>       <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-identifier">rejects</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-value">list_id:</span> <span class="ruby-keyword">nil</span>)
<span class="line-num">812</span>       
<span class="line-num">813</span>       <span class="ruby-identifier">rejects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reject</span><span class="ruby-operator">|</span>
<span class="line-num">814</span>         <span class="ruby-keyword">begin</span>
<span class="line-num">815</span>           <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-identifier">reject</span> )
<span class="line-num">816</span>         <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>
<span class="line-num">817</span>           <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Validation error on #{reject}, skipping merge and deleting&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
<span class="line-num">818</span>           <span class="ruby-identifier">reject</span>.<span class="ruby-identifier">destroy</span>
<span class="line-num">819</span>         <span class="ruby-keyword">end</span>
<span class="line-num">820</span>       <span class="ruby-keyword">end</span>
<span class="line-num">821</span>     <span class="ruby-keyword">end</span>
<span class="line-num">822</span>   <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-place_ancestor_ids_sql">
            
              <b>place_ancestor_ids_sql</b>(place_ids)
            
            <a href="../classes/ListedTaxon.html#method-c-place_ancestor_ids_sql" name="method-c-place_ancestor_ids_sql" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>used with threatened_status filter</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-place_ancestor_ids_sql_source')" id="l_method-c-place_ancestor_ids_sql_source">show</a>
                

                

                
              </p>
              <div id="method-c-place_ancestor_ids_sql_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">914</span>   <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">place_ancestor_ids_sql</span>(<span class="ruby-identifier">place_ids</span>)
<span class="line-num">915</span>     <span class="ruby-identifier">place_ids</span> = [ <span class="ruby-identifier">place_ids</span> ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">916</span>     <span class="ruby-identifier">&lt;&lt;-SQL</span>
<span class="line-num">917</span> <span class="ruby-value">      SELECT DISTINCT 
<span class="line-num">918</span>         regexp_split_to_table(ancestry, &#39;/&#39;) AS ancestor_id 
<span class="line-num">919</span>       FROM places
<span class="line-num">920</span>       WHERE
<span class="line-num">921</span>         id IN (#{ place_ids.join(&quot;,&quot;) }) AND
<span class="line-num">922</span>         ancestry IS NOT NULL
<span class="line-num">923</span> </span><span class="ruby-identifier">    SQL</span>
<span class="line-num">924</span>   <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-reindex_observations">
            
              <b>reindex_observations</b>( taxon_id, place_id )
            
            <a href="../classes/ListedTaxon.html#method-c-reindex_observations" name="method-c-reindex_observations" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-reindex_observations_source')" id="l_method-c-reindex_observations_source">show</a>
                

                

                
              </p>
              <div id="method-c-reindex_observations_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">980</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">reindex_observations</span>( <span class="ruby-identifier">taxon_id</span>, <span class="ruby-identifier">place_id</span> )
<span class="line-num">981</span>   <span class="ruby-identifier">last_id</span> = <span class="ruby-value">0</span>
<span class="line-num">982</span>   <span class="ruby-identifier">per_page</span> = <span class="ruby-value">1000</span>
<span class="line-num">983</span>   <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
<span class="line-num">984</span>     <span class="ruby-identifier">res</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_search</span>(
<span class="line-num">985</span>       <span class="ruby-value">source:</span> [<span class="ruby-string">&quot;id&quot;</span>],
<span class="line-num">986</span>       <span class="ruby-value">sort:</span> { <span class="ruby-value">id:</span> <span class="ruby-string">&quot;asc&quot;</span> },
<span class="line-num">987</span>       <span class="ruby-value">filters:</span> [
<span class="line-num">988</span>         { <span class="ruby-value">range:</span> { <span class="ruby-value">id:</span> { <span class="ruby-value">gt:</span> <span class="ruby-identifier">last_id</span> } } },
<span class="line-num">989</span>         { <span class="ruby-value">term:</span> { <span class="ruby-value">&quot;private_place_ids.keyword&quot;:</span> <span class="ruby-identifier">place_id</span> } },
<span class="line-num">990</span>         { <span class="ruby-value">term:</span> { <span class="ruby-value">&quot;taxon.ancestor_ids.keyword&quot;:</span> <span class="ruby-identifier">taxon_id</span> } }
<span class="line-num">991</span>       ]
<span class="line-num">992</span>     ).<span class="ruby-identifier">per_page</span>( <span class="ruby-identifier">per_page</span> )
<span class="line-num">993</span>     <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">hits</span>.<span class="ruby-identifier">hits</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:_id</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_i</span>)
<span class="line-num">994</span>     <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">995</span>     <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_index!</span>( <span class="ruby-value">delay:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">ids:</span> <span class="ruby-identifier">ids</span> )
<span class="line-num">996</span>     <span class="ruby-identifier">last_id</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">last</span>
<span class="line-num">997</span>   <span class="ruby-keyword">end</span>
<span class="line-num">998</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-species_for_infraspecies">
            
              <b>species_for_infraspecies</b>(lt)
            
            <a href="../classes/ListedTaxon.html#method-c-species_for_infraspecies" name="method-c-species_for_infraspecies" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-species_for_infraspecies_source')" id="l_method-c-species_for_infraspecies_source">show</a>
                

                

                
              </p>
              <div id="method-c-species_for_infraspecies_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">639</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">species_for_infraspecies</span>(<span class="ruby-identifier">lt</span>)
<span class="line-num">640</span>   <span class="ruby-identifier">lt</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:taxon</span>,<span class="ruby-value">:place</span>).<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">lt</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ListedTaxon</span>)
<span class="line-num">641</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lt</span>
<span class="line-num">642</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span> = <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">taxon</span>
<span class="line-num">643</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place</span> = <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">place</span>
<span class="line-num">644</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">parent</span> = <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">parent</span>
<span class="line-num">645</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">species</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:taxon_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:place_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
<span class="line-num">646</span>   <span class="ruby-identifier">lt</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">new</span>(
<span class="line-num">647</span>     <span class="ruby-value">:taxon_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">648</span>     <span class="ruby-value">:place_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">649</span>     <span class="ruby-value">:list_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">place</span>.<span class="ruby-identifier">check_list_id</span>
<span class="line-num">650</span>   )
<span class="line-num">651</span>   <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">save</span>
<span class="line-num">652</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-update_cache_columns_for">
            
              <b>update_cache_columns_for</b>(lt)
            
            <a href="../classes/ListedTaxon.html#method-c-update_cache_columns_for" name="method-c-update_cache_columns_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-update_cache_columns_for_source')" id="l_method-c-update_cache_columns_for_source">show</a>
                

                

                
              </p>
              <div id="method-c-update_cache_columns_for_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">629</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_cache_columns_for</span>(<span class="ruby-identifier">lt</span>)
<span class="line-num">630</span>   <span class="ruby-identifier">lt</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">lt</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ListedTaxon</span>)
<span class="line-num">631</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lt</span>
<span class="line-num">632</span>   <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">set_cache_columns</span>
<span class="line-num">633</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">update_all</span>(
<span class="line-num">634</span>     <span class="ruby-value">first_observation_id:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">first_observation_id</span>,
<span class="line-num">635</span>     <span class="ruby-value">last_observation_id:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">last_observation_id</span>,
<span class="line-num">636</span>     <span class="ruby-value">observations_count:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">observations_count</span>)
<span class="line-num">637</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-update_for_taxon_change">
            
              <b>update_for_taxon_change</b>(taxon_change, options = {})
            
            <a href="../classes/ListedTaxon.html#method-c-update_for_taxon_change" name="method-c-update_for_taxon_change" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-update_for_taxon_change_source')" id="l_method-c-update_for_taxon_change_source">show</a>
                

                

                
              </p>
              <div id="method-c-update_for_taxon_change_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">824</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_for_taxon_change</span>(<span class="ruby-identifier">taxon_change</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">825</span>   <span class="ruby-identifier">input_taxon_ids</span> = <span class="ruby-identifier">taxon_change</span>.<span class="ruby-identifier">input_taxa</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:id</span>)
<span class="line-num">826</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;listed_taxa.taxon_id IN (?)&quot;</span>, <span class="ruby-identifier">input_taxon_ids</span>)
<span class="line-num">827</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>]
<span class="line-num">828</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;listed_taxa.id IN (?)&quot;</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:records</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:records</span>].<span class="ruby-identifier">blank?</span>
<span class="line-num">829</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:conditions</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:conditions</span>]
<span class="line-num">830</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:include</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:include</span>]
<span class="line-num">831</span>   <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lt</span><span class="ruby-operator">|</span>
<span class="line-num">832</span>     <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">force_update_cache_columns</span> = <span class="ruby-keyword">true</span>
<span class="line-num">833</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">output_taxon</span> = <span class="ruby-identifier">taxon_change</span>.<span class="ruby-identifier">output_taxon_for_record</span>( <span class="ruby-identifier">lt</span> )
<span class="line-num">834</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">taxon_change</span>.<span class="ruby-identifier">automatable_for_output?</span>( <span class="ruby-identifier">output_taxon</span>.<span class="ruby-identifier">id</span> )
<span class="line-num">835</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>( <span class="ruby-value">list_id:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">list_id</span>, <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">output_taxon</span>.<span class="ruby-identifier">id</span> ).<span class="ruby-identifier">first</span>
<span class="line-num">836</span>         <span class="ruby-identifier">existing</span>.<span class="ruby-identifier">skip_index_taxon</span> = <span class="ruby-keyword">true</span>
<span class="line-num">837</span>         <span class="ruby-keyword">begin</span>
<span class="line-num">838</span>           <span class="ruby-identifier">existing</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-identifier">lt</span> )
<span class="line-num">839</span>         <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
<span class="line-num">840</span>           <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Failed to update #{lt} for #{taxon_change}: #{e.message}&quot;</span>
<span class="line-num">841</span>         <span class="ruby-keyword">end</span>
<span class="line-num">842</span>       <span class="ruby-keyword">else</span>
<span class="line-num">843</span>         <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">skip_index_taxon</span> = <span class="ruby-keyword">true</span>
<span class="line-num">844</span>         <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">update</span>( <span class="ruby-value">taxon:</span> <span class="ruby-identifier">output_taxon</span> )
<span class="line-num">845</span>       <span class="ruby-keyword">end</span>
<span class="line-num">846</span>     <span class="ruby-keyword">end</span>
<span class="line-num">847</span>     <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">lt</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="line-num">848</span>   <span class="ruby-keyword">end</span>
<span class="line-num">849</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-absent_only_if_not_confirming_observations">
            
              <b>absent_only_if_not_confirming_observations</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-absent_only_if_not_confirming_observations" name="method-i-absent_only_if_not_confirming_observations" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-absent_only_if_not_confirming_observations_source')" id="l_method-i-absent_only_if_not_confirming_observations_source">show</a>
                

                

                
              </p>
              <div id="method-i-absent_only_if_not_confirming_observations_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">279</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">absent_only_if_not_confirming_observations</span>
<span class="line-num">280</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">occurrence_status_level_changed?</span>
<span class="line-num">281</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">absent?</span>
<span class="line-num">282</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">first_observation</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">last_observation</span>
<span class="line-num">283</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:occurrence_status_level</span>, <span class="ruby-string">&quot;can&#39;t be absent if there are confirming observations&quot;</span>)
<span class="line-num">284</span>   <span class="ruby-keyword">end</span>
<span class="line-num">285</span>   <span class="ruby-keyword">true</span>
<span class="line-num">286</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-ancestry">
            
              <b>ancestry</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-ancestry" name="method-i-ancestry" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-ancestry_source')" id="l_method-i-ancestry_source">show</a>
                

                

                
              </p>
              <div id="method-i-ancestry_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">237</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ancestry</span>
<span class="line-num">238</span>   <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestry</span>
<span class="line-num">239</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-as_indexed_json">
            
              <b>as_indexed_json</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-as_indexed_json" name="method-i-as_indexed_json" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-as_indexed_json_source')" id="l_method-i-as_indexed_json_source">show</a>
                

                

                
              </p>
              <div id="method-i-as_indexed_json_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">946</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">as_indexed_json</span>
<span class="line-num">947</span>   {
<span class="line-num">948</span>     <span class="ruby-value">id:</span> <span class="ruby-identifier">id</span>,
<span class="line-num">949</span>     <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>,
<span class="line-num">950</span>     <span class="ruby-value">user_id:</span> <span class="ruby-identifier">user_id</span>,
<span class="line-num">951</span>     <span class="ruby-value">occurrence_status_level:</span> <span class="ruby-identifier">occurrence_status_level</span>,
<span class="line-num">952</span>     <span class="ruby-value">establishment_means:</span> <span class="ruby-identifier">establishment_means</span>
<span class="line-num">953</span>   }
<span class="line-num">954</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-auto_removable_from_check_list-3F">
            
              <b>auto_removable_from_check_list?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-auto_removable_from_check_list-3F" name="method-i-auto_removable_from_check_list-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-auto_removable_from_check_list-3F_source')" id="l_method-i-auto_removable_from_check_list-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-auto_removable_from_check_list-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">709</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">auto_removable_from_check_list?</span>
<span class="line-num">710</span>   <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>) <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">711</span>     <span class="ruby-identifier">first_observation_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">712</span>     <span class="ruby-identifier">last_observation_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">713</span>     <span class="ruby-identifier">taxon_range_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">714</span>     <span class="ruby-identifier">source_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">715</span>     <span class="ruby-operator">!</span><span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> 
<span class="line-num">716</span>     <span class="ruby-operator">!</span><span class="ruby-identifier">updater_id</span> <span class="ruby-operator">&amp;&amp;</span> 
<span class="line-num">717</span>     <span class="ruby-identifier">comments_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">718</span>     <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_default?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">719</span>     <span class="ruby-operator">!</span><span class="ruby-identifier">has_atlas_or_complete_set?</span>
<span class="line-num">720</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-bubble_up_establishment_means">
            
              <b>bubble_up_establishment_means</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-bubble_up_establishment_means" name="method-i-bubble_up_establishment_means" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-bubble_up_establishment_means_source')" id="l_method-i-bubble_up_establishment_means_source">show</a>
                

                

                
              </p>
              <div id="method-i-bubble_up_establishment_means_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">475</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bubble_up_establishment_means</span>
<span class="line-num">476</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;taxon_id = ? AND establishment_means IS NULL AND place_id IN (?)&quot;</span>,
<span class="line-num">477</span>     <span class="ruby-identifier">taxon_id</span>, <span class="ruby-identifier">place</span>.<span class="ruby-identifier">ancestor_ids</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-value">establishment_means:</span> <span class="ruby-identifier">establishment_means</span>)
<span class="line-num">478</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-cache_columns">
            
              <b>cache_columns</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-cache_columns" name="method-i-cache_columns" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Retrieve the first and last observations and the month counts. Note that at present first_observation has a different meaning depending on the list: for check lists it means the first observation added to iNat (i.e. sorted by ID), but for everything else it means first observation by date observed. Not great, but it means the first observer for places rewards people for being the first to add to the site, and the user list firsts on the calendar views shows the first time you saw a taxon.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-cache_columns_source')" id="l_method-i-cache_columns_source">show</a>
                

                

                
              </p>
              <div id="method-i-cache_columns_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">561</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cache_columns</span>
<span class="line-num">562</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>
<span class="line-num">563</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">CheckList</span> )
<span class="line-num">564</span>   <span class="ruby-constant">Logstasher</span>.<span class="ruby-identifier">write_hash</span>(
<span class="line-num">565</span>     <span class="ruby-value">&quot;@timestamp&quot;:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>,
<span class="line-num">566</span>     <span class="ruby-value">subtype:</span> <span class="ruby-string">&quot;ListedTaxon#cache_columns&quot;</span>,
<span class="line-num">567</span>     <span class="ruby-value">model:</span> <span class="ruby-string">&quot;ListedTaxon&quot;</span>,
<span class="line-num">568</span>     <span class="ruby-value">model_id:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">569</span>     <span class="ruby-value">model_method:</span> <span class="ruby-string">&quot;ListedTaxon::cache_columns&quot;</span>
<span class="line-num">570</span>   )
<span class="line-num">571</span>   <span class="ruby-comment"># get the specific options for this list type</span>
<span class="line-num">572</span>   <span class="ruby-identifier">options</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">cache_columns_options</span>(<span class="ruby-keyword">self</span>)
<span class="line-num">573</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">earliest_and_latest_ids</span>(<span class="ruby-identifier">options</span>)
<span class="line-num">574</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-can_set_as_primary-3F">
            
              <b>can_set_as_primary?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-can_set_as_primary-3F" name="method-i-can_set_as_primary-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-can_set_as_primary-3F_source')" id="l_method-i-can_set_as_primary-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-can_set_as_primary-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">876</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">can_set_as_primary?</span>
<span class="line-num">877</span>   <span class="ruby-identifier">list</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">878</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-check_list_editability">
            
              <b>check_list_editability</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-check_list_editability" name="method-i-check_list_editability" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-check_list_editability_source')" id="l_method-i-check_list_editability_source">show</a>
                

                

                
              </p>
              <div id="method-i-check_list_editability_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">336</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check_list_editability</span>
<span class="line-num">337</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">338</span>     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">list</span>.<span class="ruby-identifier">comprehensive?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">user</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_curator?</span>
<span class="line-num">339</span>       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:user</span>, <span class="ruby-string">&quot;must be the list creator or a curator&quot;</span>)
<span class="line-num">340</span>     <span class="ruby-keyword">end</span>
<span class="line-num">341</span>   <span class="ruby-keyword">else</span>
<span class="line-num">342</span>     <span class="ruby-constant">CHECK_LIST_FIELDS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
<span class="line-num">343</span>       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">field</span>, <span class="ruby-string">&quot;can only be set for check lists&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">field</span>).<span class="ruby-identifier">blank?</span>
<span class="line-num">344</span>     <span class="ruby-keyword">end</span>
<span class="line-num">345</span>   <span class="ruby-keyword">end</span>
<span class="line-num">346</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-check_primary_listing">
            
              <b>check_primary_listing</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-check_primary_listing" name="method-i-check_primary_listing" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-check_primary_listing_source')" id="l_method-i-check_primary_listing_source">show</a>
                

                

                
              </p>
              <div id="method-i-check_primary_listing_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">871</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check_primary_listing</span>
<span class="line-num">872</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">primary_listing</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">other_primary_listed_taxa?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">can_set_as_primary?</span>
<span class="line-num">873</span>   <span class="ruby-keyword">true</span>
<span class="line-num">874</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-citation_object">
            
              <b>citation_object</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-citation_object" name="method-i-citation_object" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-citation_object_source')" id="l_method-i-citation_object_source">show</a>
                

                

                
              </p>
              <div id="method-i-citation_object_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">705</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">citation_object</span>
<span class="line-num">706</span>   <span class="ruby-identifier">source</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">taxon_range</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">first_observation</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">last_observation</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">user</span>
<span class="line-num">707</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-editable_by-3F">
            
              <b>editable_by?</b>(target_user)
            
            <a href="../classes/ListedTaxon.html#method-i-editable_by-3F" name="method-i-editable_by-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-editable_by-3F_source')" id="l_method-i-editable_by-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-editable_by-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">692</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">editable_by?</span>(<span class="ruby-identifier">target_user</span>)
<span class="line-num">693</span>   <span class="ruby-identifier">list</span>.<span class="ruby-identifier">editable_by?</span>(<span class="ruby-identifier">target_user</span>)
<span class="line-num">694</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-endemic-3F">
            
              <b>endemic?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-endemic-3F" name="method-i-endemic-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-endemic-3F_source')" id="l_method-i-endemic-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-endemic-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">730</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">endemic?</span>
<span class="line-num">731</span>   <span class="ruby-identifier">establishment_means</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;endemic&quot;</span>
<span class="line-num">732</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-establishment_means_allowed">
            
              <b>establishment_means_allowed</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-establishment_means_allowed" name="method-i-establishment_means_allowed" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-establishment_means_allowed_source')" id="l_method-i-establishment_means_allowed_source">show</a>
                

                

                
              </p>
              <div id="method-i-establishment_means_allowed_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">348</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">establishment_means_allowed</span>
<span class="line-num">349</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">endemic?</span>
<span class="line-num">350</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">place</span> <span class="ruby-operator">&amp;&amp;</span> ( ( <span class="ruby-identifier">place</span>.<span class="ruby-identifier">admin_level</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">admin_level</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">CONTINENT_LEVEL</span> ) <span class="ruby-operator">||</span> ( <span class="ruby-identifier">place</span>.<span class="ruby-identifier">place_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">CONTINENT</span> ) )
<span class="line-num">351</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>( <span class="ruby-value">:establishment_means</span>, <span class="ruby-string">&quot;can&#39;t be endemic for continents&quot;</span> )
<span class="line-num">352</span>   <span class="ruby-keyword">end</span>
<span class="line-num">353</span>   <span class="ruby-keyword">true</span>
<span class="line-num">354</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-establishment_means_description">
            
              <b>establishment_means_description</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-establishment_means_description" name="method-i-establishment_means_description" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-establishment_means_description_source')" id="l_method-i-establishment_means_description_source">show</a>
                

                

                
              </p>
              <div id="method-i-establishment_means_description_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">960</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">establishment_means_description</span>
<span class="line-num">961</span>   <span class="ruby-comment"># I18n.t( &quot;establishment_means_descriptions.native&quot; )</span>
<span class="line-num">962</span>   <span class="ruby-comment"># I18n.t( &quot;establishment_means_descriptions.endemic&quot; )</span>
<span class="line-num">963</span>   <span class="ruby-comment"># I18n.t( &quot;establishment_means_descriptions.introduced&quot; )</span>
<span class="line-num">964</span>   <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>( <span class="ruby-node">&quot;establishment_means_descriptions.#{establishment_means}&quot;</span> )
<span class="line-num">965</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-establishment_means_label">
            
              <b>establishment_means_label</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-establishment_means_label" name="method-i-establishment_means_label" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-establishment_means_label_source')" id="l_method-i-establishment_means_label_source">show</a>
                

                

                
              </p>
              <div id="method-i-establishment_means_label_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">956</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">establishment_means_label</span>
<span class="line-num">957</span>   <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>( <span class="ruby-node">&quot;establishment.#{establishment_means}&quot;</span>, <span class="ruby-value">default:</span> <span class="ruby-identifier">establishment_means</span> ).<span class="ruby-identifier">capitalize</span>
<span class="line-num">958</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-existing_comprehensive_list">
            
              <b>existing_comprehensive_list</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-existing_comprehensive_list" name="method-i-existing_comprehensive_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-existing_comprehensive_list_source')" id="l_method-i-existing_comprehensive_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-existing_comprehensive_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">261</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">existing_comprehensive_list</span>
<span class="line-num">262</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">263</span>   <span class="ruby-keyword">return</span> <span class="ruby-ivar">@existing_comprehensive_list</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@existing_comprehensive_list</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">264</span>   <span class="ruby-identifier">places</span> = [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">place</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">place</span>]
<span class="line-num">265</span>   <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">places</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">do</span>
<span class="line-num">266</span>     <span class="ruby-identifier">places</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">places</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">parent</span>
<span class="line-num">267</span>   <span class="ruby-keyword">end</span>
<span class="line-num">268</span>   <span class="ruby-identifier">places</span>.<span class="ruby-identifier">compact!</span>
<span class="line-num">269</span>   <span class="ruby-ivar">@existing_comprehensive_list</span> = <span class="ruby-constant">CheckList</span>.<span class="ruby-identifier">where</span>([
<span class="line-num">270</span>     <span class="ruby-string">&quot;comprehensive = &#39;t&#39; AND id != ? AND taxon_id IN (?) AND place_id IN (?)&quot;</span>, 
<span class="line-num">271</span>     <span class="ruby-identifier">list_id</span>, <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestor_ids</span>, <span class="ruby-identifier">places</span>]).<span class="ruby-identifier">first</span>
<span class="line-num">272</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-existing_comprehensive_listed_taxon">
            
              <b>existing_comprehensive_listed_taxon</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-existing_comprehensive_listed_taxon" name="method-i-existing_comprehensive_listed_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-existing_comprehensive_listed_taxon_source')" id="l_method-i-existing_comprehensive_listed_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-existing_comprehensive_listed_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">274</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">existing_comprehensive_listed_taxon</span>
<span class="line-num">275</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existing_comprehensive_list</span>
<span class="line-num">276</span>   <span class="ruby-ivar">@existing_listed_taxon</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">existing_comprehensive_list</span>.<span class="ruby-identifier">listed_taxa</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>).<span class="ruby-identifier">first</span>
<span class="line-num">277</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-expire_caches">
            
              <b>expire_caches</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-expire_caches" name="method-i-expire_caches" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-expire_caches_source')" id="l_method-i-expire_caches_source">show</a>
                

                

                
              </p>
              <div id="method-i-expire_caches_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">746</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expire_caches</span>
<span class="line-num">747</span>   <span class="ruby-identifier">ctrl</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>
<span class="line-num">748</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">place_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">manually_added</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">CheckList</span> )
<span class="line-num">749</span>     <span class="ruby-constant">I18N_SUPPORTED_LOCALES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">locale</span><span class="ruby-operator">|</span>
<span class="line-num">750</span>       <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:expire_action</span>, <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">url_for</span>( <span class="ruby-value">controller:</span> <span class="ruby-string">&quot;places&quot;</span>, <span class="ruby-value">action:</span> <span class="ruby-string">&quot;cached_guide&quot;</span>, <span class="ruby-value">id:</span> <span class="ruby-identifier">place_id</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span> ) )
<span class="line-num">751</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">place</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">place</span>.<span class="ruby-identifier">slug</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">752</span>         <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:expire_action</span>, <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">url_for</span>( <span class="ruby-value">controller:</span> <span class="ruby-string">&quot;places&quot;</span>, <span class="ruby-value">action:</span> <span class="ruby-string">&quot;cached_guide&quot;</span>, <span class="ruby-value">id:</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">slug</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span> ) )
<span class="line-num">753</span>       <span class="ruby-keyword">end</span>
<span class="line-num">754</span>     <span class="ruby-keyword">end</span>
<span class="line-num">755</span>   <span class="ruby-keyword">end</span>
<span class="line-num">756</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>
<span class="line-num">757</span>     <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_page</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">list_path</span>(<span class="ruby-identifier">list_id</span>, <span class="ruby-value">:format</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;csv&#39;</span>)
<span class="line-num">758</span>     <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_page</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">list_show_formatted_view_path</span>(<span class="ruby-identifier">list_id</span>, <span class="ruby-value">:format</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;csv&#39;</span>, <span class="ruby-value">:view_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;taxonomic&#39;</span>)
<span class="line-num">759</span>     <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_page</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">list_path</span>(<span class="ruby-identifier">list</span>, <span class="ruby-value">:format</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;csv&#39;</span>)
<span class="line-num">760</span>     <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_page</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">list_show_formatted_view_path</span>(<span class="ruby-identifier">list</span>, <span class="ruby-value">:format</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;csv&#39;</span>, <span class="ruby-value">:view_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;taxonomic&#39;</span>)
<span class="line-num">761</span>     <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_fragment</span>(<span class="ruby-constant">List</span>.<span class="ruby-identifier">icon_preview_cache_key</span>(<span class="ruby-identifier">list_id</span>))
<span class="line-num">762</span>     <span class="ruby-constant">ListedTaxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ORDERS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">order</span><span class="ruby-operator">|</span>
<span class="line-num">763</span>       <span class="ruby-identifier">ctrl</span>.<span class="ruby-identifier">expire_fragment</span>(<span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;observations&#39;</span>, <span class="ruby-value">:action</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;add_from_list&#39;</span>, <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">list_id</span>, <span class="ruby-value">:order</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">order</span>))
<span class="line-num">764</span>     <span class="ruby-keyword">end</span>
<span class="line-num">765</span>   <span class="ruby-keyword">end</span>
<span class="line-num">766</span>   <span class="ruby-keyword">true</span>
<span class="line-num">767</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-has_atlas_or_complete_set-3F">
            
              <b>has_atlas_or_complete_set?</b>(options = {})
            
            <a href="../classes/ListedTaxon.html#method-i-has_atlas_or_complete_set-3F" name="method-i-has_atlas_or_complete_set-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-has_atlas_or_complete_set-3F_source')" id="l_method-i-has_atlas_or_complete_set-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-has_atlas_or_complete_set-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">494</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">has_atlas_or_complete_set?</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">495</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">CheckList</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_default?</span>
<span class="line-num">496</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> [<span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">COUNTRY_LEVEL</span>, <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">STATE_LEVEL</span>, <span class="ruby-constant">Place</span><span class="ruby-operator">::</span><span class="ruby-constant">COUNTY_LEVEL</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">admin_level</span>
<span class="line-num">497</span>   <span class="ruby-identifier">relevant_taxon</span> = <span class="ruby-identifier">taxon</span>
<span class="line-num">498</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:taxon_was</span>]
<span class="line-num">499</span>     <span class="ruby-identifier">relevant_taxon</span> = <span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:taxon_was</span>]).<span class="ruby-identifier">first</span>
<span class="line-num">500</span>   <span class="ruby-keyword">end</span>
<span class="line-num">501</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">relevant_taxon</span>
<span class="line-num">502</span>   <span class="ruby-identifier">place_ancestor_place_ids</span> = <span class="ruby-identifier">place</span>.<span class="ruby-identifier">ancestor_place_ids</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> [<span class="ruby-identifier">place_id</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">ancestor_place_ids</span>
<span class="line-num">503</span>   <span class="ruby-identifier">atlas_ids</span> = <span class="ruby-constant">Atlas</span>.<span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;is_active = true AND taxon_id IN (?)&quot;</span>, <span class="ruby-identifier">relevant_taxon</span>.<span class="ruby-identifier">self_and_ancestor_ids</span> ).<span class="ruby-identifier">pluck</span>( <span class="ruby-value">:id</span> )
<span class="line-num">504</span>   <span class="ruby-comment"># there are atlases for this taxon or ancestors and this place isn&#39;t</span>
<span class="line-num">505</span>   <span class="ruby-comment"># exploded for all matching atlases, therefore this action is relevant</span>
<span class="line-num">506</span>   <span class="ruby-comment"># to some atlas and should be logged</span>
<span class="line-num">507</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">atlas_ids</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">508</span>     <span class="ruby-constant">ExplodedAtlasPlace</span>.<span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;atlas_id IN ( ? )&quot;</span>, <span class="ruby-identifier">atlas_ids</span> ).
<span class="line-num">509</span>       <span class="ruby-identifier">where</span>( <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">id</span> ).<span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">atlas_ids</span>.<span class="ruby-identifier">length</span>
<span class="line-num">510</span>   <span class="ruby-identifier">cs</span> = <span class="ruby-constant">CompleteSet</span>.
<span class="line-num">511</span>     <span class="ruby-identifier">where</span>( <span class="ruby-string">&quot;is_active = true&quot;</span>).
<span class="line-num">512</span>     <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;taxon_id IN ( ? ) AND place_id IN ( ? )&quot;</span>, <span class="ruby-identifier">relevant_taxon</span>.<span class="ruby-identifier">self_and_ancestor_ids</span>, <span class="ruby-identifier">place_ancestor_place_ids</span> ).
<span class="line-num">513</span>     <span class="ruby-identifier">count</span>
<span class="line-num">514</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">515</span>   <span class="ruby-keyword">false</span>
<span class="line-num">516</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-index_taxon">
            
              <b>index_taxon</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-index_taxon" name="method-i-index_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-index_taxon_source')" id="l_method-i-index_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-index_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">423</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">index_taxon</span>
<span class="line-num">424</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">skip_index_taxon</span>
<span class="line-num">425</span>     <span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>, <span class="ruby-value">run_at:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">hour</span>.<span class="ruby-identifier">from_now</span>,
<span class="line-num">426</span>       <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;Taxon::elastic_index&quot;:</span> <span class="ruby-identifier">taxon_id</span> }).
<span class="line-num">427</span>       <span class="ruby-identifier">elastic_index!</span>(<span class="ruby-value">ids:</span> [<span class="ruby-identifier">taxon_id</span>])
<span class="line-num">428</span>   <span class="ruby-keyword">end</span>
<span class="line-num">429</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-introduced-3F">
            
              <b>introduced?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-introduced-3F" name="method-i-introduced-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-introduced-3F_source')" id="l_method-i-introduced-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-introduced-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">722</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">introduced?</span>
<span class="line-num">723</span>   <span class="ruby-constant">INTRODUCED_EQUIVALENTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">establishment_means</span>)
<span class="line-num">724</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-is_absent-3F">
            
              <b>is_absent?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-is_absent-3F" name="method-i-is_absent-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-is_absent-3F_source')" id="l_method-i-is_absent-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-is_absent-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">688</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_absent?</span>
<span class="line-num">689</span>   <span class="ruby-operator">!</span><span class="ruby-identifier">is_present?</span>
<span class="line-num">690</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-is_present-3F">
            
              <b>is_present?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-is_present-3F" name="method-i-is_present-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-is_present-3F_source')" id="l_method-i-is_present-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-is_present-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">684</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_present?</span>
<span class="line-num">685</span>   <span class="ruby-constant">PRESENT_EQUIVALENTS</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">occurrence_status_level</span> ) <span class="ruby-operator">||</span> <span class="ruby-identifier">occurrence_status_level</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">686</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-list_rules_pass">
            
              <b>list_rules_pass</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-list_rules_pass" name="method-i-list_rules_pass" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-list_rules_pass_source')" id="l_method-i-list_rules_pass_source">show</a>
                

                

                
              </p>
              <div id="method-i-list_rules_pass_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">288</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_rules_pass</span>
<span class="line-num">289</span>   <span class="ruby-comment"># don&#39;t bother if validates_presence_of(:taxon) has already failed</span>
<span class="line-num">290</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">errors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:taxon</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">291</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span> 
<span class="line-num">292</span>       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">293</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">manually_added?</span>
<span class="line-num">294</span>           <span class="ruby-keyword">next</span>
<span class="line-num">295</span>         <span class="ruby-keyword">end</span>
<span class="line-num">296</span>         <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-node">&quot;#{taxon.to_plain_s} is not #{rule.terms}&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">validates?</span>(<span class="ruby-keyword">self</span>)
<span class="line-num">297</span>       <span class="ruby-keyword">end</span>
<span class="line-num">298</span>     <span class="ruby-keyword">end</span>
<span class="line-num">299</span>   <span class="ruby-keyword">end</span>
<span class="line-num">300</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-log_create">
            
              <b>log_create</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-log_create" name="method-i-log_create" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-log_create_source')" id="l_method-i-log_create_source">show</a>
                

                

                
              </p>
              <div id="method-i-log_create_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">518</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">log_create</span>
<span class="line-num">519</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_atlas_or_complete_set?</span>
<span class="line-num">520</span>     <span class="ruby-constant">ListedTaxonAlteration</span>.<span class="ruby-identifier">create</span>(
<span class="line-num">521</span>       <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>,
<span class="line-num">522</span>       <span class="ruby-value">user_id:</span> <span class="ruby-identifier">user_id</span>,
<span class="line-num">523</span>       <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>,
<span class="line-num">524</span>       <span class="ruby-value">action:</span> <span class="ruby-string">&quot;listed&quot;</span>
<span class="line-num">525</span>     )
<span class="line-num">526</span>   <span class="ruby-keyword">end</span>
<span class="line-num">527</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-log_create_if_taxon_id_changed">
            
              <b>log_create_if_taxon_id_changed</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-log_create_if_taxon_id_changed" name="method-i-log_create_if_taxon_id_changed" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-log_create_if_taxon_id_changed_source')" id="l_method-i-log_create_if_taxon_id_changed_source">show</a>
                

                

                
              </p>
              <div id="method-i-log_create_if_taxon_id_changed_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">541</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">log_create_if_taxon_id_changed</span>
<span class="line-num">542</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">saved_change_to_taxon_id?</span>
<span class="line-num">543</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon_id_before_last_save</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">544</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_atlas_or_complete_set?</span>(<span class="ruby-value">taxon_was:</span> <span class="ruby-identifier">taxon_id_before_last_save</span>)
<span class="line-num">545</span>     <span class="ruby-constant">ListedTaxonAlteration</span>.<span class="ruby-identifier">create</span>(
<span class="line-num">546</span>       <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>,
<span class="line-num">547</span>       <span class="ruby-value">user_id:</span> <span class="ruby-keyword">nil</span>,
<span class="line-num">548</span>       <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>,
<span class="line-num">549</span>       <span class="ruby-value">action:</span> <span class="ruby-string">&quot;listed&quot;</span>
<span class="line-num">550</span>     )
<span class="line-num">551</span>   <span class="ruby-keyword">end</span>
<span class="line-num">552</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-log_destroy">
            
              <b>log_destroy</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-log_destroy" name="method-i-log_destroy" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-log_destroy_source')" id="l_method-i-log_destroy_source">show</a>
                

                

                
              </p>
              <div id="method-i-log_destroy_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">529</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">log_destroy</span>
<span class="line-num">530</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_atlas_or_complete_set?</span>
<span class="line-num">531</span>     <span class="ruby-identifier">updater_id</span> = <span class="ruby-identifier">updater</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">updater</span>.<span class="ruby-identifier">id</span>
<span class="line-num">532</span>     <span class="ruby-constant">ListedTaxonAlteration</span>.<span class="ruby-identifier">create</span>(
<span class="line-num">533</span>       <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>,
<span class="line-num">534</span>       <span class="ruby-value">user_id:</span> <span class="ruby-identifier">updater_id</span>,
<span class="line-num">535</span>       <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>,
<span class="line-num">536</span>       <span class="ruby-value">action:</span> <span class="ruby-string">&quot;unlisted&quot;</span>
<span class="line-num">537</span>     )
<span class="line-num">538</span>   <span class="ruby-keyword">end</span>
<span class="line-num">539</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-make_primary_if_no_primary_exists">
            
              <b>make_primary_if_no_primary_exists</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-make_primary_if_no_primary_exists" name="method-i-make_primary_if_no_primary_exists" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-make_primary_if_no_primary_exists_source')" id="l_method-i-make_primary_if_no_primary_exists_source">show</a>
                

                

                
              </p>
              <div id="method-i-make_primary_if_no_primary_exists_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">909</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">make_primary_if_no_primary_exists</span>
<span class="line-num">910</span>   <span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:primary_listing</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>({<span class="ruby-value">taxon_id:</span><span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>, <span class="ruby-value">primary_listing:</span> <span class="ruby-keyword">true</span>}).<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">can_set_as_primary?</span>
<span class="line-num">911</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-merge">
            
              <b>merge</b>(reject)
            
            <a href="../classes/ListedTaxon.html#method-i-merge" name="method-i-merge" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-merge_source')" id="l_method-i-merge_source">show</a>
                

                

                
              </p>
              <div id="method-i-merge_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">777</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge</span>(<span class="ruby-identifier">reject</span>)
<span class="line-num">778</span>   <span class="ruby-identifier">mutable_columns</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">column_names</span> <span class="ruby-operator">-</span> <span class="ruby-node">%w(id created_at updated_at)</span>
<span class="line-num">779</span>   <span class="ruby-identifier">mutable_columns</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
<span class="line-num">780</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{column}=&quot;</span>, <span class="ruby-identifier">reject</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">column</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">column</span>).<span class="ruby-identifier">blank?</span>
<span class="line-num">781</span>   <span class="ruby-keyword">end</span>
<span class="line-num">782</span>   <span class="ruby-identifier">merge_has_many_associations</span>(<span class="ruby-identifier">reject</span>)
<span class="line-num">783</span>   <span class="ruby-identifier">reject</span>.<span class="ruby-identifier">destroy</span>
<span class="line-num">784</span>   <span class="ruby-identifier">save!</span>
<span class="line-num">785</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-multiple_primary_listed_taxa-3F">
            
              <b>multiple_primary_listed_taxa?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-multiple_primary_listed_taxa-3F" name="method-i-multiple_primary_listed_taxa-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-multiple_primary_listed_taxa-3F_source')" id="l_method-i-multiple_primary_listed_taxa-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-multiple_primary_listed_taxa-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">861</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">multiple_primary_listed_taxa?</span>
<span class="line-num">862</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>( <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>, <span class="ruby-value">primary_listing:</span> <span class="ruby-keyword">true</span> )
<span class="line-num">863</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id != ?&quot;</span>, <span class="ruby-identifier">id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>
<span class="line-num">864</span>   <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="line-num">865</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-native-3F">
            
              <b>native?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-native-3F" name="method-i-native-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-native-3F_source')" id="l_method-i-native-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-native-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">726</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">native?</span>
<span class="line-num">727</span>   <span class="ruby-constant">NATIVE_EQUIVALENTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">establishment_means</span>)
<span class="line-num">728</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-nilify_blanks">
            
              <b>nilify_blanks</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-nilify_blanks" name="method-i-nilify_blanks" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-nilify_blanks_source')" id="l_method-i-nilify_blanks_source">show</a>
                

                

                
              </p>
              <div id="method-i-nilify_blanks_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">669</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">nilify_blanks</span>
<span class="line-num">670</span>   <span class="ruby-node">%w(establishment_means occurrence_status_level)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
<span class="line-num">671</span>     <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{col}=&quot;</span>, <span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">col</span>).<span class="ruby-identifier">blank?</span>
<span class="line-num">672</span>   <span class="ruby-keyword">end</span>
<span class="line-num">673</span>   <span class="ruby-keyword">true</span>
<span class="line-num">674</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-not_on_a_comprehensive_check_list">
            
              <b>not_on_a_comprehensive_check_list</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-not_on_a_comprehensive_check_list" name="method-i-not_on_a_comprehensive_check_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-not_on_a_comprehensive_check_list_source')" id="l_method-i-not_on_a_comprehensive_check_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-not_on_a_comprehensive_check_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">249</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">not_on_a_comprehensive_check_list</span>
<span class="line-num">250</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">251</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">252</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">first_observation_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">last_observation_id</span>
<span class="line-num">253</span>   <span class="ruby-identifier">target_place</span> = <span class="ruby-identifier">place</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">place</span>
<span class="line-num">254</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existing_comprehensive_list</span>
<span class="line-num">255</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existing_comprehensive_listed_taxon</span>
<span class="line-num">256</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:taxon_id</span>, <span class="ruby-node">&quot;isn&#39;t on the comprehensive list \&quot;#{existing_comprehensive_list.title}\&quot; (#{existing_comprehensive_list.id})&quot;</span>)
<span class="line-num">257</span>   <span class="ruby-keyword">end</span>
<span class="line-num">258</span>   <span class="ruby-keyword">true</span>
<span class="line-num">259</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-observed_in_place-3F">
            
              <b>observed_in_place?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-observed_in_place-3F" name="method-i-observed_in_place-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-observed_in_place-3F_source')" id="l_method-i-observed_in_place-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-observed_in_place-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">787</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">observed_in_place?</span>
<span class="line-num">788</span>   <span class="ruby-identifier">p</span> = <span class="ruby-identifier">place</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">place</span>
<span class="line-num">789</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">p</span>
<span class="line-num">790</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:observations_places</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;observations_places.place_id = ?&quot;</span>, <span class="ruby-identifier">p</span>).<span class="ruby-identifier">of</span>(<span class="ruby-identifier">taxon</span>)
<span class="line-num">791</span>   <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">exists?</span>
<span class="line-num">792</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-occurrence_status">
            
              <b>occurrence_status</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-occurrence_status" name="method-i-occurrence_status" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-occurrence_status_source')" id="l_method-i-occurrence_status_source">show</a>
                

                

                
              </p>
              <div id="method-i-occurrence_status_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">676</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">occurrence_status</span>
<span class="line-num">677</span>   <span class="ruby-constant">OCCURRENCE_STATUS_LEVELS</span>[<span class="ruby-identifier">occurrence_status_level</span>]
<span class="line-num">678</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-occurrence_status-3D">
            
              <b>occurrence_status=</b>(status)
            
            <a href="../classes/ListedTaxon.html#method-i-occurrence_status-3D" name="method-i-occurrence_status-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-occurrence_status-3D_source')" id="l_method-i-occurrence_status-3D_source">show</a>
                

                

                
              </p>
              <div id="method-i-occurrence_status-3D_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">680</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">occurrence_status=</span>(<span class="ruby-identifier">status</span>)
<span class="line-num">681</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">occurrence_status_level</span> = <span class="ruby-constant">OCCURRENCE_STATUS_LEVELS_BY_NAME</span>[<span class="ruby-identifier">status</span>]
<span class="line-num">682</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-other_primary_listed_taxa-3F">
            
              <b>other_primary_listed_taxa?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-other_primary_listed_taxa-3F" name="method-i-other_primary_listed_taxa-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-other_primary_listed_taxa-3F_source')" id="l_method-i-other_primary_listed_taxa-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-other_primary_listed_taxa-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">855</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">other_primary_listed_taxa?</span>
<span class="line-num">856</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>( <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>, <span class="ruby-value">primary_listing:</span> <span class="ruby-keyword">true</span> )
<span class="line-num">857</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id != ?&quot;</span>, <span class="ruby-identifier">id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>
<span class="line-num">858</span>   <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">859</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-primary_establishment_means">
            
              <b>primary_establishment_means</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-primary_establishment_means" name="method-i-primary_establishment_means" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-primary_establishment_means_source')" id="l_method-i-primary_establishment_means_source">show</a>
                

                

                
              </p>
              <div id="method-i-primary_establishment_means_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">930</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_establishment_means</span>
<span class="line-num">931</span>   <span class="ruby-identifier">primary_listed_taxon</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:establishment_means</span>)
<span class="line-num">932</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-primary_listed_taxon">
            
              <b>primary_listed_taxon</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-primary_listed_taxon" name="method-i-primary_listed_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-primary_listed_taxon_source')" id="l_method-i-primary_listed_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-primary_listed_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">867</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_listed_taxon</span>
<span class="line-num">868</span>   <span class="ruby-identifier">primary_listing</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>( <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>, <span class="ruby-value">primary_listing:</span> <span class="ruby-keyword">true</span> ).<span class="ruby-identifier">first</span>
<span class="line-num">869</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-primary_occurrence_status">
            
              <b>primary_occurrence_status</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-primary_occurrence_status" name="method-i-primary_occurrence_status" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-primary_occurrence_status_source')" id="l_method-i-primary_occurrence_status_source">show</a>
                

                

                
              </p>
              <div id="method-i-primary_occurrence_status_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">926</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_occurrence_status</span>
<span class="line-num">927</span>   <span class="ruby-identifier">primary_listed_taxon</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:occurrence_status</span>)
<span class="line-num">928</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-propagate_establishment_means">
            
              <b>propagate_establishment_means</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-propagate_establishment_means" name="method-i-propagate_establishment_means" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-propagate_establishment_means_source')" id="l_method-i-propagate_establishment_means_source">show</a>
                

                

                
              </p>
              <div id="method-i-propagate_establishment_means_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">462</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">propagate_establishment_means</span>
<span class="line-num">463</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">464</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">force_trickle_down_establishment_means</span>.<span class="ruby-identifier">yesish?</span>
<span class="line-num">465</span>     <span class="ruby-identifier">trickle_down_establishment_means</span>(<span class="ruby-value">:force</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>)
<span class="line-num">466</span>   <span class="ruby-keyword">end</span>
<span class="line-num">467</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">saved_change_to_establishment_means?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">establishment_means</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">468</span>   <span class="ruby-identifier">bubble_up_establishment_means</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">native?</span>
<span class="line-num">469</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">introduced?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">force_trickle_down_establishment_means</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">470</span>     <span class="ruby-identifier">trickle_down_establishment_means</span>
<span class="line-num">471</span>   <span class="ruby-keyword">end</span>
<span class="line-num">472</span>   <span class="ruby-keyword">true</span>
<span class="line-num">473</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-reassign_primary_listed_taxon">
            
              <b>reassign_primary_listed_taxon</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-reassign_primary_listed_taxon" name="method-i-reassign_primary_listed_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-reassign_primary_listed_taxon_source')" id="l_method-i-reassign_primary_listed_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-reassign_primary_listed_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">887</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reassign_primary_listed_taxon</span>
<span class="line-num">888</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">primary_listing</span>
<span class="line-num">889</span>   <span class="ruby-identifier">related_listed_taxon</span> = <span class="ruby-identifier">related_listed_taxa</span>.<span class="ruby-identifier">first</span>
<span class="line-num">890</span>   <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:primary_listing</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">related_listed_taxon</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">list_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">place_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">can_set_as_primary?</span>
<span class="line-num">891</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-reindex_observations_later">
            
              <b>reindex_observations_later</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-reindex_observations_later" name="method-i-reindex_observations_later" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-reindex_observations_later_source')" id="l_method-i-reindex_observations_later_source">show</a>
                

                

                
              </p>
              <div id="method-i-reindex_observations_later_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">967</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reindex_observations_later</span>
<span class="line-num">968</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">place_id</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">969</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">saved_change_to_establishment_means?</span>
<span class="line-num">970</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">delay</span>(
<span class="line-num">971</span>     <span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">972</span>     <span class="ruby-value">unique_hash:</span> {
<span class="line-num">973</span>       <span class="ruby-value">&quot;CheckList::reindex_observations_later.taxon_id&quot;:</span> <span class="ruby-identifier">taxon_id</span>,
<span class="line-num">974</span>       <span class="ruby-value">&quot;CheckList::reindex_observations_later.place_id&quot;:</span> <span class="ruby-identifier">place_id</span>,
<span class="line-num">975</span>     }
<span class="line-num">976</span>   ).<span class="ruby-identifier">reindex_observations</span>( <span class="ruby-identifier">taxon_id</span>, <span class="ruby-identifier">place_id</span> )
<span class="line-num">977</span>   <span class="ruby-keyword">true</span>
<span class="line-num">978</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-related_listed_taxa">
            
              <b>related_listed_taxa</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-related_listed_taxa" name="method-i-related_listed_taxa" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-related_listed_taxa_source')" id="l_method-i-related_listed_taxa_source">show</a>
                

                

                
              </p>
              <div id="method-i-related_listed_taxa_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">851</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">related_listed_taxa</span>
<span class="line-num">852</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id != ?&quot;</span>, <span class="ruby-identifier">id</span>)
<span class="line-num">853</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-removable_by-3F">
            
              <b>removable_by?</b>(target_user)
            
            <a href="../classes/ListedTaxon.html#method-i-removable_by-3F" name="method-i-removable_by-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-removable_by-3F_source')" id="l_method-i-removable_by-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-removable_by-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">696</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">removable_by?</span>(<span class="ruby-identifier">target_user</span>)
<span class="line-num">697</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">target_user</span>
<span class="line-num">698</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_user</span>
<span class="line-num">699</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">target_user</span>.<span class="ruby-identifier">admin?</span>
<span class="line-num">700</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ProjectList</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">project</span>.<span class="ruby-identifier">curated_by?</span>(<span class="ruby-identifier">target_user</span>)
<span class="line-num">701</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">citation_object</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">702</span>   <span class="ruby-identifier">citation_object</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_user</span>
<span class="line-num">703</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-remove_other_primary_listings">
            
              <b>remove_other_primary_listings</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-remove_other_primary_listings" name="method-i-remove_other_primary_listings" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-remove_other_primary_listings_source')" id="l_method-i-remove_other_primary_listings_source">show</a>
                

                

                
              </p>
              <div id="method-i-remove_other_primary_listings_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">880</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_other_primary_listings</span>
<span class="line-num">881</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">primary_listing</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">multiple_primary_listed_taxa?</span>
<span class="line-num">882</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;taxon_id = ? AND place_id = ? AND id != ?&quot;</span>,
<span class="line-num">883</span>     <span class="ruby-identifier">taxon_id</span>, <span class="ruby-identifier">place_id</span>, <span class="ruby-identifier">id</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-value">primary_listing:</span> <span class="ruby-keyword">false</span>)
<span class="line-num">884</span>   <span class="ruby-keyword">true</span>
<span class="line-num">885</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_cache_columns">
            
              <b>set_cache_columns</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_cache_columns" name="method-i-set_cache_columns" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_cache_columns_source')" id="l_method-i-set_cache_columns_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_cache_columns_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">439</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_cache_columns</span>
<span class="line-num">440</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon_id</span>
<span class="line-num">441</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">cc</span> = <span class="ruby-identifier">cache_columns</span>
<span class="line-num">442</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_observation_id</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_observation_id</span>,
<span class="line-num">443</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observations_count</span> = <span class="ruby-identifier">cc</span>
<span class="line-num">444</span>   <span class="ruby-keyword">end</span>
<span class="line-num">445</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_establishment_means">
            
              <b>set_establishment_means</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_establishment_means" name="method-i-set_establishment_means" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_establishment_means_source')" id="l_method-i-set_establishment_means_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_establishment_means_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">380</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_establishment_means</span>
<span class="line-num">381</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">establishment_means</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">382</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">383</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">introduced_ancestor_listed_taxon</span> = <span class="ruby-constant">ListedTaxon</span>.
<span class="line-num">384</span>       <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;place_id IN (?)&quot;</span>, <span class="ruby-identifier">place</span>.<span class="ruby-identifier">ancestor_ids</span>).
<span class="line-num">385</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">:taxon_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon_id</span>).
<span class="line-num">386</span>       <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;establishment_means IN (?)&quot;</span>, <span class="ruby-constant">INTRODUCED_EQUIVALENTS</span>).
<span class="line-num">387</span>       <span class="ruby-identifier">first</span>
<span class="line-num">388</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">establishment_means</span> = <span class="ruby-identifier">introduced_ancestor_listed_taxon</span>.<span class="ruby-identifier">establishment_means</span>
<span class="line-num">389</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">native_child_listed_taxon</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:place</span>).
<span class="line-num">390</span>       <span class="ruby-identifier">where</span>(<span class="ruby-identifier">place</span>.<span class="ruby-identifier">descendant_conditions</span>).
<span class="line-num">391</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">:taxon_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon_id</span>).
<span class="line-num">392</span>       <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;establishment_means IN (?)&quot;</span>, <span class="ruby-constant">NATIVE_EQUIVALENTS</span>).
<span class="line-num">393</span>       <span class="ruby-identifier">first</span>
<span class="line-num">394</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">establishment_means</span> = <span class="ruby-identifier">native_child_listed_taxon</span>.<span class="ruby-identifier">establishment_means</span>
<span class="line-num">395</span>   <span class="ruby-keyword">end</span>
<span class="line-num">396</span>   <span class="ruby-keyword">true</span>
<span class="line-num">397</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_old_list">
            
              <b>set_old_list</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_old_list" name="method-i-set_old_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_old_list_source')" id="l_method-i-set_old_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_old_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">356</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_old_list</span>
<span class="line-num">357</span>   <span class="ruby-ivar">@old_list</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">list</span>
<span class="line-num">358</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_place_id">
            
              <b>set_place_id</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_place_id" name="method-i-set_place_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_place_id_source')" id="l_method-i-set_place_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_place_id_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">375</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_place_id</span>
<span class="line-num">376</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">place_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">list</span>.<span class="ruby-identifier">place_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">377</span>   <span class="ruby-keyword">true</span>
<span class="line-num">378</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_primary_listing">
            
              <b>set_primary_listing</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_primary_listing" name="method-i-set_primary_listing" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_primary_listing_source')" id="l_method-i-set_primary_listing_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_primary_listing_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">399</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_primary_listing</span>
<span class="line-num">400</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">primary_listing</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">can_set_as_primary?</span>
<span class="line-num">401</span>   <span class="ruby-keyword">true</span>
<span class="line-num">402</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_source_id">
            
              <b>set_source_id</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_source_id" name="method-i-set_source_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_source_id_source')" id="l_method-i-set_source_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_source_id_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">365</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_source_id</span>
<span class="line-num">366</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">source_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">source_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>
<span class="line-num">367</span>   <span class="ruby-keyword">true</span>
<span class="line-num">368</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_updater_id">
            
              <b>set_updater_id</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_updater_id" name="method-i-set_updater_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_updater_id_source')" id="l_method-i-set_updater_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_updater_id_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">370</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_updater_id</span>
<span class="line-num">371</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updater_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">user_id</span>
<span class="line-num">372</span>   <span class="ruby-keyword">true</span>
<span class="line-num">373</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_user_id">
            
              <b>set_user_id</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-set_user_id" name="method-i-set_user_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_user_id_source')" id="l_method-i-set_user_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_user_id_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">360</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_user_id</span>
<span class="line-num">361</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>
<span class="line-num">362</span>   <span class="ruby-keyword">true</span>
<span class="line-num">363</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-sync_parent_check_list">
            
              <b>sync_parent_check_list</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-sync_parent_check_list" name="method-i-sync_parent_check_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-sync_parent_check_list_source')" id="l_method-i-sync_parent_check_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-sync_parent_check_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">404</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sync_parent_check_list</span>
<span class="line-num">405</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">406</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_sync_with_parent</span>
<span class="line-num">407</span>   <span class="ruby-identifier">list</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">408</span>     <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;CheckList::sync_with_parent&quot;:</span> <span class="ruby-identifier">list_id</span> }).
<span class="line-num">409</span>     <span class="ruby-identifier">sync_with_parent</span>(<span class="ruby-value">:time_since_last_sync</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">updated_at</span>)
<span class="line-num">410</span>   <span class="ruby-keyword">true</span>
<span class="line-num">411</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-sync_species_if_infraspecies">
            
              <b>sync_species_if_infraspecies</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-sync_species_if_infraspecies" name="method-i-sync_species_if_infraspecies" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-sync_species_if_infraspecies_source')" id="l_method-i-sync_species_if_infraspecies_source">show</a>
                

                

                
              </p>
              <div id="method-i-sync_species_if_infraspecies_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">413</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sync_species_if_infraspecies</span>
<span class="line-num">414</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_species_for_infraspecies</span>
<span class="line-num">415</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">416</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">infraspecies?</span>
<span class="line-num">417</span>   <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>, <span class="ruby-value">run_at:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">hour</span>.<span class="ruby-identifier">from_now</span>,
<span class="line-num">418</span>     <span class="ruby-value">queue:</span> <span class="ruby-string">&quot;slow&quot;</span>, <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ListedTaxon::species_for_infraspecies&quot;:</span> <span class="ruby-identifier">id</span> }).
<span class="line-num">419</span>     <span class="ruby-identifier">species_for_infraspecies</span>(<span class="ruby-identifier">id</span>)
<span class="line-num">420</span>   <span class="ruby-keyword">true</span>
<span class="line-num">421</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_common_name">
            
              <b>taxon_common_name</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-taxon_common_name" name="method-i-taxon_common_name" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_common_name_source')" id="l_method-i-taxon_common_name_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_common_name_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">738</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_common_name</span>
<span class="line-num">739</span>   <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">common_name</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:name</span>)
<span class="line-num">740</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_matches_curator_identification-3F">
            
              <b>taxon_matches_curator_identification?</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-taxon_matches_curator_identification-3F" name="method-i-taxon_matches_curator_identification-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_matches_curator_identification-3F_source')" id="l_method-i-taxon_matches_curator_identification-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_matches_curator_identification-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">317</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_matches_curator_identification?</span>
<span class="line-num">318</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ProjectList</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">last_observation</span>
<span class="line-num">319</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="line-num">320</span>   <span class="ruby-keyword">end</span>
<span class="line-num">321</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">po</span> = <span class="ruby-constant">ProjectObservation</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:project_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">project_id</span>, <span class="ruby-value">:observation_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">last_observation</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
<span class="line-num">322</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="line-num">323</span>   <span class="ruby-keyword">end</span>
<span class="line-num">324</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ident</span> = <span class="ruby-constant">Identification</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">po</span>.<span class="ruby-identifier">curator_identification_id</span>)
<span class="line-num">325</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="line-num">326</span>   <span class="ruby-keyword">end</span>
<span class="line-num">327</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">ident</span>.<span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span>(
<span class="line-num">328</span>       <span class="ruby-identifier">taxon_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">ident</span>.<span class="ruby-identifier">taxon_id</span> <span class="ruby-operator">||</span> 
<span class="line-num">329</span>       <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestor_of?</span>(<span class="ruby-identifier">ident</span>.<span class="ruby-identifier">taxon</span>) <span class="ruby-operator">||</span> 
<span class="line-num">330</span>       <span class="ruby-identifier">ident</span>.<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestor_of?</span>(<span class="ruby-identifier">taxon</span>))
<span class="line-num">331</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="line-num">332</span>   <span class="ruby-keyword">end</span>
<span class="line-num">333</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">334</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_matches_observation">
            
              <b>taxon_matches_observation</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-taxon_matches_observation" name="method-i-taxon_matches_observation" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_matches_observation_source')" id="l_method-i-taxon_matches_observation_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_matches_observation_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">302</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_matches_observation</span>
<span class="line-num">303</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">304</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_observation</span>
<span class="line-num">305</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_observation</span>.<span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span>(
<span class="line-num">306</span>         <span class="ruby-identifier">taxon_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">last_observation</span>.<span class="ruby-identifier">taxon_id</span> <span class="ruby-operator">||</span> 
<span class="line-num">307</span>         <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestor_of?</span>(<span class="ruby-identifier">last_observation</span>.<span class="ruby-identifier">taxon</span>) <span class="ruby-operator">||</span> 
<span class="line-num">308</span>         <span class="ruby-identifier">last_observation</span>.<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestor_of?</span>(<span class="ruby-identifier">taxon</span>))
<span class="line-num">309</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon_matches_curator_identification?</span> <span class="ruby-comment">#cases where project listed_taxon is based on curator_id</span>
<span class="line-num">310</span>         <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">311</span>       <span class="ruby-keyword">end</span>
<span class="line-num">312</span>       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:taxon_id</span>, <span class="ruby-node">&quot;must be the same as the last observed taxon, #{last_observation.taxon.try(:to_plain_s)}&quot;</span>)
<span class="line-num">313</span>     <span class="ruby-keyword">end</span>
<span class="line-num">314</span>   <span class="ruby-keyword">end</span>
<span class="line-num">315</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_name">
            
              <b>taxon_name</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-taxon_name" name="method-i-taxon_name" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_name_source')" id="l_method-i-taxon_name_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_name_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">734</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_name</span>
<span class="line-num">735</span>   <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">name</span>
<span class="line-num">736</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_plain_s">
            
              <b>to_plain_s</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-to_plain_s" name="method-i-to_plain_s" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-to_plain_s_source')" id="l_method-i-to_plain_s_source">show</a>
                

                

                
              </p>
              <div id="method-i-to_plain_s_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">245</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_plain_s</span>
<span class="line-num">246</span>   <span class="ruby-node">&quot;#{taxon.default_name.name} on #{list.title}&quot;</span>
<span class="line-num">247</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_s">
            
              <b>to_s</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-to_s" name="method-i-to_s" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-to_s_source')" id="l_method-i-to_s_source">show</a>
                

                

                
              </p>
              <div id="method-i-to_s_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">241</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_s</span>
<span class="line-num">242</span>   <span class="ruby-node">&quot;&lt;ListedTaxon #{self.id}: taxon_id: #{self.taxon_id} list_id: #{self.list_id} place_id: #{place_id}&gt;&quot;</span>
<span class="line-num">243</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-trickle_down_establishment_means">
            
              <b>trickle_down_establishment_means</b>(options = {})
            
            <a href="../classes/ListedTaxon.html#method-i-trickle_down_establishment_means" name="method-i-trickle_down_establishment_means" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-trickle_down_establishment_means_source')" id="l_method-i-trickle_down_establishment_means_source">show</a>
                

                

                
              </p>
              <div id="method-i-trickle_down_establishment_means_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">480</span>   <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">trickle_down_establishment_means</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">481</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">&lt;&lt;-SQL</span>
<span class="line-num">482</span> <span class="ruby-value">      UPDATE listed_taxa
<span class="line-num">483</span>       SET establishment_means = &#39;#{establishment_means}&#39;
<span class="line-num">484</span>       FROM places
<span class="line-num">485</span>       WHERE 
<span class="line-num">486</span>         listed_taxa.place_id = places.id
<span class="line-num">487</span>         #{&quot;AND (establishment_means IS NULL OR establishment_means = &#39;&#39;)&quot; unless options[:force]}
<span class="line-num">488</span>         AND listed_taxa.taxon_id = #{taxon_id}
<span class="line-num">489</span>         AND (#{Place.send(:sanitize_sql, place.descendant_conditions.to_sql)})
<span class="line-num">490</span> </span><span class="ruby-identifier">    SQL</span>
<span class="line-num">491</span>     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">492</span>   <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_and_primary">
            
              <b>update_and_primary</b>(listed_taxon, current_user)
            
            <a href="../classes/ListedTaxon.html#method-i-update_and_primary" name="method-i-update_and_primary" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_and_primary_source')" id="l_method-i-update_and_primary_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_and_primary_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">934</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_and_primary</span>(<span class="ruby-identifier">listed_taxon</span>, <span class="ruby-identifier">current_user</span>)
<span class="line-num">935</span>   <span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
<span class="line-num">936</span>     <span class="ruby-identifier">update</span>(<span class="ruby-identifier">listed_taxon</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:updater_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>))
<span class="line-num">937</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">primary_listed_taxon</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">primary_listed_taxon</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>
<span class="line-num">938</span>       <span class="ruby-identifier">primary_listed_taxon</span>.<span class="ruby-identifier">update</span>(
<span class="line-num">939</span>         <span class="ruby-value">occurrence_status_level:</span> <span class="ruby-identifier">listed_taxon</span>[<span class="ruby-string">&#39;occurrence_status_level&#39;</span>],
<span class="line-num">940</span>         <span class="ruby-value">establishment_means:</span> <span class="ruby-identifier">listed_taxon</span>[<span class="ruby-string">&#39;establishment_means&#39;</span>]
<span class="line-num">941</span>       )
<span class="line-num">942</span>     <span class="ruby-keyword">end</span>
<span class="line-num">943</span>   <span class="ruby-keyword">end</span>
<span class="line-num">944</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_cache_columns">
            
              <b>update_cache_columns</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-update_cache_columns" name="method-i-update_cache_columns" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_cache_columns_source')" id="l_method-i-update_cache_columns_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_cache_columns_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">431</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_cache_columns</span>
<span class="line-num">432</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_update_cache_columns</span>
<span class="line-num">433</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">force_update_cache_columns</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">place_id</span>.<span class="ruby-identifier">blank?</span>)
<span class="line-num">434</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">primary_listing</span>
<span class="line-num">435</span>   <span class="ruby-identifier">set_cache_columns</span>
<span class="line-num">436</span>   <span class="ruby-keyword">true</span>
<span class="line-num">437</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_cache_columns_for_check_list">
            
              <b>update_cache_columns_for_check_list</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-update_cache_columns_for_check_list" name="method-i-update_cache_columns_for_check_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_cache_columns_for_check_list_source')" id="l_method-i-update_cache_columns_for_check_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_cache_columns_for_check_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">447</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_cache_columns_for_check_list</span>
<span class="line-num">448</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_update_cache_columns</span>
<span class="line-num">449</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CheckList</span>)
<span class="line-num">450</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">primary_listing</span>
<span class="line-num">451</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">force_update_cache_columns</span>
<span class="line-num">452</span>       <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>, <span class="ruby-value">run_at:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">hour</span>.<span class="ruby-identifier">from_now</span>,
<span class="line-num">453</span>         <span class="ruby-value">queue:</span> <span class="ruby-string">&quot;slow&quot;</span>, <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ListedTaxon::update_cache_columns_for&quot;:</span> <span class="ruby-identifier">id</span> }).
<span class="line-num">454</span>         <span class="ruby-identifier">update_cache_columns_for</span>(<span class="ruby-identifier">id</span>)
<span class="line-num">455</span>     <span class="ruby-keyword">end</span>
<span class="line-num">456</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">primary_listed_taxon</span>
<span class="line-num">457</span>     <span class="ruby-identifier">primary_listed_taxon</span>.<span class="ruby-identifier">update_on_related_listed_taxa</span>
<span class="line-num">458</span>   <span class="ruby-keyword">end</span>
<span class="line-num">459</span>   <span class="ruby-keyword">true</span>
<span class="line-num">460</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_on_related_listed_taxa">
            
              <b>update_on_related_listed_taxa</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-update_on_related_listed_taxa" name="method-i-update_on_related_listed_taxa" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_on_related_listed_taxa_source')" id="l_method-i-update_on_related_listed_taxa_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_on_related_listed_taxa_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">893</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_on_related_listed_taxa</span>
<span class="line-num">894</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">primary_listing</span>
<span class="line-num">895</span>   <span class="ruby-identifier">related_listed_taxa</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">related_listed_taxon</span><span class="ruby-operator">|</span>
<span class="line-num">896</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">primary_listing</span> = <span class="ruby-keyword">false</span>
<span class="line-num">897</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">establishment_means</span> = <span class="ruby-identifier">establishment_means</span>
<span class="line-num">898</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">first_observation_id</span> = <span class="ruby-identifier">first_observation_id</span>
<span class="line-num">899</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">last_observation_id</span> = <span class="ruby-identifier">last_observation_id</span> 
<span class="line-num">900</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">observations_count</span> = <span class="ruby-identifier">observations_count</span>
<span class="line-num">901</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">occurrence_status_level</span> = <span class="ruby-identifier">occurrence_status_level</span>
<span class="line-num">902</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">skip_index_taxon</span> = <span class="ruby-keyword">true</span>
<span class="line-num">903</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">skip_update_cache_columns</span> = <span class="ruby-keyword">true</span>
<span class="line-num">904</span>     <span class="ruby-identifier">related_listed_taxon</span>.<span class="ruby-identifier">save</span>
<span class="line-num">905</span>   <span class="ruby-keyword">end</span>
<span class="line-num">906</span>   <span class="ruby-keyword">true</span>
<span class="line-num">907</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-user_login">
            
              <b>user_login</b>()
            
            <a href="../classes/ListedTaxon.html#method-i-user_login" name="method-i-user_login" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-user_login_source')" id="l_method-i-user_login_source">show</a>
                

                

                
              </p>
              <div id="method-i-user_login_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/listed_taxon.rb</span>
<span class="line-num">742</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">user_login</span>
<span class="line-num">743</span>   <span class="ruby-identifier">user</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:login</span>)
<span class="line-num">744</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
