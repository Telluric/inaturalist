<!DOCTYPE html>
<html lang="en">
<head>
    <title>TaxaHelper</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/panel.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/turbolinks.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/search_index.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../panel/tree.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searchdoc.js" type="text/javascript" charset="utf-8"></script>
<meta name="data-rel-prefix" content="../">
<meta name="data-tree-keys" content='["TaxaHelper"]'>


    <meta property="og:title" value="TaxaHelper">

  
    
    <meta name="description" content="encoding: utf-8.">
    <meta property="og:description" content="encoding: utf-8.">
  

    <meta name="keywords" content="TaxaHelper class, merge_taxa, taxon_image, taxon_image_url, iconic_taxon_image, iconic_taxon_image_url, default_taxon_name, common_taxon_name, capitalize_piece, capitalize_name, jit_taxon_node, jit_taxon_tree_with_taxon, abbreviate_binomial, remote_taxon_images, taxon_to_json, iconic_taxon_color, taxon_range_kml_url">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Module</span>
            TaxaHelper
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/app/helpers/taxa_helper_rb.html">app/helpers/taxa_helper.rb</a></li>
            
        </ul>
        
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>encoding: utf-8</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-abbreviate_binomial">abbreviate_binomial</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-capitalize_name">capitalize_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-capitalize_piece">capitalize_piece</a>,
              </li>
            
              
              <li>
                <a href="#method-i-common_taxon_name">common_taxon_name</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-default_taxon_name">default_taxon_name</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-iconic_taxon_color">iconic_taxon_color</a>,
              </li>
            
              
              <li>
                <a href="#method-i-iconic_taxon_image">iconic_taxon_image</a>,
              </li>
            
              
              <li>
                <a href="#method-i-iconic_taxon_image_url">iconic_taxon_image_url</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>J</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-jit_taxon_node">jit_taxon_node</a>,
              </li>
            
              
              <li>
                <a href="#method-i-jit_taxon_tree_with_taxon">jit_taxon_tree_with_taxon</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-merge_taxa">merge_taxa</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-remote_taxon_images">remote_taxon_images</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-taxon_image">taxon_image</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_image_url">taxon_image_url</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_range_kml_url">taxon_range_kml_url</a>,
              </li>
            
              
              <li>
                <a href="#method-i-taxon_to_json">taxon_to_json</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            ActionView::Helpers::AssetTagHelper
          
        </li>
      
    </ul>
  



  

    

    

    


    


    <!-- Methods -->
    
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-abbreviate_binomial">
            
              <b>abbreviate_binomial</b>(name)
            
            <a href="../classes/TaxaHelper.html#method-i-abbreviate_binomial" name="method-i-abbreviate_binomial" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Abbreviate a binomal / trinomail name string.  Homo sapiens =&gt; H. sapiens</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-abbreviate_binomial_source')" id="l_method-i-abbreviate_binomial_source">show</a>
                

                

                
              </p>
              <div id="method-i-abbreviate_binomial_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">259</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">abbreviate_binomial</span>(<span class="ruby-identifier">name</span>)
<span class="line-num">260</span>   (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">upcase</span>} <span class="ruby-operator">+</span> [<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">last</span>]).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;. &#39;</span>)
<span class="line-num">261</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-capitalize_name">
            
              <b>capitalize_name</b>( comname )
            
            <a href="../classes/TaxaHelper.html#method-i-capitalize_name" name="method-i-capitalize_name" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-capitalize_name_source')" id="l_method-i-capitalize_name_source">show</a>
                

                

                
              </p>
              <div id="method-i-capitalize_name_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">182</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capitalize_name</span>( <span class="ruby-identifier">comname</span> )
<span class="line-num">183</span>   <span class="ruby-identifier">uncapitalized</span> = [
<span class="line-num">184</span>     <span class="ruby-string">&quot;à&quot;</span>,
<span class="line-num">185</span>     <span class="ruby-string">&quot;a&quot;</span>,
<span class="line-num">186</span>     <span class="ruby-string">&quot;and&quot;</span>,
<span class="line-num">187</span>     <span class="ruby-string">&quot;con&quot;</span>,
<span class="line-num">188</span>     <span class="ruby-string">&quot;da&quot;</span>,
<span class="line-num">189</span>     <span class="ruby-string">&quot;dal&quot;</span>,
<span class="line-num">190</span>     <span class="ruby-string">&quot;de&quot;</span>,
<span class="line-num">191</span>     <span class="ruby-string">&quot;dei&quot;</span>,
<span class="line-num">192</span>     <span class="ruby-string">&quot;del&quot;</span>,
<span class="line-num">193</span>     <span class="ruby-string">&quot;des&quot;</span>,
<span class="line-num">194</span>     <span class="ruby-string">&quot;di&quot;</span>,
<span class="line-num">195</span>     <span class="ruby-string">&quot;du&quot;</span>,
<span class="line-num">196</span>     <span class="ruby-string">&quot;e&quot;</span>,
<span class="line-num">197</span>     <span class="ruby-string">&quot;in&quot;</span>,
<span class="line-num">198</span>     <span class="ruby-string">&quot;la&quot;</span>,
<span class="line-num">199</span>     <span class="ruby-string">&quot;o&quot;</span>,
<span class="line-num">200</span>     <span class="ruby-string">&quot;on&quot;</span>,
<span class="line-num">201</span>     <span class="ruby-string">&quot;of&quot;</span>,
<span class="line-num">202</span>     <span class="ruby-string">&quot;the&quot;</span>
<span class="line-num">203</span>   ]
<span class="line-num">204</span>   <span class="ruby-identifier">comname_pieces</span> = <span class="ruby-identifier">comname</span>.<span class="ruby-identifier">split</span>( <span class="ruby-regexp">/\s+/</span> )
<span class="line-num">205</span>   <span class="ruby-identifier">comname_pieces</span>.<span class="ruby-identifier">each_with_index</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">piece</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
<span class="line-num">206</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">uncapitalized</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">downcase</span> )
<span class="line-num">207</span>       <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">downcase</span>
<span class="line-num">208</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">comname_pieces</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
<span class="line-num">209</span>       <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">split</span>( <span class="ruby-string">&quot;-&quot;</span> ).<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">uncapitalized</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> ) <span class="ruby-operator">?</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">capitalize_piece</span>( <span class="ruby-identifier">s</span> ) }.<span class="ruby-identifier">join</span>( <span class="ruby-string">&quot;-&quot;</span> )
<span class="line-num">210</span>     <span class="ruby-keyword">else</span>
<span class="line-num">211</span>       <span class="ruby-identifier">capitalize_piece</span>( <span class="ruby-identifier">piece</span> )
<span class="line-num">212</span>     <span class="ruby-keyword">end</span>
<span class="line-num">213</span>   }.<span class="ruby-identifier">join</span>( <span class="ruby-string">&quot; &quot;</span> )
<span class="line-num">214</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-capitalize_piece">
            
              <b>capitalize_piece</b>( piece )
            
            <a href="../classes/TaxaHelper.html#method-i-capitalize_piece" name="method-i-capitalize_piece" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-capitalize_piece_source')" id="l_method-i-capitalize_piece_source">show</a>
                

                

                
              </p>
              <div id="method-i-capitalize_piece_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">165</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capitalize_piece</span>( <span class="ruby-identifier">piece</span> )
<span class="line-num">166</span>   <span class="ruby-comment"># \p{Word} matches any word in Unicode, \w does not, apparently</span>
<span class="line-num">167</span>   <span class="ruby-comment"># https://stackoverflow.com/questions/3576232/how-to-match-unicode-words-with-ruby-1-9#3576559</span>
<span class="line-num">168</span> 
<span class="line-num">169</span>   <span class="ruby-comment"># Match contractions like d&#39;Silva</span>
<span class="line-num">170</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">bits</span> = <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">match</span>( <span class="ruby-regexp">/^([a-z][&#39;’])(\p{Word}+)/</span> )
<span class="line-num">171</span>     <span class="ruby-node">&quot;#{bits[1]}#{bits[2].capitalize}&quot;</span>
<span class="line-num">172</span>   <span class="ruby-comment"># Match okina and similar leading punctuation characters that will match \p{Word}</span>
<span class="line-num">173</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">bits</span> = <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">match</span>( <span class="ruby-regexp">/^([ʻ])(\p{Word}+)/</span>)
<span class="line-num">174</span>     <span class="ruby-node">&quot;#{bits[1]}#{bits[2].capitalize}&quot;</span>
<span class="line-num">175</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">bits</span> = <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">match</span>( <span class="ruby-regexp">/(.*?)(\p{Word}+)(.*)/</span> )
<span class="line-num">176</span>     <span class="ruby-node">&quot;#{bits[1]}#{bits[2].capitalize}#{bits[3]}&quot;</span>
<span class="line-num">177</span>   <span class="ruby-keyword">else</span>
<span class="line-num">178</span>     <span class="ruby-identifier">piece</span>
<span class="line-num">179</span>   <span class="ruby-keyword">end</span>
<span class="line-num">180</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-common_taxon_name">
            
              <b>common_taxon_name</b>(taxon, options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-common_taxon_name" name="method-i-common_taxon_name" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-common_taxon_name_source')" id="l_method-i-common_taxon_name_source">show</a>
                

                

                
              </p>
              <div id="method-i-common_taxon_name_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">149</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">common_taxon_name</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">150</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">151</span>   <span class="ruby-identifier">user</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>]
<span class="line-num">152</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>]
<span class="line-num">153</span>   <span class="ruby-keyword">else</span>
<span class="line-num">154</span>     <span class="ruby-ivar">@user</span>
<span class="line-num">155</span>   <span class="ruby-keyword">end</span>
<span class="line-num">156</span>   <span class="ruby-identifier">site</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:site</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@site</span>
<span class="line-num">157</span>   <span class="ruby-constant">TaxonName</span>.<span class="ruby-identifier">choose_common_name</span>(
<span class="line-num">158</span>     <span class="ruby-ivar">@taxon_names_by_taxon_id</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@taxon_names_by_taxon_id</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">taxon_names</span>,
<span class="line-num">159</span>     <span class="ruby-value">place:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:place</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:place</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:place</span>),
<span class="line-num">160</span>     <span class="ruby-value">locale:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:locale</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:locale</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:locale</span>),
<span class="line-num">161</span>     <span class="ruby-value">user:</span> <span class="ruby-identifier">user</span>
<span class="line-num">162</span>   )
<span class="line-num">163</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-default_taxon_name">
            
              <b>default_taxon_name</b>(taxon, options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-default_taxon_name" name="method-i-default_taxon_name" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Return a default name string for this taxon, English common if available.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-default_taxon_name_source')" id="l_method-i-default_taxon_name_source">show</a>
                

                

                
              </p>
              <div id="method-i-default_taxon_name_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">135</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">default_taxon_name</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">136</span>   <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">137</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:use_iconic_taxon_display_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_iconic?</span> <span class="ruby-operator">&amp;&amp;</span> 
<span class="line-num">138</span>       <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXON_DISPLAY_NAMES</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">name</span>]
<span class="line-num">139</span>     <span class="ruby-keyword">return</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXON_DISPLAY_NAMES</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">name</span>]
<span class="line-num">140</span>   <span class="ruby-keyword">end</span>
<span class="line-num">141</span>   <span class="ruby-identifier">tn</span> = <span class="ruby-constant">TaxonName</span>.<span class="ruby-identifier">choose_default_name</span>(
<span class="line-num">142</span>     <span class="ruby-ivar">@taxon_names_by_taxon_id</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@taxon_names_by_taxon_id</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">taxon_names</span>
<span class="line-num">143</span>   )
<span class="line-num">144</span>   <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tn</span>
<span class="line-num">145</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">tn</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tn</span>.<span class="ruby-identifier">is_scientific_names?</span>
<span class="line-num">146</span>   <span class="ruby-identifier">capitalize_name</span>( <span class="ruby-identifier">tn</span>.<span class="ruby-identifier">name</span> )
<span class="line-num">147</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-iconic_taxon_color">
            
              <b>iconic_taxon_color</b>(taxon)
            
            <a href="../classes/TaxaHelper.html#method-i-iconic_taxon_color" name="method-i-iconic_taxon_color" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-iconic_taxon_color_source')" id="l_method-i-iconic_taxon_color_source">show</a>
                

                

                
              </p>
              <div id="method-i-iconic_taxon_color_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">297</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">iconic_taxon_color</span>(<span class="ruby-identifier">taxon</span>)
<span class="line-num">298</span>   <span class="ruby-identifier">taxon</span> = <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXA_BY_ID</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">to_i</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Taxon</span>)
<span class="line-num">299</span>   <span class="ruby-identifier">taxon</span> = <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXA_BY_ID</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">iconic_taxon_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_iconic?</span>
<span class="line-num">300</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:name</span>)
<span class="line-num">301</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Animalia&quot;</span>, <span class="ruby-string">&quot;Actinopterygii&quot;</span>, <span class="ruby-string">&quot;Amphibia&quot;</span>, <span class="ruby-string">&quot;Reptilia&quot;</span>, <span class="ruby-string">&quot;Aves&quot;</span>, <span class="ruby-string">&quot;Mammalia&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;1E90FF&quot;</span>
<span class="line-num">302</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Insecta&quot;</span>, <span class="ruby-string">&quot;Arachnida&quot;</span>, <span class="ruby-string">&quot;Mollusca&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;FF4500&quot;</span>
<span class="line-num">303</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Plantae&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;73AC13&quot;</span>
<span class="line-num">304</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Fungi&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;FF1493&quot;</span>
<span class="line-num">305</span>   <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Protozoa&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;691776&quot;</span>
<span class="line-num">306</span>   <span class="ruby-keyword">else</span> <span class="ruby-keyword">nil</span>
<span class="line-num">307</span>   <span class="ruby-keyword">end</span>
<span class="line-num">308</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-iconic_taxon_image">
            
              <b>iconic_taxon_image</b>(taxon, params = {})
            
            <a href="../classes/TaxaHelper.html#method-i-iconic_taxon_image" name="method-i-iconic_taxon_image" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Image tag for an iconic taxon icon.  Takes the same params as <a href="TaxaHelper.html#method-i-iconic_taxon_image_url"><code>iconic_taxon_image_url</code></a> and image_tag</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-iconic_taxon_image_source')" id="l_method-i-iconic_taxon_image_source">show</a>
                

                

                
              </p>
              <div id="method-i-iconic_taxon_image_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">83</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">iconic_taxon_image</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span> = {})
<span class="line-num">84</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">iconic_taxon_image_url</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span>)
<span class="line-num">85</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:color</span>)
<span class="line-num">86</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:size</span>)
<span class="line-num">87</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:class</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:class</span>] <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{params[:class]} iconic&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;iconic&#39;</span>
<span class="line-num">88</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXON_DISPLAY_NAMES</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:name</span>)]
<span class="line-num">89</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:alt</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXON_DISPLAY_NAMES</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:name</span>)]
<span class="line-num">90</span>   <span class="ruby-identifier">image_tag</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">params</span>).<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;utf-8&#39;</span>)
<span class="line-num">91</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-iconic_taxon_image_url">
            
              <b>iconic_taxon_image_url</b>(taxon, params = {})
            
            <a href="../classes/TaxaHelper.html#method-i-iconic_taxon_image_url" name="method-i-iconic_taxon_image_url" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>URL of this taxon&#39;s icon, using the following convention</p>

<pre><code>/assets/iconic_taxa/[taxon_name]-[color]-[size]px.png
</code></pre>

<p>where :color and :size are values you can pass in as params.  Right now, it returns a path for the taxon&#39;s iconic_taxon, or itself if it IS an iconic taxon.  If/when we support chosen images for taxa (instead of just photos tagged with the scientific name), maybe we should use one of them as the icon for non-iconic taxa…</p>

<p>Example:</p>

<pre><code>&gt;&gt; iconic_taxon_image_url(Taxon.find_by_name(&#39;Aves&#39;))
=&gt; &quot;/assets/iconic_taxa/aves.png&quot;
&gt;&gt; iconic_taxon_image_url(Taxon.find_by_name(&#39;Aves&#39;), :color =&gt; &#39;ffaa00&#39;, :size =&gt; 20)
=&gt; &quot;/assets/iconic_taxa/aves-ffaa00-20px.png&quot;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-iconic_taxon_image_url_source')" id="l_method-i-iconic_taxon_image_url_source">show</a>
                

                

                
              </p>
              <div id="method-i-iconic_taxon_image_url_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">110</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">iconic_taxon_image_url</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span> = {})
<span class="line-num">111</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>] = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
<span class="line-num">112</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">75</span>
<span class="line-num">113</span>   <span class="ruby-identifier">iconic_taxon</span> = <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXA_BY_ID</span>[<span class="ruby-identifier">taxon</span>]
<span class="line-num">114</span>   <span class="ruby-identifier">iconic_taxon</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span>
<span class="line-num">115</span>     <span class="ruby-identifier">taxon</span> = <span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">taxon</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Taxon</span>)
<span class="line-num">116</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">117</span>       <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">is_iconic?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">taxon</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">ICONIC_TAXA_BY_ID</span>[<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">iconic_taxon_id</span>]
<span class="line-num">118</span>     <span class="ruby-keyword">end</span>
<span class="line-num">119</span>   <span class="ruby-keyword">end</span>
<span class="line-num">120</span>   <span class="ruby-identifier">path</span> = <span class="ruby-string">&#39;iconic_taxa/&#39;</span>
<span class="line-num">121</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">iconic_taxon</span>
<span class="line-num">122</span>     <span class="ruby-identifier">path</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">iconic_taxon</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>
<span class="line-num">123</span>   <span class="ruby-keyword">else</span>
<span class="line-num">124</span>     <span class="ruby-identifier">path</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;unknown&#39;</span>
<span class="line-num">125</span>   <span class="ruby-keyword">end</span>
<span class="line-num">126</span>   <span class="ruby-identifier">path</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:color</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:color</span>]
<span class="line-num">127</span>   <span class="ruby-identifier">path</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;-%spx&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>]
<span class="line-num">128</span>   <span class="ruby-identifier">path</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;.png&#39;</span>
<span class="line-num">129</span>   <span class="ruby-identifier">image_url</span>(<span class="ruby-identifier">path</span>)
<span class="line-num">130</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-jit_taxon_node">
            
              <b>jit_taxon_node</b>(taxon, options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-jit_taxon_node" name="method-i-jit_taxon_node" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-jit_taxon_node_source')" id="l_method-i-jit_taxon_node_source">show</a>
                

                

                
              </p>
              <div id="method-i-jit_taxon_node_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">216</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">jit_taxon_node</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">217</span>   <span class="ruby-identifier">options</span>[<span class="ruby-value">:depth</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">1</span>
<span class="line-num">218</span>   <span class="ruby-identifier">node</span> = {
<span class="line-num">219</span>     <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">220</span>     <span class="ruby-value">:name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">name</span>,
<span class="line-num">221</span>     <span class="ruby-value">:data</span> <span class="ruby-operator">=&gt;</span> {
<span class="line-num">222</span>       <span class="ruby-value">:wikipedia_summary</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">wikipedia_summary</span>
<span class="line-num">223</span>     }
<span class="line-num">224</span>   }
<span class="line-num">225</span>   <span class="ruby-identifier">node</span>[<span class="ruby-value">:children</span>] = []
<span class="line-num">226</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:depth</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="line-num">227</span>     <span class="ruby-identifier">node</span>[<span class="ruby-value">:children</span>] = <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
<span class="line-num">228</span>       <span class="ruby-identifier">jit_taxon_node</span>(<span class="ruby-identifier">c</span>, <span class="ruby-value">:depth</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:depth</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
<span class="line-num">229</span>     <span class="ruby-keyword">end</span>
<span class="line-num">230</span>   <span class="ruby-keyword">end</span>
<span class="line-num">231</span>   <span class="ruby-identifier">node</span>[<span class="ruby-value">:data</span>][<span class="ruby-value">:html</span>] = <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
<span class="line-num">232</span>     <span class="ruby-identifier">render_to_string</span>(<span class="ruby-value">:partial</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;taxa/taxon.html.erb&#39;</span>, <span class="ruby-value">:object</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>)
<span class="line-num">233</span>   <span class="ruby-keyword">else</span>
<span class="line-num">234</span>     <span class="ruby-identifier">render</span>(<span class="ruby-value">:partial</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;taxa/taxon.html.erb&#39;</span>, <span class="ruby-value">:object</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>)
<span class="line-num">235</span>   <span class="ruby-keyword">end</span>
<span class="line-num">236</span> 
<span class="line-num">237</span>   <span class="ruby-identifier">node</span>
<span class="line-num">238</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-jit_taxon_tree_with_taxon">
            
              <b>jit_taxon_tree_with_taxon</b>(taxon)
            
            <a href="../classes/TaxaHelper.html#method-i-jit_taxon_tree_with_taxon" name="method-i-jit_taxon_tree_with_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-jit_taxon_tree_with_taxon_source')" id="l_method-i-jit_taxon_tree_with_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-jit_taxon_tree_with_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">240</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">jit_taxon_tree_with_taxon</span>(<span class="ruby-identifier">taxon</span>)
<span class="line-num">241</span>   <span class="ruby-identifier">ancestors</span> = <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">self_and_ancestors</span>
<span class="line-num">242</span>   <span class="ruby-identifier">root</span> = <span class="ruby-identifier">jit_taxon_node</span>(<span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">first</span>)
<span class="line-num">243</span>   <span class="ruby-identifier">previous_node</span> = <span class="ruby-identifier">root</span>
<span class="line-num">244</span>   <span class="ruby-identifier">ancestors</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ancestor</span><span class="ruby-operator">|</span>
<span class="line-num">245</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;[DEBUG] Trying to place #{ancestor} among the children of #{previous_node[:name]}...&quot;</span>
<span class="line-num">246</span>     <span class="ruby-identifier">ancestor_node</span> = <span class="ruby-identifier">jit_taxon_node</span>(<span class="ruby-identifier">ancestor</span>)
<span class="line-num">247</span>     <span class="ruby-comment"># Replace the child with a child with its own children</span>
<span class="line-num">248</span>     <span class="ruby-identifier">previous_node</span>[<span class="ruby-value">:children</span>].<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
<span class="line-num">249</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">child</span>[<span class="ruby-value">:id</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">ancestor</span>.<span class="ruby-identifier">id</span>
<span class="line-num">250</span>       <span class="ruby-identifier">previous_node</span>[<span class="ruby-value">:children</span>][<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">ancestor_node</span>
<span class="line-num">251</span>       <span class="ruby-keyword">break</span>
<span class="line-num">252</span>     <span class="ruby-keyword">end</span>
<span class="line-num">253</span>     <span class="ruby-identifier">previous_node</span> = <span class="ruby-identifier">ancestor_node</span>
<span class="line-num">254</span>   <span class="ruby-keyword">end</span>
<span class="line-num">255</span>   <span class="ruby-identifier">root</span>
<span class="line-num">256</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-merge_taxa">
            
              <b>merge_taxa</b>(taxa)
            
            <a href="../classes/TaxaHelper.html#method-i-merge_taxa" name="method-i-merge_taxa" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Take two taxa that seem identical and chose one, based mostly on the  number of child taxa.  Returns the one taxon to rule them all.</p>

<p>WARNING: this method is ONLY intended to deal with the taxa and taxon names.  You need to deal with things like observations of these taxa, list rules of these taxa on your own.  Make sure you compile all these before running this method and them add them to the meged taxon that gets returned.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-merge_taxa_source')" id="l_method-i-merge_taxa_source">show</a>
                

                

                
              </p>
              <div id="method-i-merge_taxa_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">15</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_taxa</span>(<span class="ruby-identifier">taxa</span>)    
<span class="line-num">16</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">name</span>}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="line-num">17</span>     <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;These taxa don&#39;t all have the same name!  Unique names: &quot;</span> <span class="ruby-operator">+</span>
<span class="line-num">18</span>           <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">name</span>}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>)
<span class="line-num">19</span>   <span class="ruby-keyword">end</span>
<span class="line-num">20</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">rank</span>}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="line-num">21</span>     <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;These taxa aren&#39;t all of the same rank!  Unique ranks: &quot;</span> <span class="ruby-operator">+</span> 
<span class="line-num">22</span>           <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">rank</span>}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>)
<span class="line-num">23</span>   <span class="ruby-keyword">end</span>
<span class="line-num">24</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">ancestors</span>}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="line-num">25</span>     <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;These taxa aren&#39;t all siblings (i.e. they don&#39;t all have the &quot;</span> <span class="ruby-operator">+</span>
<span class="line-num">26</span>           <span class="ruby-string">&quot;same ancestors)&quot;</span>
<span class="line-num">27</span>   <span class="ruby-keyword">end</span>
<span class="line-num">28</span>   <span class="ruby-identifier">sorted_taxa</span> = <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> }
<span class="line-num">29</span>   <span class="ruby-identifier">merged_taxon</span> = <span class="ruby-identifier">sorted_taxa</span>.<span class="ruby-identifier">shift</span>
<span class="line-num">30</span>   
<span class="line-num">31</span>   <span class="ruby-comment"># merge the children</span>
<span class="line-num">32</span>   <span class="ruby-identifier">orphans</span> = <span class="ruby-identifier">sorted_taxa</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">taxon</span><span class="ruby-operator">|</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">children</span> }.<span class="ruby-identifier">flatten</span>
<span class="line-num">33</span>   <span class="ruby-identifier">orphans</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
<span class="line-num">34</span>     <span class="ruby-identifier">merged_taxon</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
<span class="line-num">35</span>   <span class="ruby-keyword">end</span>
<span class="line-num">36</span>   
<span class="line-num">37</span>   <span class="ruby-comment"># merge the taxon_names</span>
<span class="line-num">38</span>   <span class="ruby-identifier">orphaned_names</span> = <span class="ruby-identifier">sorted_taxa</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">taxon</span><span class="ruby-operator">|</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">taxon_names</span> }.<span class="ruby-identifier">flatten</span>
<span class="line-num">39</span>   <span class="ruby-identifier">orphaned_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">taxon_name</span><span class="ruby-operator">|</span>
<span class="line-num">40</span>     <span class="ruby-identifier">merged_taxon</span>.<span class="ruby-identifier">taxon_names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">taxon_name</span>
<span class="line-num">41</span>   <span class="ruby-keyword">end</span>
<span class="line-num">42</span>   
<span class="line-num">43</span>   <span class="ruby-comment"># Save the survivor, destroy the pretenders</span>
<span class="line-num">44</span>   <span class="ruby-identifier">merged_taxon</span>.<span class="ruby-identifier">save</span>
<span class="line-num">45</span>   <span class="ruby-identifier">sorted_taxa</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">taxon</span><span class="ruby-operator">|</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">destroy</span> }
<span class="line-num">46</span>   
<span class="line-num">47</span>   <span class="ruby-identifier">merged_taxon</span>
<span class="line-num">48</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-remote_taxon_images">
            
              <b>remote_taxon_images</b>(taxon, options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-remote_taxon_images" name="method-i-remote_taxon_images" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-remote_taxon_images_source')" id="l_method-i-remote_taxon_images_source">show</a>
                

                

                
              </p>
              <div id="method-i-remote_taxon_images_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">263</span>   <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remote_taxon_images</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">264</span>     <span class="ruby-identifier">limit</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:limit</span>)
<span class="line-num">265</span>     <span class="ruby-identifier">element_id</span> = <span class="ruby-identifier">dom_id</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-string">&quot;images&quot;</span>)
<span class="line-num">266</span>     <span class="ruby-identifier">key</span> = {<span class="ruby-value">:controller</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;taxa&#39;</span>, <span class="ruby-value">:action</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;photos&#39;</span>, <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:partial</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;photo&quot;</span>}
<span class="line-num">267</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">fragment_exist?</span>(<span class="ruby-identifier">key</span>)
<span class="line-num">268</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:div</span>, <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">read_fragment</span>(<span class="ruby-identifier">key</span>), <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">element_id</span>)
<span class="line-num">269</span>     <span class="ruby-keyword">end</span>
<span class="line-num">270</span>     <span class="ruby-identifier">html</span> = <span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:div</span>, <span class="ruby-identifier">t</span>(<span class="ruby-value">:loading_images</span>), <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">element_id</span>, <span class="ruby-value">:class</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;loading status&quot;</span>)
<span class="line-num">271</span>     <span class="ruby-identifier">js</span> = <span class="ruby-identifier">&lt;&lt;-JS</span>
<span class="line-num">272</span> <span class="ruby-value">      $(&#39;##{element_id}&#39;).load(&#39;#{photos_of_taxon_path(taxon, :partial =&gt; &quot;photo&quot;, :limit =&gt; limit)}&#39;, function() {
<span class="line-num">273</span>         $(&#39;.zoomable&#39;, this).zoomify();
<span class="line-num">274</span>         $(&#39;##{element_id}&#39;).removeClass(&#39;loading status&#39;);
<span class="line-num">275</span>       });
<span class="line-num">276</span> </span><span class="ruby-identifier">    JS</span>
<span class="line-num">277</span>     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-identifier">js</span>.<span class="ruby-identifier">html_safe</span>, <span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;text/javascript&quot;</span>)
<span class="line-num">278</span>     <span class="ruby-identifier">html</span>
<span class="line-num">279</span>   <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_image">
            
              <b>taxon_image</b>(taxon, params = {})
            
            <a href="../classes/TaxaHelper.html#method-i-taxon_image" name="method-i-taxon_image" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Image tag for a taxon.  Returns the first assoc. photo if there is one, otherwise the iconic taxon icon.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_image_source')" id="l_method-i-taxon_image_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_image_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">54</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_image</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span> = {})
<span class="line-num">55</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">default_photo</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">56</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">iconic_taxon_image</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span>)
<span class="line-num">57</span>   <span class="ruby-keyword">end</span>
<span class="line-num">58</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;square&quot;</span>
<span class="line-num">59</span>   <span class="ruby-identifier">image_params</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">except</span>(<span class="ruby-value">:size</span>).<span class="ruby-identifier">merge</span>(<span class="ruby-value">:alt</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">default_taxon_name</span>(<span class="ruby-identifier">taxon</span>))
<span class="line-num">60</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">default_photo</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">61</span>     <span class="ruby-identifier">image_params</span>[<span class="ruby-value">:alt</span>] <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; - Photo #{taxon.default_photo.attribution}&quot;</span>
<span class="line-num">62</span>   <span class="ruby-keyword">end</span>
<span class="line-num">63</span>   <span class="ruby-identifier">image_params</span>[<span class="ruby-value">:title</span>] = <span class="ruby-identifier">image_params</span>[<span class="ruby-value">:alt</span>]
<span class="line-num">64</span>   
<span class="line-num">65</span>   [<span class="ruby-value">:id</span>, <span class="ruby-value">:class</span>, <span class="ruby-value">:style</span>, <span class="ruby-value">:alt</span>, <span class="ruby-value">:title</span>, <span class="ruby-value">:width</span>, <span class="ruby-value">:height</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr_name</span><span class="ruby-operator">|</span>
<span class="line-num">66</span>     <span class="ruby-identifier">image_params</span>[<span class="ruby-identifier">attr_name</span>] = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">attr_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">attr_name</span>]
<span class="line-num">67</span>   <span class="ruby-keyword">end</span>
<span class="line-num">68</span>   <span class="ruby-identifier">image_params</span>[<span class="ruby-value">:class</span>] = <span class="ruby-node">&quot;#{image_params[:class]} #{params[:size]} photo&quot;</span>.<span class="ruby-identifier">strip</span>
<span class="line-num">69</span>   <span class="ruby-identifier">image_tag</span>(<span class="ruby-identifier">taxon_image_url</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span>), <span class="ruby-identifier">image_params</span>).<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;utf-8&#39;</span>)
<span class="line-num">70</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_image_url">
            
              <b>taxon_image_url</b>(taxon, params = {})
            
            <a href="../classes/TaxaHelper.html#method-i-taxon_image_url" name="method-i-taxon_image_url" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_image_url_source')" id="l_method-i-taxon_image_url_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_image_url_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">72</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_image_url</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span> = {})
<span class="line-num">73</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">iconic_taxon_image_url</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">params</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">default_photo</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">74</span>   <span class="ruby-identifier">size</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;square&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>]
<span class="line-num">75</span>   <span class="ruby-identifier">photo</span> = <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">default_photo</span>
<span class="line-num">76</span>   <span class="ruby-identifier">photo</span>.<span class="ruby-identifier">best_url</span>(<span class="ruby-identifier">size</span>)
<span class="line-num">77</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_range_kml_url">
            
              <b>taxon_range_kml_url</b>(options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-taxon_range_kml_url" name="method-i-taxon_range_kml_url" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_range_kml_url_source')" id="l_method-i-taxon_range_kml_url_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_range_kml_url_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">310</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_range_kml_url</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">311</span>   <span class="ruby-identifier">taxon_range</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:taxon_range</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@taxon_range</span>
<span class="line-num">312</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon_range</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">313</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">taxon_range</span>.<span class="ruby-identifier">range</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">314</span>     <span class="ruby-identifier">taxon_range</span>.<span class="ruby-identifier">kml_url</span>
<span class="line-num">315</span>   <span class="ruby-keyword">else</span>
<span class="line-num">316</span>     <span class="ruby-node">&quot;#{taxon_range.kml_url}?#{taxon_range.updated_at.to_i}&quot;</span>.<span class="ruby-identifier">html_safe</span>
<span class="line-num">317</span>   <span class="ruby-keyword">end</span>
<span class="line-num">318</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-taxon_to_json">
            
              <b>taxon_to_json</b>(taxon, options = {})
            
            <a href="../classes/TaxaHelper.html#method-i-taxon_to_json" name="method-i-taxon_to_json" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Lame but simple way to jsonify a taxon</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-taxon_to_json_source')" id="l_method-i-taxon_to_json_source">show</a>
                

                

                
              </p>
              <div id="method-i-taxon_to_json_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/helpers/taxa_helper.rb</span>
<span class="line-num">282</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">taxon_to_json</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">283</span>   {
<span class="line-num">284</span>     <span class="ruby-value">:id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">285</span>     <span class="ruby-value">:name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">name</span>,
<span class="line-num">286</span>     <span class="ruby-value">:rank</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">rank</span>,
<span class="line-num">287</span>     <span class="ruby-value">:rank_level</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">rank_level</span>,
<span class="line-num">288</span>     <span class="ruby-value">:iconic_taxon</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:iconic_taxon</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">iconic_taxon</span>,
<span class="line-num">289</span>     <span class="ruby-value">:taxon_names</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">taxon_names</span>,
<span class="line-num">290</span>     <span class="ruby-value">:photos</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">photos</span>,
<span class="line-num">291</span>     <span class="ruby-value">:common_name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">common_name</span>,
<span class="line-num">292</span>     <span class="ruby-value">:image_url</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">image_url</span>,
<span class="line-num">293</span>     <span class="ruby-value">:default_name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">default_name</span>
<span class="line-num">294</span>   }.<span class="ruby-identifier">to_json</span>
<span class="line-num">295</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
