<!DOCTYPE html>
<html lang="en">
<head>
    <title>Project</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/panel.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/turbolinks.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/search_index.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../panel/tree.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/searchdoc.js" type="text/javascript" charset="utf-8"></script>
<meta name="data-rel-prefix" content="../">
<meta name="data-tree-keys" content='["Project"]'>


    <meta property="og:title" value="Project">

  

    <meta name="keywords" content="Project class, as_indexed_json, normalize_friendly_id, place_with_boundary, one_year_time_span, to_s, start_time=, end_time=, is_new_project?, preferred_start_date_or_time, preferred_end_date_or_time, strip_title, cover_dimensions, add_owner_as_project_user, create_the_project_list, set_updated_at_if_preferences_changed, editable_by?, curated_by?, rule_place, rule_places, rule_taxon, rule_taxa, icon_url, project_observation_rule_terms, project_observations_count, posts_count, reset_last_aggregated_at, remove_times_from_non_bioblitzes, set_observation_requirements_updated_at, tracking_code_allowed?, rule_place_ids, associated_place_ids, observations_url_params, collection_search_parameters, can_be_converted_to_collection_project?, convert_properties_for_collection_project, convert_to_collection_project, convert_collection_project_to_traditional_project, cached_slug, should_generate_new_friendly_id?, slug_candidates, curators, managers, duplicate, generate_csv, eventbrite_id, event_started?, event_ended?, event_in_progress?, default_json_options, update_curator_idents_on_make_curator, update_curator_idents_on_remove_curator, update_observed_taxa_count, revoke_project_observations_on_leave_project, delete_project_observations_on_leave_project, list_observed_and_total, slugs_to_ids, find_observed_and_total_for_project, generate_bulk_upload_template, split_large_array, invite_only?, users_can_add?, aggregation_allowed?, bioblitz?, update_counts, update_users_observations_counts, update_users_taxa_counts, aggregate_observations, aggregate_observations_for, queue_project_aggregations, sane_destroy, node_api_species_count, flagged_with, add_admins, destroy_project_rules, aggregation_preference_allowed?, within_umbrella_ids, notify_trusting_members_about_changes_unique_hash, notify_trusting_members_about_changes_later, notify_trusting_members_about_changes_if_rules_changed, notify_trusting_members_about_changes">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            Project
            
                <span class="parent">&lt;
                    
                    <a href="ApplicationRecord.html">ApplicationRecord</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/app/es_indices/project_index_rb.html">app/es_indices/project_index.rb</a></li>
            
            <li><a href="../files/app/models/project_rb.html">app/models/project.rb</a></li>
            
            <li><a href="../files/app/models/project_observation_rb.html">app/models/project_observation.rb</a></li>
            
            <li><a href="../files/app/models/project_user_rb.html">app/models/project_user.rb</a></li>
            
        </ul>
        
    </div>

    <main id="bodyContent">
        <div id="content">
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Project/ProjectAggregatorAlreadyRunning.html">Project::ProjectAggregatorAlreadyRunning</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-add_admins">add_admins</a>,
              </li>
            
              
              <li>
                <a href="#method-i-add_owner_as_project_user">add_owner_as_project_user</a>,
              </li>
            
              
              <li>
                <a href="#method-i-aggregate_observations">aggregate_observations</a>,
              </li>
            
              
              <li>
                <a href="#method-c-aggregate_observations_for">aggregate_observations_for</a>,
              </li>
            
              
              <li>
                <a href="#method-i-aggregation_allowed-3F">aggregation_allowed?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-aggregation_preference_allowed-3F">aggregation_preference_allowed?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-as_indexed_json">as_indexed_json</a>,
              </li>
            
              
              <li>
                <a href="#method-i-associated_place_ids">associated_place_ids</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-bioblitz-3F">bioblitz?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-cached_slug">cached_slug</a>,
              </li>
            
              
              <li>
                <a href="#method-i-can_be_converted_to_collection_project-3F">can_be_converted_to_collection_project?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-collection_search_parameters">collection_search_parameters</a>,
              </li>
            
              
              <li>
                <a href="#method-i-convert_collection_project_to_traditional_project">convert_collection_project_to_traditional_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-convert_properties_for_collection_project">convert_properties_for_collection_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-convert_to_collection_project">convert_to_collection_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-cover_dimensions">cover_dimensions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-create_the_project_list">create_the_project_list</a>,
              </li>
            
              
              <li>
                <a href="#method-i-curated_by-3F">curated_by?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-curators">curators</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-default_json_options">default_json_options</a>,
              </li>
            
              
              <li>
                <a href="#method-c-delete_project_observations_on_leave_project">delete_project_observations_on_leave_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-destroy_project_rules">destroy_project_rules</a>,
              </li>
            
              
              <li>
                <a href="#method-i-duplicate">duplicate</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-editable_by-3F">editable_by?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-end_time-3D">end_time=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-event_ended-3F">event_ended?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-event_in_progress-3F">event_in_progress?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-event_started-3F">event_started?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-eventbrite_id">eventbrite_id</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-find_observed_and_total_for_project">find_observed_and_total_for_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-flagged_with">flagged_with</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-generate_bulk_upload_template">generate_bulk_upload_template</a>,
              </li>
            
              
              <li>
                <a href="#method-i-generate_csv">generate_csv</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-icon_url">icon_url</a>,
              </li>
            
              
              <li>
                <a href="#method-i-invite_only-3F">invite_only?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-is_new_project-3F">is_new_project?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-list_observed_and_total">list_observed_and_total</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-managers">managers</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-node_api_species_count">node_api_species_count</a>,
              </li>
            
              
              <li>
                <a href="#method-i-normalize_friendly_id">normalize_friendly_id</a>,
              </li>
            
              
              <li>
                <a href="#method-c-notify_trusting_members_about_changes">notify_trusting_members_about_changes</a>,
              </li>
            
              
              <li>
                <a href="#method-i-notify_trusting_members_about_changes_if_rules_changed">notify_trusting_members_about_changes_if_rules_changed</a>,
              </li>
            
              
              <li>
                <a href="#method-i-notify_trusting_members_about_changes_later">notify_trusting_members_about_changes_later</a>,
              </li>
            
              
              <li>
                <a href="#method-i-notify_trusting_members_about_changes_unique_hash">notify_trusting_members_about_changes_unique_hash</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-observations_url_params">observations_url_params</a>,
              </li>
            
              
              <li>
                <a href="#method-i-one_year_time_span">one_year_time_span</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-place_with_boundary">place_with_boundary</a>,
              </li>
            
              
              <li>
                <a href="#method-i-posts_count">posts_count</a>,
              </li>
            
              
              <li>
                <a href="#method-i-preferred_end_date_or_time">preferred_end_date_or_time</a>,
              </li>
            
              
              <li>
                <a href="#method-i-preferred_start_date_or_time">preferred_start_date_or_time</a>,
              </li>
            
              
              <li>
                <a href="#method-i-project_observation_rule_terms">project_observation_rule_terms</a>,
              </li>
            
              
              <li>
                <a href="#method-i-project_observations_count">project_observations_count</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Q</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-queue_project_aggregations">queue_project_aggregations</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-remove_times_from_non_bioblitzes">remove_times_from_non_bioblitzes</a>,
              </li>
            
              
              <li>
                <a href="#method-i-reset_last_aggregated_at">reset_last_aggregated_at</a>,
              </li>
            
              
              <li>
                <a href="#method-c-revoke_project_observations_on_leave_project">revoke_project_observations_on_leave_project</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rule_place">rule_place</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rule_place_ids">rule_place_ids</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rule_places">rule_places</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rule_taxa">rule_taxa</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rule_taxon">rule_taxon</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-sane_destroy">sane_destroy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_observation_requirements_updated_at">set_observation_requirements_updated_at</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_updated_at_if_preferences_changed">set_updated_at_if_preferences_changed</a>,
              </li>
            
              
              <li>
                <a href="#method-i-should_generate_new_friendly_id-3F">should_generate_new_friendly_id?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-slug_candidates">slug_candidates</a>,
              </li>
            
              
              <li>
                <a href="#method-c-slugs_to_ids">slugs_to_ids</a>,
              </li>
            
              
              <li>
                <a href="#method-i-split_large_array">split_large_array</a>,
              </li>
            
              
              <li>
                <a href="#method-i-start_time-3D">start_time=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-strip_title">strip_title</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-to_s">to_s</a>,
              </li>
            
              
              <li>
                <a href="#method-i-tracking_code_allowed-3F">tracking_code_allowed?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update_counts">update_counts</a>,
              </li>
            
              
              <li>
                <a href="#method-c-update_curator_idents_on_make_curator">update_curator_idents_on_make_curator</a>,
              </li>
            
              
              <li>
                <a href="#method-c-update_curator_idents_on_remove_curator">update_curator_idents_on_remove_curator</a>,
              </li>
            
              
              <li>
                <a href="#method-c-update_observed_taxa_count">update_observed_taxa_count</a>,
              </li>
            
              
              <li>
                <a href="#method-i-update_users_observations_counts">update_users_observations_counts</a>,
              </li>
            
              
              <li>
                <a href="#method-i-update_users_taxa_counts">update_users_taxa_counts</a>,
              </li>
            
              
              <li>
                <a href="#method-i-users_can_add-3F">users_can_add?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>W</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-within_umbrella_ids">within_umbrella_ids</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="ActsAsElasticModel.html">
              ActsAsElasticModel
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ASSESSMENT_TYPE</td>
            <td>=</td>
            <td class="attr-value">&#39;assessment&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">BIOBLITZ_TYPE</td>
            <td>=</td>
            <td class="attr-value">&#39;bioblitz&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_ES_BATCH_SIZE</td>
            <td>=</td>
            <td class="attr-value">500</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MAP_TYPES</td>
            <td>=</td>
            <td class="attr-value">%w(roadmap terrain satellite hybrid)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MEMBERSHIP_INVITE_ONLY</td>
            <td>=</td>
            <td class="attr-value">&#39;inviteonly&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MEMBERSHIP_MODELS</td>
            <td>=</td>
            <td class="attr-value">[MEMBERSHIP_OPEN, MEMBERSHIP_INVITE_ONLY]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MEMBERSHIP_OPEN</td>
            <td>=</td>
            <td class="attr-value">&#39;open&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">NPS_BIOBLITZ_GROUP_NAME</td>
            <td>=</td>
            <td class="attr-value">&quot;2016 National Parks BioBlitz&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">NPS_BIOBLITZ_PROJECT_NAME</td>
            <td>=</td>
            <td class="attr-value">&quot;2016 National Parks Bioblitz - NPS Servicewide&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">PROJECTS_CONTROLLER_ACTION_METHODS</td>
            <td>=</td>
            <td class="attr-value">[
&quot;stats&quot;, &quot;index&quot;, &quot;new&quot;, &quot;observed_taxa_count&quot;,
&quot;show_contributor&quot;, &quot;feature&quot;, &quot;join&quot;, &quot;edit&quot;, &quot;remove&quot;, &quot;show&quot;,
&quot;add_batch&quot;, &quot;remove_project_user&quot;, &quot;remove_batch&quot;, &quot;list&quot;, &quot;search&quot;,
&quot;calendar&quot;, &quot;invite&quot;, &quot;terms&quot;, &quot;confirm_leave&quot;, &quot;stats_slideshow&quot;,
&quot;contributors&quot;, &quot;convert_to_collection&quot;, &quot;convert_to_traditional&quot;, &quot;leave&quot;,
&quot;new_traditional&quot;, &quot;add&quot;, &quot;by_login&quot;, &quot;unfeature&quot;, &quot;create&quot;, &quot;destroy&quot;,
&quot;change_admin&quot;, &quot;update&quot;, &quot;bulk_template&quot;, &quot;members&quot;, &quot;block_spammers&quot;,
&quot;block_if_spammer&quot;, &quot;if_spammer_set_flash_message&quot;, &quot;block_if_spam&quot;,
&quot;render_spam_notice&quot;, &quot;set_spam_flash_error&quot;, &quot;browse&quot;,
&quot;set_akismet_params_on_record&quot;, &quot;change_role&quot;, &quot;logged_in?&quot;, &quot;set_locale&quot;,
&quot;ping&quot;
]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>We used to just call ProjectsController.action_methods.to_a here, but that leads to some unpleasantness when referring to the <a href="Project.html"><code>Project</code></a> model from within other models in specs</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">PROJECT_TYPES</td>
            <td>=</td>
            <td class="attr-value">[ASSESSMENT_TYPE, BIOBLITZ_TYPE]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">RESERVED_TITLES</td>
            <td>=</td>
            <td class="attr-value">PROJECTS_CONTROLLER_ACTION_METHODS</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">RULE_PREFERENCES</td>
            <td>=</td>
            <td class="attr-value">[
&quot;rule_quality_grade&quot;, &quot;rule_photos&quot;, &quot;rule_sounds&quot;,
&quot;rule_observed_on&quot;, &quot;rule_d1&quot;, &quot;rule_d2&quot;, &quot;rule_month&quot;,
&quot;rule_term_id&quot;, &quot;rule_term_value_id&quot;, &quot;rule_native&quot;,
&quot;rule_introduced&quot;, &quot;rule_members_only&quot;
]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SUBMISSION_BY_ANYONE</td>
            <td>=</td>
            <td class="attr-value">&#39;any&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SUBMISSION_BY_CURATORS</td>
            <td>=</td>
            <td class="attr-value">&#39;curators&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SUBMISSION_MODELS</td>
            <td>=</td>
            <td class="attr-value">[SUBMISSION_BY_ANYONE, SUBMISSION_BY_CURATORS]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <h2 class="sectiontitle">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>admin_attributes</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-aggregate_observations_for">
            
              <b>aggregate_observations_for</b>(project_id)
            
            <a href="../classes/Project.html#method-c-aggregate_observations_for" name="method-c-aggregate_observations_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-aggregate_observations_for_source')" id="l_method-c-aggregate_observations_for_source">show</a>
                

                

                
              </p>
              <div id="method-c-aggregate_observations_for_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1050</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">aggregate_observations_for</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">1051</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">1052</span>   <span class="ruby-identifier">project</span>.<span class="ruby-identifier">aggregate_observations</span>
<span class="line-num">1053</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-default_json_options">
            
              <b>default_json_options</b>()
            
            <a href="../classes/Project.html#method-c-default_json_options" name="method-c-default_json_options" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-default_json_options_source')" id="l_method-c-default_json_options_source">show</a>
                

                

                
              </p>
              <div id="method-c-default_json_options_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">740</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">default_json_options</span>
<span class="line-num">741</span>   {
<span class="line-num">742</span>     <span class="ruby-value">methods:</span> [
<span class="line-num">743</span>       <span class="ruby-value">:cached_slug</span>,
<span class="line-num">744</span>       <span class="ruby-value">:icon_url</span>,
<span class="line-num">745</span>       <span class="ruby-value">:project_observation_rule_terms</span>,
<span class="line-num">746</span>       <span class="ruby-value">:rule_place</span>,
<span class="line-num">747</span>       <span class="ruby-value">:slug</span>
<span class="line-num">748</span>     ],
<span class="line-num">749</span>     <span class="ruby-value">except:</span> [<span class="ruby-value">:tracking_codes</span>]
<span class="line-num">750</span>   }
<span class="line-num">751</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-delete_project_observations_on_leave_project">
            
              <b>delete_project_observations_on_leave_project</b>(project_id, user_id)
            
            <a href="../classes/Project.html#method-c-delete_project_observations_on_leave_project" name="method-c-delete_project_observations_on_leave_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-delete_project_observations_on_leave_project_source')" id="l_method-c-delete_project_observations_on_leave_project_source">show</a>
                

                

                
              </p>
              <div id="method-c-delete_project_observations_on_leave_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">837</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">delete_project_observations_on_leave_project</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">user_id</span>)
<span class="line-num">838</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">proj</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">839</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">user_id</span>)
<span class="line-num">840</span>   <span class="ruby-comment"># max_id prevents a problem with aggregated projects (see issue #1227)</span>
<span class="line-num">841</span>   <span class="ruby-comment"># Aggregated projects will add back whatever is currently relevant to the</span>
<span class="line-num">842</span>   <span class="ruby-comment"># project, but may as well remove all existing obs in case some don&#39;t match</span>
<span class="line-num">843</span>   <span class="ruby-comment"># the current rules. The max_id prevents this from deleting the re-aggregated</span>
<span class="line-num">844</span>   <span class="ruby-comment"># obs and creating an endless loop of deletes and re-agg</span>
<span class="line-num">845</span>   <span class="ruby-identifier">max_id</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-value">:id</span>)
<span class="line-num">846</span>   <span class="ruby-identifier">observation_ids</span> = []
<span class="line-num">847</span>   <span class="ruby-identifier">proj</span>.<span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:observation</span>).
<span class="line-num">848</span>        <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;observations.user_id = ?&quot;</span>, <span class="ruby-identifier">usr</span>).
<span class="line-num">849</span>        <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;observations.id &lt;= ?&quot;</span>, <span class="ruby-identifier">max_id</span>).<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">850</span>     <span class="ruby-identifier">po</span>.<span class="ruby-identifier">skip_touch_observation</span> = <span class="ruby-keyword">true</span>
<span class="line-num">851</span>     <span class="ruby-identifier">po</span>.<span class="ruby-identifier">destroy</span>
<span class="line-num">852</span>     <span class="ruby-identifier">observation_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation_id</span>
<span class="line-num">853</span>   <span class="ruby-keyword">end</span>
<span class="line-num">854</span>   <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_index!</span>(<span class="ruby-value">ids:</span> <span class="ruby-identifier">observation_ids</span>)
<span class="line-num">855</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-notify_trusting_members_about_changes">
            
              <b>notify_trusting_members_about_changes</b>( project )
            
            <a href="../classes/Project.html#method-c-notify_trusting_members_about_changes" name="method-c-notify_trusting_members_about_changes" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-notify_trusting_members_about_changes_source')" id="l_method-c-notify_trusting_members_about_changes_source">show</a>
                

                

                
              </p>
              <div id="method-c-notify_trusting_members_about_changes_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1143</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">notify_trusting_members_about_changes</span>( <span class="ruby-identifier">project</span> )
<span class="line-num">1144</span>   <span class="ruby-identifier">project</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>( <span class="ruby-identifier">project</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Project</span> )
<span class="line-num">1145</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span>
<span class="line-num">1146</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">prefers_user_trust?</span>
<span class="line-num">1147</span>   <span class="ruby-identifier">trusting_prefs</span> = [
<span class="line-num">1148</span>     <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_FOR_TAXON</span>,
<span class="line-num">1149</span>     <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_FOR_ANY</span>
<span class="line-num">1150</span>   ]
<span class="line-num">1151</span>   <span class="ruby-identifier">pu_scope</span> = <span class="ruby-identifier">project</span>.<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:stored_preferences</span>).<span class="ruby-identifier">where</span>(
<span class="line-num">1152</span>     <span class="ruby-string">&quot;preferences.name = &#39;curator_coordinate_access_for&#39; AND preferences.value IN (?)&quot;</span>,
<span class="line-num">1153</span>     <span class="ruby-identifier">trusting_prefs</span>
<span class="line-num">1154</span>   )
<span class="line-num">1155</span>   <span class="ruby-identifier">pu_scope</span>.<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">project_user</span><span class="ruby-operator">|</span>
<span class="line-num">1156</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">trusting_prefs</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">project_user</span>.<span class="ruby-identifier">prefers_curator_coordinate_access_for</span> )
<span class="line-num">1157</span>     <span class="ruby-constant">Emailer</span>.<span class="ruby-identifier">collection_project_changed_for_trusting_member</span>( <span class="ruby-identifier">project_user</span> ).<span class="ruby-identifier">deliver_now</span>
<span class="line-num">1158</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1159</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-queue_project_aggregations">
            
              <b>queue_project_aggregations</b>(options = {})
            
            <a href="../classes/Project.html#method-c-queue_project_aggregations" name="method-c-queue_project_aggregations" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-queue_project_aggregations_source')" id="l_method-c-queue_project_aggregations_source">show</a>
                

                

                
              </p>
              <div id="method-c-queue_project_aggregations_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1055</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">queue_project_aggregations</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">1056</span>   <span class="ruby-constant">Project</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:stored_preferences</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;preferences.name = &#39;aggregation&#39; AND preferences.value = &#39;t&#39;&quot;</span>).<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
<span class="line-num">1057</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">aggregation_allowed?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">prefers_aggregation?</span>
<span class="line-num">1058</span>     <span class="ruby-constant">Project</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>, <span class="ruby-value">queue:</span> <span class="ruby-string">&quot;slow&quot;</span>,
<span class="line-num">1059</span>       <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;Project::aggregate_observations_for&quot;:</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span> }).<span class="ruby-identifier">aggregate_observations_for</span>( <span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span> )
<span class="line-num">1060</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1061</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-revoke_project_observations_on_leave_project">
            
              <b>revoke_project_observations_on_leave_project</b>(project_id, user_id)
            
            <a href="../classes/Project.html#method-c-revoke_project_observations_on_leave_project" name="method-c-revoke_project_observations_on_leave_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-revoke_project_observations_on_leave_project_source')" id="l_method-c-revoke_project_observations_on_leave_project_source">show</a>
                

                

                
              </p>
              <div id="method-c-revoke_project_observations_on_leave_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">829</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">revoke_project_observations_on_leave_project</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">user_id</span>)
<span class="line-num">830</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">proj</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">831</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">user_id</span>)
<span class="line-num">832</span>   <span class="ruby-identifier">proj</span>.<span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:observation</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;observations.user_id = ?&quot;</span>, <span class="ruby-identifier">usr</span>).<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">833</span>     <span class="ruby-identifier">po</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">prefers_curator_coordinate_access:</span> <span class="ruby-keyword">false</span>)
<span class="line-num">834</span>   <span class="ruby-keyword">end</span>
<span class="line-num">835</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-slugs_to_ids">
            
              <b>slugs_to_ids</b>(slugs)
            
            <a href="../classes/Project.html#method-c-slugs_to_ids" name="method-c-slugs_to_ids" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-slugs_to_ids_source')" id="l_method-c-slugs_to_ids_source">show</a>
                

                

                
              </p>
              <div id="method-c-slugs_to_ids_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">861</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">slugs_to_ids</span>(<span class="ruby-identifier">slugs</span>)
<span class="line-num">862</span>   <span class="ruby-identifier">slugs</span> = <span class="ruby-identifier">slugs</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">slugs</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
<span class="line-num">863</span>   [<span class="ruby-identifier">slugs</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
<span class="line-num">864</span>     <span class="ruby-identifier">project_id</span> = <span class="ruby-identifier">p</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
<span class="line-num">865</span>     <span class="ruby-identifier">project_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Project</span>
<span class="line-num">866</span>     <span class="ruby-identifier">project_id</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">p</span>).<span class="ruby-identifier">try</span>(<span class="ruby-value">:id</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
<span class="line-num">867</span>     <span class="ruby-identifier">project_id</span>
<span class="line-num">868</span>   <span class="ruby-keyword">end</span>.<span class="ruby-identifier">compact</span>
<span class="line-num">869</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-update_curator_idents_on_make_curator">
            
              <b>update_curator_idents_on_make_curator</b>(project_id, project_user_id)
            
            <a href="../classes/Project.html#method-c-update_curator_idents_on_make_curator" name="method-c-update_curator_idents_on_make_curator" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-update_curator_idents_on_make_curator_source')" id="l_method-c-update_curator_idents_on_make_curator_source">show</a>
                

                

                
              </p>
              <div id="method-c-update_curator_idents_on_make_curator_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">753</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_curator_idents_on_make_curator</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">project_user_id</span>)
<span class="line-num">754</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">755</span>     <span class="ruby-keyword">return</span>
<span class="line-num">756</span>   <span class="ruby-keyword">end</span>
<span class="line-num">757</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project_user</span> = <span class="ruby-identifier">project</span>.<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_user_id</span>)
<span class="line-num">758</span>     <span class="ruby-keyword">return</span>
<span class="line-num">759</span>   <span class="ruby-keyword">end</span>
<span class="line-num">760</span>   <span class="ruby-identifier">project</span>.<span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">joins</span>({ <span class="ruby-value">observation:</span> <span class="ruby-value">:identifications</span> }).
<span class="line-num">761</span>     <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;project_observations.curator_identification_id IS NULL AND identifications.user_id = ?&quot;</span>,
<span class="line-num">762</span>     <span class="ruby-identifier">project_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">763</span>     <span class="ruby-identifier">curator_ident</span> = <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">identifications</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ident</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ident</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">project_user</span>.<span class="ruby-identifier">user_id</span>}
<span class="line-num">764</span>     <span class="ruby-identifier">po</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">curator_identification:</span> <span class="ruby-identifier">curator_ident</span>)
<span class="line-num">765</span>     <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">766</span>       <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ProjectUser::update_observations_counter_cache_from_project_and_user&quot;:</span>
<span class="line-num">767</span>         [ <span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span> ] }
<span class="line-num">768</span>     ).<span class="ruby-identifier">update_observations_counter_cache_from_project_and_user</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span>)
<span class="line-num">769</span>     <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">770</span>       <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ProjectUser::update_taxa_counter_cache_from_project_and_user&quot;:</span>
<span class="line-num">771</span>         [ <span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span> ] }
<span class="line-num">772</span>     ).<span class="ruby-identifier">update_taxa_counter_cache_from_project_and_user</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span>)
<span class="line-num">773</span>   <span class="ruby-keyword">end</span>
<span class="line-num">774</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-update_curator_idents_on_remove_curator">
            
              <b>update_curator_idents_on_remove_curator</b>(project_id, user_id)
            
            <a href="../classes/Project.html#method-c-update_curator_idents_on_remove_curator" name="method-c-update_curator_idents_on_remove_curator" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-update_curator_idents_on_remove_curator_source')" id="l_method-c-update_curator_idents_on_remove_curator_source">show</a>
                

                

                
              </p>
              <div id="method-c-update_curator_idents_on_remove_curator_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">776</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_curator_idents_on_remove_curator</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">user_id</span>)
<span class="line-num">777</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">778</span>     <span class="ruby-keyword">return</span>
<span class="line-num">779</span>   <span class="ruby-keyword">end</span>
<span class="line-num">780</span>   
<span class="line-num">781</span>   <span class="ruby-identifier">find_options</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">user_id</span>)
<span class="line-num">782</span>     {
<span class="line-num">783</span>       <span class="ruby-value">include:</span> [<span class="ruby-value">:curator_identification</span>, <span class="ruby-value">:observation</span>],
<span class="line-num">784</span>       <span class="ruby-value">conditions:</span> [<span class="ruby-string">&quot;identifications.user_id = ?&quot;</span>, <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>]
<span class="line-num">785</span>     }
<span class="line-num">786</span>   <span class="ruby-keyword">else</span>
<span class="line-num">787</span>     {
<span class="line-num">788</span>       <span class="ruby-value">include:</span> {<span class="ruby-value">observation:</span> <span class="ruby-value">:identifications</span>},
<span class="line-num">789</span>       <span class="ruby-value">conditions:</span> <span class="ruby-string">&quot;project_observations.curator_identification_id IS NOT NULL&quot;</span>
<span class="line-num">790</span>     }
<span class="line-num">791</span>   <span class="ruby-keyword">end</span>
<span class="line-num">792</span>   
<span class="line-num">793</span>   <span class="ruby-identifier">project_curators</span> = <span class="ruby-identifier">project</span>.<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">role:</span> [ <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">MANAGER</span>, <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR</span> ])
<span class="line-num">794</span>   <span class="ruby-identifier">project_curator_user_ids</span> = <span class="ruby-identifier">project_curators</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pu</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pu</span>.<span class="ruby-identifier">user_id</span>}
<span class="line-num">795</span> 
<span class="line-num">796</span>   <span class="ruby-identifier">project</span>.<span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">find_options</span>[<span class="ruby-value">:conditions</span>]).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">find_options</span>[<span class="ruby-value">:include</span>]).<span class="ruby-identifier">find_in_batches</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">batch</span><span class="ruby-operator">|</span>
<span class="line-num">797</span>     <span class="ruby-constant">Identification</span>.<span class="ruby-identifier">preload_associations</span>( <span class="ruby-identifier">batch</span>, { <span class="ruby-value">observation:</span> <span class="ruby-value">:identifications</span> } )
<span class="line-num">798</span>     <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">preload_for_elastic_index</span>( <span class="ruby-identifier">batch</span>.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:observation</span> ) )
<span class="line-num">799</span>     <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">prepare_batch_for_index</span>( <span class="ruby-identifier">batch</span>.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:observation</span> ) )
<span class="line-num">800</span>     <span class="ruby-identifier">batch</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">801</span>       <span class="ruby-identifier">curator_ident</span> = <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">identifications</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ident</span><span class="ruby-operator">|</span> <span class="ruby-identifier">project_curator_user_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">ident</span>.<span class="ruby-identifier">user_id</span>)}
<span class="line-num">802</span>       <span class="ruby-identifier">po</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">curator_identification:</span> <span class="ruby-identifier">curator_ident</span>)
<span class="line-num">803</span>       <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">804</span>         <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ProjectUser::update_observations_counter_cache_from_project_and_user&quot;:</span>
<span class="line-num">805</span>           [ <span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span> ] }
<span class="line-num">806</span>       ).<span class="ruby-identifier">update_observations_counter_cache_from_project_and_user</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span>)
<span class="line-num">807</span>       <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">808</span>         <span class="ruby-value">unique_hash:</span> { <span class="ruby-value">&quot;ProjectUser::update_taxa_counter_cache_from_project_and_user&quot;:</span>
<span class="line-num">809</span>           [ <span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span> ] }
<span class="line-num">810</span>       ).<span class="ruby-identifier">update_taxa_counter_cache_from_project_and_user</span>(<span class="ruby-identifier">project_id</span>, <span class="ruby-identifier">po</span>.<span class="ruby-identifier">observation</span>.<span class="ruby-identifier">user_id</span>)
<span class="line-num">811</span>     <span class="ruby-keyword">end</span>
<span class="line-num">812</span>   <span class="ruby-keyword">end</span>
<span class="line-num">813</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-update_observed_taxa_count">
            
              <b>update_observed_taxa_count</b>(project_id)
            
            <a href="../classes/Project.html#method-c-update_observed_taxa_count" name="method-c-update_observed_taxa_count" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-c-update_observed_taxa_count_source')" id="l_method-c-update_observed_taxa_count_source">show</a>
                

                

                
              </p>
              <div id="method-c-update_observed_taxa_count_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">815</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_observed_taxa_count</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">816</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">project_id</span>)
<span class="line-num">817</span>   <span class="ruby-identifier">observed_taxa_count</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">is_new_project?</span>
<span class="line-num">818</span>     <span class="ruby-identifier">response</span> = <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations_species_counts</span>( <span class="ruby-identifier">project</span>.<span class="ruby-identifier">collection_search_parameters</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span> ) )
<span class="line-num">819</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">response</span>
<span class="line-num">820</span>     <span class="ruby-identifier">response</span>.<span class="ruby-identifier">total_results</span>
<span class="line-num">821</span>   <span class="ruby-keyword">else</span>
<span class="line-num">822</span>     <span class="ruby-identifier">response</span> = <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations_species_counts</span>( <span class="ruby-value">project_id:</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span> )
<span class="line-num">823</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">response</span>
<span class="line-num">824</span>     <span class="ruby-identifier">response</span>.<span class="ruby-identifier">total_results</span>
<span class="line-num">825</span>   <span class="ruby-keyword">end</span>
<span class="line-num">826</span>   <span class="ruby-identifier">project</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">observed_taxa_count:</span> <span class="ruby-identifier">observed_taxa_count</span>)
<span class="line-num">827</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-add_admins">
            
              <b>add_admins</b>()
            
            <a href="../classes/Project.html#method-i-add_admins" name="method-i-add_admins" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-add_admins_source')" id="l_method-i-add_admins_source">show</a>
                

                

                
              </p>
              <div id="method-i-add_admins_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1080</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_admins</span>
<span class="line-num">1081</span>   <span class="ruby-identifier">is_new</span> = <span class="ruby-identifier">new_record?</span>
<span class="line-num">1082</span>   <span class="ruby-keyword">yield</span>
<span class="line-num">1083</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">admin_attributes</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">1084</span>   <span class="ruby-identifier">admin_attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">admin_attr</span><span class="ruby-operator">|</span>
<span class="line-num">1085</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">admin_attr</span>[<span class="ruby-string">&quot;user_id&quot;</span>]
<span class="line-num">1086</span>     <span class="ruby-identifier">new_role</span> = <span class="ruby-identifier">admin_attr</span>[<span class="ruby-string">&quot;_destroy&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;manager&quot;</span> 
<span class="line-num">1087</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new</span>
<span class="line-num">1088</span>       <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">find_or_create_by</span>( <span class="ruby-value">user_id:</span> <span class="ruby-identifier">admin_attr</span>[<span class="ruby-string">&quot;user_id&quot;</span>] ).<span class="ruby-identifier">update</span>( <span class="ruby-value">role:</span> <span class="ruby-identifier">new_role</span> )
<span class="line-num">1089</span>     <span class="ruby-keyword">else</span>
<span class="line-num">1090</span>       <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">find_by</span>( <span class="ruby-value">user_id:</span> <span class="ruby-identifier">admin_attr</span>[<span class="ruby-string">&quot;user_id&quot;</span>] )&amp;.<span class="ruby-identifier">update</span>( <span class="ruby-value">role:</span> <span class="ruby-identifier">new_role</span> )
<span class="line-num">1091</span>     <span class="ruby-keyword">end</span>
<span class="line-num">1092</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1093</span>   <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">reload</span>
<span class="line-num">1094</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-add_owner_as_project_user">
            
              <b>add_owner_as_project_user</b>(options = {})
            
            <a href="../classes/Project.html#method-i-add_owner_as_project_user" name="method-i-add_owner_as_project_user" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-add_owner_as_project_user_source')" id="l_method-i-add_owner_as_project_user_source">show</a>
                

                

                
              </p>
              <div id="method-i-add_owner_as_project_user_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">284</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_owner_as_project_user</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">285</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">saved_change_to_user_id?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:force</span>]
<span class="line-num">286</span>   <span class="ruby-identifier">existing_project_user</span> = <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">user_id:</span> <span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">first</span>
<span class="line-num">287</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_project_user</span>
<span class="line-num">288</span>     <span class="ruby-identifier">existing_project_user</span>.<span class="ruby-identifier">update</span>( <span class="ruby-value">role:</span> <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">MANAGER</span> )
<span class="line-num">289</span>   <span class="ruby-keyword">else</span>
<span class="line-num">290</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">create!</span>(
<span class="line-num">291</span>       <span class="ruby-value">user:</span> <span class="ruby-identifier">user</span>,
<span class="line-num">292</span>       <span class="ruby-value">role:</span> <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">MANAGER</span>,
<span class="line-num">293</span>       <span class="ruby-value">skip_updates:</span> <span class="ruby-keyword">true</span>
<span class="line-num">294</span>     )
<span class="line-num">295</span>   <span class="ruby-keyword">end</span>
<span class="line-num">296</span>   <span class="ruby-keyword">true</span>
<span class="line-num">297</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-aggregate_observations">
            
              <b>aggregate_observations</b>(options = {})
            
            <a href="../classes/Project.html#method-i-aggregate_observations" name="method-i-aggregate_observations" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-aggregate_observations_source')" id="l_method-i-aggregate_observations_source">show</a>
                

                

                
              </p>
              <div id="method-i-aggregate_observations_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1008</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">aggregate_observations</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">1009</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">aggregation_allowed?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prefers_aggregation?</span>
<span class="line-num">1010</span>   <span class="ruby-identifier">logger</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:logger</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>
<span class="line-num">1011</span>   <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
<span class="line-num">1012</span>   <span class="ruby-identifier">added</span> = <span class="ruby-value">0</span>
<span class="line-num">1013</span>   <span class="ruby-identifier">fails</span> = <span class="ruby-value">0</span>
<span class="line-num">1014</span>   <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;[INFO #{Time.now}] Starting aggregation for #{self}&quot;</span>
<span class="line-num">1015</span>   <span class="ruby-identifier">params</span> = <span class="ruby-identifier">observations_url_params</span>(<span class="ruby-value">extended:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">merge</span>(<span class="ruby-value">per_page:</span> <span class="ruby-value">200</span>, <span class="ruby-value">not_in_project:</span> <span class="ruby-identifier">id</span>)
<span class="line-num">1016</span>   <span class="ruby-comment"># making sure we only look at observations updated since the last aggregation</span>
<span class="line-num">1017</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">last_aggregated_at</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">1018</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:updated_since</span>] = <span class="ruby-identifier">last_aggregated_at</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">1019</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:aggregation_user_ids</span>] = <span class="ruby-constant">Preference</span>.
<span class="line-num">1020</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">name:</span> <span class="ruby-string">&quot;project_addition_by&quot;</span>).
<span class="line-num">1021</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">owner_type:</span> <span class="ruby-string">&quot;User&quot;</span>).
<span class="line-num">1022</span>       <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;updated_at &gt;= ?&quot;</span>, <span class="ruby-identifier">last_aggregated_at</span>).<span class="ruby-identifier">distinct</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:owner_id</span>)
<span class="line-num">1023</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:aggregation_user_ids</span>] <span class="ruby-operator">+=</span> <span class="ruby-constant">ProjectUser</span>.
<span class="line-num">1024</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>).
<span class="line-num">1025</span>       <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;updated_at &gt;= ?&quot;</span>, <span class="ruby-identifier">last_aggregated_at</span>).<span class="ruby-identifier">distinct</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:user_id</span>)
<span class="line-num">1026</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:aggregation_user_ids</span>].<span class="ruby-identifier">uniq!</span>
<span class="line-num">1027</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1028</span>   <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span>
<span class="line-num">1029</span>   <span class="ruby-identifier">total_pages</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">1030</span>   <span class="ruby-identifier">last_observation_id</span> = <span class="ruby-value">0</span>
<span class="line-num">1031</span>   <span class="ruby-identifier">search_params</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">get_search_params</span>(<span class="ruby-identifier">params</span>)
<span class="line-num">1032</span>   <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
<span class="line-num">1033</span>     <span class="ruby-comment"># stop if the project was deleted since the job started</span>
<span class="line-num">1034</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Project</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">exists?</span>
<span class="line-num">1035</span>     <span class="ruby-identifier">batch_params</span> = <span class="ruby-identifier">search_params</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-value">min_id:</span> <span class="ruby-identifier">last_observation_id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">order_by:</span> <span class="ruby-string">&quot;id&quot;</span>, <span class="ruby-value">order:</span> <span class="ruby-string">&quot;asc&quot;</span> })
<span class="line-num">1036</span>     <span class="ruby-identifier">batch_metadata</span> = <span class="ruby-identifier">aggregate_observations_from_query</span>(<span class="ruby-identifier">batch_params</span>, { <span class="ruby-value">page:</span> <span class="ruby-identifier">page</span>, <span class="ruby-value">total_pages:</span> <span class="ruby-identifier">total_pages</span> })
<span class="line-num">1037</span>     <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">batch_metadata</span>
<span class="line-num">1038</span>     <span class="ruby-identifier">total_pages</span> = <span class="ruby-identifier">batch_metadata</span>[<span class="ruby-value">:total_pages</span>]
<span class="line-num">1039</span>     <span class="ruby-identifier">added</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">batch_metadata</span>[<span class="ruby-value">:obs_ids_added</span>].<span class="ruby-identifier">length</span>
<span class="line-num">1040</span>     <span class="ruby-identifier">fails</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">batch_metadata</span>[<span class="ruby-value">:fails</span>]
<span class="line-num">1041</span>     <span class="ruby-identifier">last_observation_id</span> = <span class="ruby-identifier">batch_metadata</span>[<span class="ruby-value">:last_id</span>]
<span class="line-num">1042</span>     <span class="ruby-identifier">page</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="line-num">1043</span>     <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_index!</span>(<span class="ruby-value">ids:</span> <span class="ruby-identifier">batch_metadata</span>[<span class="ruby-value">:obs_ids_added</span>])
<span class="line-num">1044</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1045</span>   <span class="ruby-identifier">update_counts</span>
<span class="line-num">1046</span>   <span class="ruby-identifier">update</span>(<span class="ruby-value">last_aggregated_at:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
<span class="line-num">1047</span>   <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;[INFO #{Time.now}] Finished aggregation for #{self} in #{Time.now - start_time}s, #{added} observations added, #{fails} failures&quot;</span>
<span class="line-num">1048</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-aggregation_allowed-3F">
            
              <b>aggregation_allowed?</b>()
            
            <a href="../classes/Project.html#method-i-aggregation_allowed-3F" name="method-i-aggregation_allowed-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-aggregation_allowed-3F_source')" id="l_method-i-aggregation_allowed-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-aggregation_allowed-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">926</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">aggregation_allowed?</span>
<span class="line-num">927</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">928</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">aggregator_exception_project_ids</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">aggregator_exception_project_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">id</span>)
<span class="line-num">929</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">place</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">bbox_area</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">141</span>
<span class="line-num">930</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;operator IN (?)&quot;</span>, <span class="ruby-node">%w(in_taxon? on_list?)</span>).<span class="ruby-identifier">exists?</span>
<span class="line-num">931</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;operator IN (?)&quot;</span>, <span class="ruby-node">%w(observed_in_place?)</span>).<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">932</span>     <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operand</span>.<span class="ruby-identifier">bbox_area</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">141</span>
<span class="line-num">933</span>   }.<span class="ruby-identifier">uniq</span> <span class="ruby-operator">==</span> [ <span class="ruby-keyword">true</span> ]
<span class="line-num">934</span>   <span class="ruby-keyword">false</span>
<span class="line-num">935</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-aggregation_preference_allowed-3F">
            
              <b>aggregation_preference_allowed?</b>()
            
            <a href="../classes/Project.html#method-i-aggregation_preference_allowed-3F" name="method-i-aggregation_preference_allowed-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-aggregation_preference_allowed-3F_source')" id="l_method-i-aggregation_preference_allowed-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-aggregation_preference_allowed-3F_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1103</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">aggregation_preference_allowed?</span>
<span class="line-num">1104</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">1105</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">prefers_aggregation?</span>
<span class="line-num">1106</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">aggregation_allowed?</span>
<span class="line-num">1107</span>   <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:project_aggregator_filter_error</span>))
<span class="line-num">1108</span>   <span class="ruby-keyword">true</span>
<span class="line-num">1109</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-as_indexed_json">
            
              <b>as_indexed_json</b>(options={})
            
            <a href="../classes/Project.html#method-i-as_indexed_json" name="method-i-as_indexed_json" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-as_indexed_json_source')" id="l_method-i-as_indexed_json_source">show</a>
                

                

                
              </p>
              <div id="method-i-as_indexed_json_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/es_indices/project_index.rb</span>
<span class="line-num">143</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">as_indexed_json</span>(<span class="ruby-identifier">options</span>={})
<span class="line-num">144</span>   <span class="ruby-identifier">preload_for_elastic_index</span>
<span class="line-num">145</span>   <span class="ruby-identifier">project_user_ids</span> = <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:user_id</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>
<span class="line-num">146</span>   <span class="ruby-comment"># preload subproject rules to save queries when indexing large umbrellas</span>
<span class="line-num">147</span>   <span class="ruby-comment"># sometimes the rule operands aren&#39;t preloaded for some reason</span>
<span class="line-num">148</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">association</span>(<span class="ruby-value">:operand</span>).<span class="ruby-identifier">loaded?</span>
<span class="line-num">149</span>     <span class="ruby-constant">Project</span>.<span class="ruby-identifier">preload_associations</span>( <span class="ruby-identifier">project_observation_rules</span>, [<span class="ruby-value">:operand</span>])
<span class="line-num">150</span>   <span class="ruby-keyword">end</span>
<span class="line-num">151</span>   <span class="ruby-constant">Project</span>.<span class="ruby-identifier">preload_associations</span>(
<span class="line-num">152</span>     <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operand_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Project&quot;</span> }.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:operand</span> ),
<span class="line-num">153</span>     [{ <span class="ruby-value">project_observation_rules:</span> <span class="ruby-value">:operand</span> }, <span class="ruby-value">:place</span>]
<span class="line-num">154</span>   )
<span class="line-num">155</span>   <span class="ruby-comment"># This will effect search rankings, so first we try to get a count of obs by</span>
<span class="line-num">156</span>   <span class="ruby-comment"># people who have joined the project. Otherwise you could get a high-ranking</span>
<span class="line-num">157</span>   <span class="ruby-comment"># project just by using an expansive set of obs requirements.</span>
<span class="line-num">158</span>   <span class="ruby-identifier">obs_count</span> = <span class="ruby-keyword">begin</span>
<span class="line-num">159</span>     <span class="ruby-identifier">r</span> = <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations</span>(
<span class="line-num">160</span>       <span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>,
<span class="line-num">161</span>       <span class="ruby-value">user_id:</span> <span class="ruby-identifier">project_user_ids</span>.<span class="ruby-identifier">join</span>( <span class="ruby-string">&quot;,&quot;</span> ),
<span class="line-num">162</span>       <span class="ruby-value">only_id:</span> <span class="ruby-keyword">true</span>,
<span class="line-num">163</span>       <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span>
<span class="line-num">164</span>     )
<span class="line-num">165</span>     <span class="ruby-comment"># However, querying a lot of user_ids might fail or timeout, so we fall</span>
<span class="line-num">166</span>     <span class="ruby-comment"># back to just the count of obs, no user filter</span>
<span class="line-num">167</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">r</span>
<span class="line-num">168</span>       <span class="ruby-identifier">r</span> = <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations</span>(
<span class="line-num">169</span>         <span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>,
<span class="line-num">170</span>         <span class="ruby-value">only_id:</span> <span class="ruby-keyword">true</span>,
<span class="line-num">171</span>         <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span>
<span class="line-num">172</span>       )
<span class="line-num">173</span>     <span class="ruby-keyword">end</span>
<span class="line-num">174</span>     <span class="ruby-comment"># If for some reason that failed, set it to zero</span>
<span class="line-num">175</span>     <span class="ruby-identifier">r</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">total_results</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
<span class="line-num">176</span>   <span class="ruby-keyword">rescue</span>
<span class="line-num">177</span>     <span class="ruby-comment"># And if we get an exception for any reason, don&#39;t break indexing, just</span>
<span class="line-num">178</span>     <span class="ruby-comment"># set the count to zero</span>
<span class="line-num">179</span>     <span class="ruby-value">0</span>
<span class="line-num">180</span>   <span class="ruby-keyword">end</span>
<span class="line-num">181</span>   <span class="ruby-identifier">json</span> = {
<span class="line-num">182</span>     <span class="ruby-value">id:</span> <span class="ruby-identifier">id</span>,
<span class="line-num">183</span>     <span class="ruby-value">title:</span> <span class="ruby-identifier">title</span>,
<span class="line-num">184</span>     <span class="ruby-value">title_autocomplete:</span> <span class="ruby-identifier">title</span>,
<span class="line-num">185</span>     <span class="ruby-value">title_exact:</span> <span class="ruby-identifier">title</span>,
<span class="line-num">186</span>     <span class="ruby-value">hide_title:</span> <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">prefers_hide_title</span>,
<span class="line-num">187</span>     <span class="ruby-value">description:</span> <span class="ruby-identifier">description</span>,
<span class="line-num">188</span>     <span class="ruby-value">slug:</span> <span class="ruby-identifier">slug</span>,
<span class="line-num">189</span>     <span class="ruby-value">project_type:</span> <span class="ruby-identifier">project_type</span>,
<span class="line-num">190</span>     <span class="ruby-value">banner_color:</span> <span class="ruby-identifier">preferred_banner_color</span>,
<span class="line-num">191</span>     <span class="ruby-value">ancestor_place_ids:</span> <span class="ruby-identifier">place</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">ancestor_place_ids</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
<span class="line-num">192</span>     <span class="ruby-value">place_ids:</span> <span class="ruby-identifier">place</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">place</span>.<span class="ruby-identifier">self_and_ancestor_ids</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
<span class="line-num">193</span>     <span class="ruby-value">place_id:</span> <span class="ruby-identifier">rule_place_ids</span>.<span class="ruby-identifier">first</span>,
<span class="line-num">194</span>     <span class="ruby-value">user_id:</span> <span class="ruby-identifier">user_id</span>,
<span class="line-num">195</span>     <span class="ruby-value">admins:</span> <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pu</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pu</span>.<span class="ruby-identifier">role</span>.<span class="ruby-identifier">blank?</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:as_indexed_json</span>),
<span class="line-num">196</span>     <span class="ruby-value">rule_place_ids:</span> <span class="ruby-identifier">rule_place_ids</span>,
<span class="line-num">197</span>     <span class="ruby-value">associated_place_ids:</span> <span class="ruby-identifier">associated_place_ids</span>,
<span class="line-num">198</span>     <span class="ruby-value">user_ids:</span> <span class="ruby-identifier">project_user_ids</span>,
<span class="line-num">199</span>     <span class="ruby-value">location:</span> <span class="ruby-constant">ElasticModel</span>.<span class="ruby-identifier">point_latlon</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>),
<span class="line-num">200</span>     <span class="ruby-value">geojson:</span> <span class="ruby-constant">ElasticModel</span>.<span class="ruby-identifier">point_geojson</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>),
<span class="line-num">201</span>     <span class="ruby-value">icon:</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">?</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">asset_url</span>( <span class="ruby-identifier">icon</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:span2</span>), <span class="ruby-value">host:</span> <span class="ruby-constant">Site</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">url</span> ) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
<span class="line-num">202</span>     <span class="ruby-value">icon_file_name:</span> <span class="ruby-identifier">icon_file_name</span>,
<span class="line-num">203</span>     <span class="ruby-value">header_image_url:</span> <span class="ruby-identifier">cover</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">FakeView</span>.<span class="ruby-identifier">asset_url</span>( <span class="ruby-identifier">cover</span>.<span class="ruby-identifier">url</span>, <span class="ruby-value">host:</span> <span class="ruby-constant">Site</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">url</span> ),
<span class="line-num">204</span>     <span class="ruby-value">header_image_file_name:</span> <span class="ruby-identifier">cover_file_name</span>,
<span class="line-num">205</span>     <span class="ruby-value">header_image_contain:</span> <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">preferred_banner_contain</span>,
<span class="line-num">206</span>     <span class="ruby-value">project_observation_fields:</span> <span class="ruby-identifier">project_observation_fields</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:as_indexed_json</span>),
<span class="line-num">207</span>     <span class="ruby-value">terms:</span> <span class="ruby-identifier">terms</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">terms</span>,
<span class="line-num">208</span>     <span class="ruby-value">search_parameters:</span> <span class="ruby-identifier">collection_search_parameters</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">field</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
<span class="line-num">209</span>       <span class="ruby-identifier">type</span> = <span class="ruby-string">&quot;keyword&quot;</span>
<span class="line-num">210</span>       <span class="ruby-keyword">if</span> [ <span class="ruby-string">&quot;d1&quot;</span>, <span class="ruby-string">&quot;d2&quot;</span>, <span class="ruby-string">&quot;observed_on&quot;</span> ].<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">field</span> )
<span class="line-num">211</span>         <span class="ruby-identifier">type</span> = <span class="ruby-string">&quot;date&quot;</span>
<span class="line-num">212</span>       <span class="ruby-keyword">else</span>
<span class="line-num">213</span>         <span class="ruby-identifier">instance</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Array</span> ) <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>
<span class="line-num">214</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">TrueClass</span> ) <span class="ruby-operator">||</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">FalseClass</span> )
<span class="line-num">215</span>           <span class="ruby-identifier">type</span> = <span class="ruby-string">&quot;bool&quot;</span>
<span class="line-num">216</span>         <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">instance</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Integer</span> )
<span class="line-num">217</span>           <span class="ruby-identifier">type</span> = <span class="ruby-string">&quot;number&quot;</span>
<span class="line-num">218</span>         <span class="ruby-keyword">end</span>
<span class="line-num">219</span>       <span class="ruby-keyword">end</span>
<span class="line-num">220</span>       <span class="ruby-identifier">doc</span> = {
<span class="line-num">221</span>         <span class="ruby-value">field:</span> <span class="ruby-identifier">field</span>,
<span class="line-num">222</span>         <span class="ruby-value">value:</span> <span class="ruby-identifier">value</span>
<span class="line-num">223</span>       }
<span class="line-num">224</span>       <span class="ruby-identifier">doc</span>[<span class="ruby-value">:&quot;value_#{type}&quot;</span>] = <span class="ruby-identifier">value</span>
<span class="line-num">225</span>       <span class="ruby-identifier">doc</span>
<span class="line-num">226</span>     },
<span class="line-num">227</span>     <span class="ruby-value">search_parameter_fields:</span> <span class="ruby-identifier">collection_search_parameters</span>,
<span class="line-num">228</span>     <span class="ruby-value">subproject_ids:</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">===</span> <span class="ruby-string">&quot;umbrella&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">229</span>       <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;in_project?&quot;</span>
<span class="line-num">230</span>     }.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:operand_id</span> ) <span class="ruby-operator">:</span> [],
<span class="line-num">231</span>     <span class="ruby-value">project_observation_rules:</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span> {
<span class="line-num">232</span>       <span class="ruby-value">id:</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">id</span>,
<span class="line-num">233</span>       <span class="ruby-value">operator:</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span>,
<span class="line-num">234</span>       <span class="ruby-value">operand_type:</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_type</span>,
<span class="line-num">235</span>       <span class="ruby-value">operand_id:</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">236</span>     } }.<span class="ruby-identifier">uniq</span>,
<span class="line-num">237</span>     <span class="ruby-value">rule_preferences:</span> <span class="ruby-identifier">preferences</span>.
<span class="line-num">238</span>       <span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-constant">Project</span><span class="ruby-operator">::</span><span class="ruby-constant">RULE_PREFERENCES</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>) }.
<span class="line-num">239</span>       <span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> { <span class="ruby-value">field:</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">&quot;rule_&quot;</span>,<span class="ruby-string">&quot;&quot;</span>), <span class="ruby-value">value:</span> <span class="ruby-identifier">v</span> } },
<span class="line-num">240</span>     <span class="ruby-value">created_at:</span> <span class="ruby-identifier">created_at</span>,
<span class="line-num">241</span>     <span class="ruby-value">updated_at:</span> <span class="ruby-identifier">updated_at</span>,
<span class="line-num">242</span>     <span class="ruby-value">last_post_at:</span> <span class="ruby-identifier">posts</span>.<span class="ruby-identifier">published</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:published_at</span>),
<span class="line-num">243</span>     <span class="ruby-value">observations_count:</span> <span class="ruby-identifier">obs_count</span>,
<span class="line-num">244</span>     <span class="ruby-comment"># Giving a search boost to featured projects, ensuring the value is larger than ES integer</span>
<span class="line-num">245</span>     <span class="ruby-value">universal_search_rank:</span> [
<span class="line-num">246</span>       ( <span class="ruby-identifier">obs_count</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">project_user_ids</span>.<span class="ruby-identifier">size</span> ) <span class="ruby-operator">*</span> ( <span class="ruby-identifier">site_featured_projects</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value">10000</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span> ),
<span class="line-num">247</span>       ( <span class="ruby-value">2</span> <span class="ruby-operator">**</span> <span class="ruby-value">31</span> ) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
<span class="line-num">248</span>     ].<span class="ruby-identifier">min</span>,
<span class="line-num">249</span>     <span class="ruby-value">spam:</span> <span class="ruby-identifier">known_spam?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">owned_by_spammer?</span>,
<span class="line-num">250</span>     <span class="ruby-value">flags:</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:as_indexed_json</span>),
<span class="line-num">251</span>     <span class="ruby-value">site_features:</span> <span class="ruby-identifier">site_featured_projects</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:as_indexed_json</span>),
<span class="line-num">252</span>     <span class="ruby-value">umbrella_project_ids:</span> <span class="ruby-identifier">within_umbrella_ids</span>,
<span class="line-num">253</span>     <span class="ruby-value">prefers_user_trust:</span> <span class="ruby-identifier">prefers_user_trust</span>,
<span class="line-num">254</span>     <span class="ruby-value">observation_requirements_updated_at:</span> <span class="ruby-identifier">observation_requirements_updated_at</span>
<span class="line-num">255</span>   }
<span class="line-num">256</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;umbrella&quot;</span>
<span class="line-num">257</span>     <span class="ruby-identifier">json</span>[<span class="ruby-value">:hide_umbrella_map_flags</span>] = <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">prefers_hide_umbrella_map_flags</span>
<span class="line-num">258</span>   <span class="ruby-keyword">end</span>
<span class="line-num">259</span>   <span class="ruby-identifier">json</span>
<span class="line-num">260</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-associated_place_ids">
            
              <b>associated_place_ids</b>()
            
            <a href="../classes/Project.html#method-i-associated_place_ids" name="method-i-associated_place_ids" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-associated_place_ids_source')" id="l_method-i-associated_place_ids_source">show</a>
                

                

                
              </p>
              <div id="method-i-associated_place_ids_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">413</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">associated_place_ids</span>
<span class="line-num">414</span>   <span class="ruby-identifier">place_ids</span> = [<span class="ruby-identifier">place</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:self_and_ancestor_ids</span>), <span class="ruby-identifier">rule_places</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:self_and_ancestor_ids</span>)]
<span class="line-num">415</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;umbrella&quot;</span>
<span class="line-num">416</span>     <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">por</span><span class="ruby-operator">|</span>
<span class="line-num">417</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">operand</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Project</span>
<span class="line-num">418</span>       <span class="ruby-identifier">place_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">operand</span>.<span class="ruby-identifier">associated_place_ids</span>
<span class="line-num">419</span>     <span class="ruby-keyword">end</span>
<span class="line-num">420</span>   <span class="ruby-keyword">end</span>
<span class="line-num">421</span>   <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">compact</span>
<span class="line-num">422</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-bioblitz-3F">
            
              <b>bioblitz?</b>()
            
            <a href="../classes/Project.html#method-i-bioblitz-3F" name="method-i-bioblitz-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-bioblitz-3F_source')" id="l_method-i-bioblitz-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-bioblitz-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">937</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bioblitz?</span>
<span class="line-num">938</span>   <span class="ruby-identifier">project_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">BIOBLITZ_TYPE</span>
<span class="line-num">939</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-cached_slug">
            
              <b>cached_slug</b>()
            
            <a href="../classes/Project.html#method-i-cached_slug" name="method-i-cached_slug" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-cached_slug_source')" id="l_method-i-cached_slug_source">show</a>
                

                

                
              </p>
              <div id="method-i-cached_slug_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">620</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cached_slug</span>
<span class="line-num">621</span>   <span class="ruby-identifier">slug</span>
<span class="line-num">622</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-can_be_converted_to_collection_project-3F">
            
              <b>can_be_converted_to_collection_project?</b>()
            
            <a href="../classes/Project.html#method-i-can_be_converted_to_collection_project-3F" name="method-i-can_be_converted_to_collection_project-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-can_be_converted_to_collection_project-3F_source')" id="l_method-i-can_be_converted_to_collection_project-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-can_be_converted_to_collection_project-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">570</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">can_be_converted_to_collection_project?</span>
<span class="line-num">571</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">572</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">collection_search_parameters</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">573</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">detect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">574</span>     <span class="ruby-operator">!</span>[ <span class="ruby-string">&quot;in_taxon?&quot;</span>, <span class="ruby-string">&quot;observed_in_place?&quot;</span>, <span class="ruby-string">&quot;has_a_photo?&quot;</span>, <span class="ruby-string">&quot;has_a_sound?&quot;</span>,
<span class="line-num">575</span>        <span class="ruby-string">&quot;observed_by_user?&quot;</span>, <span class="ruby-string">&quot;verifiable?&quot;</span> ].<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operator</span> )
<span class="line-num">576</span>   <span class="ruby-keyword">end</span>
<span class="line-num">577</span>   <span class="ruby-keyword">true</span>
<span class="line-num">578</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-collection_search_parameters">
            
              <b>collection_search_parameters</b>(options = {})
            
            <a href="../classes/Project.html#method-i-collection_search_parameters" name="method-i-collection_search_parameters" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>TODO: probably merge most of this logic with <a href="Project.html#method-i-observations_url_params"><code>observations_url_params</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-collection_search_parameters_source')" id="l_method-i-collection_search_parameters_source">show</a>
                

                

                
              </p>
              <div id="method-i-collection_search_parameters_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">487</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">collection_search_parameters</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">488</span>   <span class="ruby-identifier">params</span> = { }
<span class="line-num">489</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;umbrella&quot;</span>
<span class="line-num">490</span>     <span class="ruby-identifier">project_ids</span> = []
<span class="line-num">491</span>     <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">492</span>       <span class="ruby-identifier">project_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">===</span> <span class="ruby-string">&quot;in_project?&quot;</span>
<span class="line-num">493</span>     <span class="ruby-keyword">end</span>
<span class="line-num">494</span>     <span class="ruby-identifier">project_ids</span> = <span class="ruby-identifier">project_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">495</span>     <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">project_id:</span> <span class="ruby-identifier">project_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">496</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">params</span>
<span class="line-num">497</span>   <span class="ruby-keyword">end</span>
<span class="line-num">498</span>   <span class="ruby-comment"># this method can be called on traditional projects, which can use start_time and end_time</span>
<span class="line-num">499</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_time</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_time</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">is_new_project?</span>
<span class="line-num">500</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:d1</span>] = <span class="ruby-identifier">preferred_start_date_or_time</span>
<span class="line-num">501</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:d2</span>] = <span class="ruby-identifier">preferred_end_date_or_time</span>
<span class="line-num">502</span>   <span class="ruby-keyword">end</span>
<span class="line-num">503</span>   <span class="ruby-identifier">taxon_ids</span> = [ ]
<span class="line-num">504</span>   <span class="ruby-identifier">without_taxon_ids</span> = [ ]
<span class="line-num">505</span>   <span class="ruby-identifier">user_ids</span> = [ ]
<span class="line-num">506</span>   <span class="ruby-identifier">not_user_ids</span> = [ ]
<span class="line-num">507</span>   <span class="ruby-identifier">place_ids</span> = [ <span class="ruby-identifier">place_id</span> ]
<span class="line-num">508</span>   <span class="ruby-identifier">not_place_ids</span> = [ ]
<span class="line-num">509</span>   <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">510</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span>
<span class="line-num">511</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;not_in_taxon?&quot;</span>
<span class="line-num">512</span>       <span class="ruby-identifier">without_taxon_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">513</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;in_taxon?&quot;</span>
<span class="line-num">514</span>       <span class="ruby-identifier">taxon_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">515</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;not_observed_in_place?&quot;</span>
<span class="line-num">516</span>       <span class="ruby-identifier">not_place_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">517</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span>
<span class="line-num">518</span>       <span class="ruby-identifier">place_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">519</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;has_a_photo?&quot;</span>
<span class="line-num">520</span>       <span class="ruby-comment"># traditional projects may have this rule, which will be converted to</span>
<span class="line-num">521</span>       <span class="ruby-comment"># rule_photos (and rule_souncs below), so ignore these for new projects</span>
<span class="line-num">522</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:photos</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">523</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;has_a_sound?&quot;</span>
<span class="line-num">524</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:sounds</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">525</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;observed_by_user?&quot;</span>
<span class="line-num">526</span>       <span class="ruby-identifier">user_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">527</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;not_observed_by_user?&quot;</span>
<span class="line-num">528</span>       <span class="ruby-identifier">not_user_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">529</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;verifiable?&quot;</span>
<span class="line-num">530</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:quality_grade</span>] = <span class="ruby-string">&quot;research,needs_id&quot;</span>
<span class="line-num">531</span>     <span class="ruby-keyword">end</span>
<span class="line-num">532</span>   <span class="ruby-keyword">end</span>
<span class="line-num">533</span>   <span class="ruby-constant">Project</span><span class="ruby-operator">::</span><span class="ruby-constant">RULE_PREFERENCES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">534</span>     <span class="ruby-identifier">rule_value</span> = <span class="ruby-identifier">send</span>( <span class="ruby-node">&quot;prefers_#{rule}&quot;</span> )
<span class="line-num">535</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">rule_value</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
<span class="line-num">536</span>       <span class="ruby-comment"># map the rule values to their proper data types</span>
<span class="line-num">537</span>       <span class="ruby-keyword">if</span> [ <span class="ruby-string">&quot;rule_d1&quot;</span>, <span class="ruby-string">&quot;rule_d2&quot;</span>, <span class="ruby-string">&quot;rule_observed_on&quot;</span> ].<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">rule</span> )
<span class="line-num">538</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">match</span>( <span class="ruby-regexp">/ /</span> )
<span class="line-num">539</span>           <span class="ruby-identifier">rule_value</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">rule_value</span> )
<span class="line-num">540</span>         <span class="ruby-keyword">else</span>
<span class="line-num">541</span>           <span class="ruby-identifier">rule_value</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">rule_value</span> )
<span class="line-num">542</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">rule</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;rule_d2&quot;</span>
<span class="line-num">543</span>             <span class="ruby-comment"># when d2 is a date w/o a time, we want to capture that in its own field</span>
<span class="line-num">544</span>             <span class="ruby-identifier">params</span>[ <span class="ruby-string">&quot;d2_date&quot;</span> ] = <span class="ruby-identifier">rule_value</span>
<span class="line-num">545</span>           <span class="ruby-keyword">end</span>
<span class="line-num">546</span>         <span class="ruby-keyword">end</span>
<span class="line-num">547</span>       <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">String</span> )
<span class="line-num">548</span>         <span class="ruby-identifier">is_int</span> = <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">match</span>( <span class="ruby-regexp">/^\d+ *(, *\d+)*$/</span> )
<span class="line-num">549</span>         <span class="ruby-identifier">rule_value</span> = <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">split</span>( <span class="ruby-string">&quot;,&quot;</span> ).<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span> )
<span class="line-num">550</span>         <span class="ruby-identifier">rule_value</span>.<span class="ruby-identifier">map!</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:to_i</span> ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_int</span>
<span class="line-num">551</span>       <span class="ruby-keyword">end</span>
<span class="line-num">552</span>       <span class="ruby-identifier">params</span>[ <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">sub</span>( <span class="ruby-string">&quot;rule_&quot;</span>, <span class="ruby-string">&quot;&quot;</span> ).<span class="ruby-identifier">to_sym</span> ] = <span class="ruby-identifier">rule_value</span>
<span class="line-num">553</span>     <span class="ruby-keyword">end</span>
<span class="line-num">554</span>   <span class="ruby-keyword">end</span>
<span class="line-num">555</span>   <span class="ruby-identifier">without_taxon_ids</span> = <span class="ruby-identifier">without_taxon_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">556</span>   <span class="ruby-identifier">taxon_ids</span> = <span class="ruby-identifier">taxon_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">557</span>   <span class="ruby-identifier">not_place_ids</span> = <span class="ruby-identifier">not_place_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">558</span>   <span class="ruby-identifier">place_ids</span> = <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">559</span>   <span class="ruby-identifier">not_user_ids</span> = <span class="ruby-identifier">not_user_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">560</span>   <span class="ruby-identifier">user_ids</span> = <span class="ruby-identifier">user_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">561</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">without_taxon_id:</span> <span class="ruby-identifier">without_taxon_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">without_taxon_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">562</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">taxon_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">563</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">not_in_place:</span> <span class="ruby-identifier">not_place_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">not_place_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">564</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">565</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">not_user_id:</span> <span class="ruby-identifier">not_user_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">not_user_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">566</span>   <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">user_id:</span> <span class="ruby-identifier">user_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">user_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">567</span>   <span class="ruby-identifier">params</span>
<span class="line-num">568</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-convert_collection_project_to_traditional_project">
            
              <b>convert_collection_project_to_traditional_project</b>()
            
            <a href="../classes/Project.html#method-i-convert_collection_project_to_traditional_project" name="method-i-convert_collection_project_to_traditional_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-convert_collection_project_to_traditional_project_source')" id="l_method-i-convert_collection_project_to_traditional_project_source">show</a>
                

                

                
              </p>
              <div id="method-i-convert_collection_project_to_traditional_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">611</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_collection_project_to_traditional_project</span>
<span class="line-num">612</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;collection&quot;</span>
<span class="line-num">613</span>   <span class="ruby-constant">Project</span><span class="ruby-operator">::</span><span class="ruby-constant">RULE_PREFERENCES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">614</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>( <span class="ruby-node">&quot;prefers_#{rule}=&quot;</span>, <span class="ruby-keyword">nil</span> )
<span class="line-num">615</span>   <span class="ruby-keyword">end</span>
<span class="line-num">616</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">project_type</span> = (<span class="ruby-identifier">preferred_start_date_or_time</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">preferred_end_date_or_time</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&quot;bioblitz&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="line-num">617</span>   <span class="ruby-identifier">save</span>
<span class="line-num">618</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-convert_properties_for_collection_project">
            
              <b>convert_properties_for_collection_project</b>()
            
            <a href="../classes/Project.html#method-i-convert_properties_for_collection_project" name="method-i-convert_properties_for_collection_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-convert_properties_for_collection_project_source')" id="l_method-i-convert_properties_for_collection_project_source">show</a>
                

                

                
              </p>
              <div id="method-i-convert_properties_for_collection_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">580</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_properties_for_collection_project</span>
<span class="line-num">581</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">can_be_converted_to_collection_project?</span>
<span class="line-num">582</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">583</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prefers_rule_d1</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preferred_start_date_or_time</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preferred_start_date_or_time</span>
<span class="line-num">584</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prefers_rule_d2</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preferred_end_date_or_time</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preferred_end_date_or_time</span>
<span class="line-num">585</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">detect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;verifiable?&quot;</span> }
<span class="line-num">586</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prefers_rule_quality_grade</span> = <span class="ruby-string">&quot;research,needs_id&quot;</span>
<span class="line-num">587</span>   <span class="ruby-keyword">end</span>
<span class="line-num">588</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prefers_banner_contain</span> = <span class="ruby-keyword">true</span>
<span class="line-num">589</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">place_id</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">590</span>     <span class="ruby-operator">!</span><span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">detect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">operand_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">place_id</span>}
<span class="line-num">591</span>     <span class="ruby-identifier">association</span>(<span class="ruby-value">:project_observation_rules</span>).<span class="ruby-identifier">add_to_target</span>(<span class="ruby-constant">ProjectObservationRule</span>.<span class="ruby-identifier">new</span>(
<span class="line-num">592</span>       <span class="ruby-value">ruler:</span> <span class="ruby-keyword">self</span>,
<span class="line-num">593</span>       <span class="ruby-value">operator:</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span>,
<span class="line-num">594</span>       <span class="ruby-value">operand_type:</span> <span class="ruby-string">&quot;Place&quot;</span>,
<span class="line-num">595</span>       <span class="ruby-value">operand_id:</span> <span class="ruby-identifier">place_id</span>
<span class="line-num">596</span>     ))
<span class="line-num">597</span>   <span class="ruby-keyword">end</span>
<span class="line-num">598</span>   <span class="ruby-comment"># place_id gets turned into an observed_in_place? rule for collection projects</span>
<span class="line-num">599</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">place_id</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">600</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-convert_to_collection_project">
            
              <b>convert_to_collection_project</b>()
            
            <a href="../classes/Project.html#method-i-convert_to_collection_project" name="method-i-convert_to_collection_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-convert_to_collection_project_source')" id="l_method-i-convert_to_collection_project_source">show</a>
                

                

                
              </p>
              <div id="method-i-convert_to_collection_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">602</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_to_collection_project</span>
<span class="line-num">603</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">can_be_converted_to_collection_project?</span>
<span class="line-num">604</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">605</span>   <span class="ruby-identifier">convert_properties_for_collection_project</span>
<span class="line-num">606</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prefers_aggregation</span> = <span class="ruby-keyword">false</span>
<span class="line-num">607</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">project_type</span> = <span class="ruby-string">&quot;collection&quot;</span>
<span class="line-num">608</span>   <span class="ruby-identifier">save</span>
<span class="line-num">609</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-cover_dimensions">
            
              <b>cover_dimensions</b>()
            
            <a href="../classes/Project.html#method-i-cover_dimensions" name="method-i-cover_dimensions" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-cover_dimensions_source')" id="l_method-i-cover_dimensions_source">show</a>
                

                

                
              </p>
              <div id="method-i-cover_dimensions_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">276</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cover_dimensions</span>
<span class="line-num">277</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cover</span>.<span class="ruby-identifier">queued_for_write</span>[<span class="ruby-value">:original</span>]
<span class="line-num">278</span>   <span class="ruby-identifier">dimensions</span> = <span class="ruby-constant">Paperclip</span><span class="ruby-operator">::</span><span class="ruby-constant">Geometry</span>.<span class="ruby-identifier">from_file</span>(<span class="ruby-identifier">cover</span>.<span class="ruby-identifier">queued_for_write</span>[<span class="ruby-value">:original</span>].<span class="ruby-identifier">path</span>)
<span class="line-num">279</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">dimensions</span>.<span class="ruby-identifier">width</span> <span class="ruby-operator">!=</span> <span class="ruby-value">950</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">dimensions</span>.<span class="ruby-identifier">height</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">400</span>
<span class="line-num">280</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:cover</span>), <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:image_must_be_exactly</span>))
<span class="line-num">281</span>   <span class="ruby-keyword">end</span>
<span class="line-num">282</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-create_the_project_list">
            
              <b>create_the_project_list</b>()
            
            <a href="../classes/Project.html#method-i-create_the_project_list" name="method-i-create_the_project_list" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-create_the_project_list_source')" id="l_method-i-create_the_project_list_source">show</a>
                

                

                
              </p>
              <div id="method-i-create_the_project_list_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">299</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_the_project_list</span>
<span class="line-num">300</span>   <span class="ruby-identifier">create_project_list</span>(<span class="ruby-value">project:</span> <span class="ruby-keyword">self</span>)
<span class="line-num">301</span>   <span class="ruby-keyword">true</span>
<span class="line-num">302</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-curated_by-3F">
            
              <b>curated_by?</b>(user)
            
            <a href="../classes/Project.html#method-i-curated_by-3F" name="method-i-curated_by-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-curated_by-3F_source')" id="l_method-i-curated_by-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-curated_by-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">317</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">curated_by?</span>(<span class="ruby-identifier">user</span>)
<span class="line-num">318</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">319</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_admin?</span>
<span class="line-num">320</span>   <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">curators</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">user_id:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">managers</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">user_id:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>)
<span class="line-num">321</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-curators">
            
              <b>curators</b>()
            
            <a href="../classes/Project.html#method-i-curators" name="method-i-curators" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-curators_source')" id="l_method-i-curators_source">show</a>
                

                

                
              </p>
              <div id="method-i-curators_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">635</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">curators</span>
<span class="line-num">636</span>   <span class="ruby-identifier">users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;project_users.role = ?&quot;</span>, <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR</span>)
<span class="line-num">637</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-destroy_project_rules">
            
              <b>destroy_project_rules</b>()
            
            <a href="../classes/Project.html#method-i-destroy_project_rules" name="method-i-destroy_project_rules" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-destroy_project_rules_source')" id="l_method-i-destroy_project_rules_source">show</a>
                

                

                
              </p>
              <div id="method-i-destroy_project_rules_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1096</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy_project_rules</span>
<span class="line-num">1097</span>   <span class="ruby-constant">ProjectObservationRule</span>.<span class="ruby-identifier">where</span>(
<span class="line-num">1098</span>     <span class="ruby-value">operand_type:</span> <span class="ruby-string">&quot;Project&quot;</span>,
<span class="line-num">1099</span>     <span class="ruby-value">operand_id:</span> <span class="ruby-identifier">id</span>
<span class="line-num">1100</span>   ).<span class="ruby-identifier">destroy_all</span>
<span class="line-num">1101</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-duplicate">
            
              <b>duplicate</b>()
            
            <a href="../classes/Project.html#method-i-duplicate" name="method-i-duplicate" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-duplicate_source')" id="l_method-i-duplicate_source">show</a>
                

                

                
              </p>
              <div id="method-i-duplicate_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">647</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">duplicate</span>
<span class="line-num">648</span>   <span class="ruby-identifier">new_project</span> = <span class="ruby-identifier">dup</span>
<span class="line-num">649</span>   <span class="ruby-identifier">project_observation_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pof</span><span class="ruby-operator">|</span>
<span class="line-num">650</span>     <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">project_observation_fields</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">position:</span> <span class="ruby-identifier">pof</span>.<span class="ruby-identifier">position</span>,
<span class="line-num">651</span>       <span class="ruby-value">observation_field:</span> <span class="ruby-identifier">pof</span>.<span class="ruby-identifier">observation_field</span>, <span class="ruby-value">required:</span> <span class="ruby-identifier">pof</span>.<span class="ruby-identifier">required</span>)
<span class="line-num">652</span>   <span class="ruby-keyword">end</span>
<span class="line-num">653</span>   <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">por</span><span class="ruby-operator">|</span>
<span class="line-num">654</span>     <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">operand:</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">operand</span>, <span class="ruby-value">operator:</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">operator</span>)
<span class="line-num">655</span>   <span class="ruby-keyword">end</span>
<span class="line-num">656</span>   <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">title</span> = <span class="ruby-node">&quot;#{title} copy&quot;</span>
<span class="line-num">657</span>   <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">custom_project</span> = <span class="ruby-identifier">custom_project</span>.<span class="ruby-identifier">dup</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">custom_project</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">658</span>   <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">save!</span>
<span class="line-num">659</span>   <span class="ruby-identifier">listed_taxa</span>.<span class="ruby-identifier">find_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lt</span><span class="ruby-operator">|</span>
<span class="line-num">660</span>     <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">list:</span> <span class="ruby-identifier">new_project</span>.<span class="ruby-identifier">project_list</span>, <span class="ruby-value">taxon_id:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">taxon_id</span>, <span class="ruby-value">description:</span> <span class="ruby-identifier">lt</span>.<span class="ruby-identifier">description</span>)
<span class="line-num">661</span>   <span class="ruby-keyword">end</span>
<span class="line-num">662</span>   <span class="ruby-identifier">new_project</span>
<span class="line-num">663</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-editable_by-3F">
            
              <b>editable_by?</b>(user)
            
            <a href="../classes/Project.html#method-i-editable_by-3F" name="method-i-editable_by-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-editable_by-3F_source')" id="l_method-i-editable_by-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-editable_by-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">310</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">editable_by?</span>(<span class="ruby-identifier">user</span>)
<span class="line-num">311</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">312</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_admin?</span>
<span class="line-num">313</span>   <span class="ruby-identifier">pu</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
<span class="line-num">314</span>   <span class="ruby-identifier">pu</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pu</span>.<span class="ruby-identifier">is_manager?</span>
<span class="line-num">315</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-end_time-3D">
            
              <b>end_time=</b>(value)
            
            <a href="../classes/Project.html#method-i-end_time-3D" name="method-i-end_time-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-end_time-3D_source')" id="l_method-i-end_time-3D_source">show</a>
                

                

                
              </p>
              <div id="method-i-end_time-3D_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">247</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">end_time=</span>(<span class="ruby-identifier">value</span>)
<span class="line-num">248</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
<span class="line-num">249</span>     <span class="ruby-keyword">super</span>(<span class="ruby-constant">Chronic</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">value</span>))
<span class="line-num">250</span>   <span class="ruby-keyword">else</span>
<span class="line-num">251</span>     <span class="ruby-keyword">super</span>
<span class="line-num">252</span>   <span class="ruby-keyword">end</span>
<span class="line-num">253</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-event_ended-3F">
            
              <b>event_ended?</b>()
            
            <a href="../classes/Project.html#method-i-event_ended-3F" name="method-i-event_ended-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-event_ended-3F_source')" id="l_method-i-event_ended-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-event_ended-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">722</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">event_ended?</span>
<span class="line-num">723</span>   <span class="ruby-identifier">t</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">preferred_rule_d2</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">preferred_rule_d2</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">724</span>   <span class="ruby-identifier">t</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">end_time</span>
<span class="line-num">725</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">726</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefers_range_by_date?</span>
<span class="line-num">727</span>     <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_date</span>
<span class="line-num">728</span>   <span class="ruby-keyword">else</span>
<span class="line-num">729</span>     <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">t</span>
<span class="line-num">730</span>   <span class="ruby-keyword">end</span>
<span class="line-num">731</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-event_in_progress-3F">
            
              <b>event_in_progress?</b>()
            
            <a href="../classes/Project.html#method-i-event_in_progress-3F" name="method-i-event_in_progress-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-event_in_progress-3F_source')" id="l_method-i-event_in_progress-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-event_in_progress-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">733</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">event_in_progress?</span>
<span class="line-num">734</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">preferred_rule_d1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">preferred_rule_d2</span>
<span class="line-num">735</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">736</span>   <span class="ruby-keyword">end</span>
<span class="line-num">737</span>   <span class="ruby-identifier">event_started?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event_ended?</span>
<span class="line-num">738</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-event_started-3F">
            
              <b>event_started?</b>()
            
            <a href="../classes/Project.html#method-i-event_started-3F" name="method-i-event_started-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-event_started-3F_source')" id="l_method-i-event_started-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-event_started-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">711</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">event_started?</span>
<span class="line-num">712</span>   <span class="ruby-identifier">t</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">preferred_rule_d1</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">preferred_rule_d1</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">713</span>   <span class="ruby-identifier">t</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">start_time</span>
<span class="line-num">714</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">715</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefers_range_by_date?</span>
<span class="line-num">716</span>     <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
<span class="line-num">717</span>   <span class="ruby-keyword">else</span>
<span class="line-num">718</span>     <span class="ruby-identifier">t</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
<span class="line-num">719</span>   <span class="ruby-keyword">end</span>
<span class="line-num">720</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-eventbrite_id">
            
              <b>eventbrite_id</b>()
            
            <a href="../classes/Project.html#method-i-eventbrite_id" name="method-i-eventbrite_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-eventbrite_id_source')" id="l_method-i-eventbrite_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-eventbrite_id_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">705</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">eventbrite_id</span>
<span class="line-num">706</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">event_url</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">707</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">event_url</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/eventbrite\.com/</span>
<span class="line-num">708</span>   <span class="ruby-ivar">@eventbrite_id</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">event_url</span>).<span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\d+/</span>).<span class="ruby-identifier">last</span>
<span class="line-num">709</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-find_observed_and_total_for_project">
            
              <b>find_observed_and_total_for_project</b>()
            
            <a href="../classes/Project.html#method-i-find_observed_and_total_for_project" name="method-i-find_observed_and_total_for_project" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-find_observed_and_total_for_project_source')" id="l_method-i-find_observed_and_total_for_project_source">show</a>
                

                

                
              </p>
              <div id="method-i-find_observed_and_total_for_project_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">871</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_observed_and_total_for_project</span>
<span class="line-num">872</span>   <span class="ruby-identifier">unpaginated_listed_taxa</span> = <span class="ruby-constant">ListedTaxon</span>.<span class="ruby-identifier">filter_by_list</span>(<span class="ruby-identifier">project_list</span>.<span class="ruby-identifier">id</span>)
<span class="line-num">873</span>   <span class="ruby-identifier">unpaginated_listed_taxa</span> = <span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">with_taxonomic_status</span>(<span class="ruby-keyword">true</span>)
<span class="line-num">874</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">preferred_count_by</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;species&quot;</span>
<span class="line-num">875</span>     <span class="ruby-identifier">unpaginated_listed_taxa</span> = <span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">with_species</span>
<span class="line-num">876</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">preferred_count_by</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;leaves&quot;</span>
<span class="line-num">877</span>     <span class="ruby-identifier">unpaginated_listed_taxa</span> = <span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">with_leaves</span>(<span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">to_sql</span>)
<span class="line-num">878</span>   <span class="ruby-keyword">end</span>
<span class="line-num">879</span>   {<span class="ruby-value">numerator:</span> <span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">confirmed</span>.<span class="ruby-identifier">count</span>, <span class="ruby-value">denominator:</span> <span class="ruby-identifier">unpaginated_listed_taxa</span>.<span class="ruby-identifier">count</span>}
<span class="line-num">880</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-flagged_with">
            
              <b>flagged_with</b>( flag, options = {} )
            
            <a href="../classes/Project.html#method-i-flagged_with" name="method-i-flagged_with" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-flagged_with_source')" id="l_method-i-flagged_with_source">show</a>
                

                

                
              </p>
              <div id="method-i-flagged_with_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1075</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">flagged_with</span>( <span class="ruby-identifier">flag</span>, <span class="ruby-identifier">options</span> = {} )
<span class="line-num">1076</span>   <span class="ruby-identifier">evaluate_new_flag_for_spam</span>( <span class="ruby-identifier">flag</span> )
<span class="line-num">1077</span>   <span class="ruby-identifier">elastic_index!</span>
<span class="line-num">1078</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-generate_bulk_upload_template">
            
              <b>generate_bulk_upload_template</b>()
            
            <a href="../classes/Project.html#method-i-generate_bulk_upload_template" name="method-i-generate_bulk_upload_template" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-generate_bulk_upload_template_source')" id="l_method-i-generate_bulk_upload_template_source">show</a>
                

                

                
              </p>
              <div id="method-i-generate_bulk_upload_template_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">882</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_bulk_upload_template</span>
<span class="line-num">883</span>   <span class="ruby-identifier">data</span> = {
<span class="line-num">884</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:species_guess</span>)             <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;#Lorem&#39;</span>, <span class="ruby-string">&#39;Ipsum&#39;</span>, <span class="ruby-string">&#39;Dolor&#39;</span>],
<span class="line-num">885</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:observation_date</span>)          <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;2013-01-01&#39;</span>, <span class="ruby-string">&#39;2013-01-01 09:10:11&#39;</span>, <span class="ruby-string">&#39;2013-01-01T14:40:33&#39;</span>],
<span class="line-num">886</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:description</span>)               <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;Description of observation&#39;</span>],
<span class="line-num">887</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:location</span>)                  <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;Wellington City&#39;</span>],
<span class="line-num">888</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:latitude_slash_y_coord_slash_northing</span>)    <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">latitude</span> <span class="ruby-operator">||</span> <span class="ruby-value">-41</span>],
<span class="line-num">889</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:longitude_slash_x_coord_slash_easting</span>)   <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">longitude</span> <span class="ruby-operator">||</span> <span class="ruby-value">174</span>],
<span class="line-num">890</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:tags</span>)                      <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;Comma,Separated&#39;</span>, <span class="ruby-string">&#39;List,Of,Tags&#39;</span>],
<span class="line-num">891</span>     <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:geoprivacy</span>)                <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&quot;[Leave blank for &#39;open&#39;]&quot;</span>, <span class="ruby-string">&#39;Private&#39;</span>, <span class="ruby-string">&#39;Obscured&#39;</span>],
<span class="line-num">892</span>   }
<span class="line-num">893</span> 
<span class="line-num">894</span>   <span class="ruby-constant">ProjectObservationField</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:observation_field</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">project_id:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
<span class="line-num">895</span>     <span class="ruby-identifier">name</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">observation_field</span>.<span class="ruby-identifier">name</span>
<span class="line-num">896</span>     <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;#{name}*&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">required?</span>
<span class="line-num">897</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">observation_field</span>.<span class="ruby-identifier">allowed_values</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">898</span>       <span class="ruby-identifier">data</span>[<span class="ruby-identifier">name</span>] = [<span class="ruby-identifier">field</span>.<span class="ruby-identifier">observation_field</span>.<span class="ruby-identifier">datatype</span>]
<span class="line-num">899</span>     <span class="ruby-keyword">else</span>
<span class="line-num">900</span>       <span class="ruby-identifier">data</span>[<span class="ruby-identifier">name</span>] = [<span class="ruby-node">&quot;One of #{field.observation_field.allowed_values.split(&#39;|&#39;).join(&#39;, &#39;)}&quot;</span>]
<span class="line-num">901</span>     <span class="ruby-keyword">end</span>
<span class="line-num">902</span>   <span class="ruby-keyword">end</span>
<span class="line-num">903</span> 
<span class="line-num">904</span>   <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">generate</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
<span class="line-num">905</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">keys</span>
<span class="line-num">906</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&#39;# A hash mark at the start of a row will mean the entire row is ignored&#39;</span>]
<span class="line-num">907</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">1</span>][<span class="ruby-value">0</span>] }
<span class="line-num">908</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">1</span>][<span class="ruby-value">1</span>] }
<span class="line-num">909</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">1</span>][<span class="ruby-value">2</span>] }
<span class="line-num">910</span>   <span class="ruby-keyword">end</span>
<span class="line-num">911</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-generate_csv">
            
              <b>generate_csv</b>(path, columns, options = {})
            
            <a href="../classes/Project.html#method-i-generate_csv" name="method-i-generate_csv" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-generate_csv_source')" id="l_method-i-generate_csv_source">show</a>
                

                

                
              </p>
              <div id="method-i-generate_csv_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">665</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_csv</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">options</span> = {})
<span class="line-num">666</span>   <span class="ruby-identifier">project_columns</span> = <span class="ruby-node">%w(curator_ident_taxon_id curator_ident_taxon_name curator_ident_user_id curator_ident_user_login tracking_code curator_coordinate_access)</span>
<span class="line-num">667</span>   <span class="ruby-identifier">columns</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">project_columns</span>
<span class="line-num">668</span>   <span class="ruby-identifier">ofv_columns</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observation_fields</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">of</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;field:#{of.normalized_name}&quot;</span>}
<span class="line-num">669</span>   <span class="ruby-identifier">columns</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ofv_columns</span>
<span class="line-num">670</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:viewer</span>]
<span class="line-num">671</span>     <span class="ruby-identifier">options</span>[<span class="ruby-value">:viewer</span>].<span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">load</span>
<span class="line-num">672</span>   <span class="ruby-keyword">end</span>
<span class="line-num">673</span>   <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;w&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
<span class="line-num">674</span>     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">columns</span>
<span class="line-num">675</span>     <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">search_in_batches</span>( <span class="ruby-value">projects:</span> <span class="ruby-identifier">id</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">batch</span><span class="ruby-operator">|</span>
<span class="line-num">676</span>       <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">preload_associations</span>( <span class="ruby-identifier">batch</span>, [<span class="ruby-value">:project_observations</span>] )
<span class="line-num">677</span>       <span class="ruby-identifier">project_observations</span> = <span class="ruby-identifier">batch</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">678</span>         <span class="ruby-identifier">po</span>.<span class="ruby-identifier">project_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">id</span>
<span class="line-num">679</span>       }}.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">compact</span>
<span class="line-num">680</span>       <span class="ruby-constant">ProjectObservation</span>.<span class="ruby-identifier">preload_associations</span>( <span class="ruby-identifier">project_observations</span>, [
<span class="line-num">681</span>         <span class="ruby-value">:stored_preferences</span>,
<span class="line-num">682</span>         <span class="ruby-value">curator_identification:</span> [<span class="ruby-value">:taxon</span>, <span class="ruby-value">:user</span>],
<span class="line-num">683</span>         <span class="ruby-value">observation:</span> [
<span class="line-num">684</span>           {
<span class="line-num">685</span>             <span class="ruby-value">identifications:</span> <span class="ruby-value">:taxon</span>,
<span class="line-num">686</span>             <span class="ruby-value">observation_photos:</span> <span class="ruby-value">:photo</span>,
<span class="line-num">687</span>             <span class="ruby-value">sounds:</span> {},
<span class="line-num">688</span>             <span class="ruby-value">taxon:</span> { <span class="ruby-value">taxon_names:</span> <span class="ruby-value">:place_taxon_names</span> },
<span class="line-num">689</span>             <span class="ruby-value">observation_field_values:</span> <span class="ruby-value">:observation_field</span>,
<span class="line-num">690</span>             <span class="ruby-value">project_observations:</span> <span class="ruby-value">:stored_preferences</span>,
<span class="line-num">691</span>             <span class="ruby-value">user:</span> { <span class="ruby-value">project_users:</span> <span class="ruby-value">:stored_preferences</span> },
<span class="line-num">692</span>           },
<span class="line-num">693</span>           <span class="ruby-value">:quality_metrics</span>
<span class="line-num">694</span>         ]
<span class="line-num">695</span>       ])
<span class="line-num">696</span>       <span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">po</span><span class="ruby-operator">|</span>
<span class="line-num">697</span>         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
<span class="line-num">698</span>           <span class="ruby-identifier">po</span>.<span class="ruby-identifier">to_csv_column</span>( <span class="ruby-identifier">column</span>, <span class="ruby-value">project:</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">viewer:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:viewer</span>] )
<span class="line-num">699</span>         <span class="ruby-keyword">end</span>
<span class="line-num">700</span>       <span class="ruby-keyword">end</span>
<span class="line-num">701</span>     <span class="ruby-keyword">end</span>
<span class="line-num">702</span>   <span class="ruby-keyword">end</span>
<span class="line-num">703</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-icon_url">
            
              <b>icon_url</b>()
            
            <a href="../classes/Project.html#method-i-icon_url" name="method-i-icon_url" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-icon_url_source')" id="l_method-i-icon_url_source">show</a>
                

                

                
              </p>
              <div id="method-i-icon_url_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">339</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">icon_url</span>
<span class="line-num">340</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">icon</span>.<span class="ruby-identifier">file?</span>
<span class="line-num">341</span>   <span class="ruby-identifier">icon</span>.<span class="ruby-identifier">url</span>( <span class="ruby-value">:span2</span> )
<span class="line-num">342</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-invite_only-3F">
            
              <b>invite_only?</b>()
            
            <a href="../classes/Project.html#method-i-invite_only-3F" name="method-i-invite_only-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-invite_only-3F_source')" id="l_method-i-invite_only-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-invite_only-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">918</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">invite_only?</span>
<span class="line-num">919</span>   <span class="ruby-identifier">preferred_membership_model</span> <span class="ruby-operator">==</span> <span class="ruby-constant">MEMBERSHIP_INVITE_ONLY</span>
<span class="line-num">920</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-is_new_project-3F">
            
              <b>is_new_project?</b>()
            
            <a href="../classes/Project.html#method-i-is_new_project-3F" name="method-i-is_new_project-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-is_new_project-3F_source')" id="l_method-i-is_new_project-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-is_new_project-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">255</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_new_project?</span>
<span class="line-num">256</span>   <span class="ruby-identifier">project_type</span> <span class="ruby-operator">===</span> <span class="ruby-string">&quot;umbrella&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">project_type</span> <span class="ruby-operator">===</span> <span class="ruby-string">&quot;collection&quot;</span>
<span class="line-num">257</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-list_observed_and_total">
            
              <b>list_observed_and_total</b>()
            
            <a href="../classes/Project.html#method-i-list_observed_and_total" name="method-i-list_observed_and_total" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-list_observed_and_total_source')" id="l_method-i-list_observed_and_total_source">show</a>
                

                

                
              </p>
              <div id="method-i-list_observed_and_total_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">857</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_observed_and_total</span> <span class="ruby-comment">#denominator and numerator on project/show</span>
<span class="line-num">858</span>   <span class="ruby-identifier">find_observed_and_total_for_project</span>
<span class="line-num">859</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-managers">
            
              <b>managers</b>()
            
            <a href="../classes/Project.html#method-i-managers" name="method-i-managers" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-managers_source')" id="l_method-i-managers_source">show</a>
                

                

                
              </p>
              <div id="method-i-managers_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">639</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">managers</span>
<span class="line-num">640</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">loaded?</span>
<span class="line-num">641</span>     <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pu</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pu</span>.<span class="ruby-identifier">role</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">MANAGER</span> }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:user</span>)
<span class="line-num">642</span>   <span class="ruby-keyword">else</span>
<span class="line-num">643</span>     <span class="ruby-identifier">users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;project_users.role = ?&quot;</span>, <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">MANAGER</span>)
<span class="line-num">644</span>   <span class="ruby-keyword">end</span>
<span class="line-num">645</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-node_api_species_count">
            
              <b>node_api_species_count</b>()
            
            <a href="../classes/Project.html#method-i-node_api_species_count" name="method-i-node_api_species_count" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-node_api_species_count_source')" id="l_method-i-node_api_species_count_source">show</a>
                

                

                
              </p>
              <div id="method-i-node_api_species_count_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1069</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">node_api_species_count</span>
<span class="line-num">1070</span>   <span class="ruby-identifier">response</span> = <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations_species_counts</span>(
<span class="line-num">1071</span>     <span class="ruby-value">project_id:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span>, <span class="ruby-value">ttl:</span> <span class="ruby-value">300</span>)
<span class="line-num">1072</span>   (<span class="ruby-identifier">response</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">total_results</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
<span class="line-num">1073</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-normalize_friendly_id">
            
              <b>normalize_friendly_id</b>( string )
            
            <a href="../classes/Project.html#method-i-normalize_friendly_id" name="method-i-normalize_friendly_id" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-normalize_friendly_id_source')" id="l_method-i-normalize_friendly_id_source">show</a>
                

                

                
              </p>
              <div id="method-i-normalize_friendly_id_source" class="dyn-source">
                <pre>   <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">71</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">normalize_friendly_id</span>( <span class="ruby-identifier">string</span> )
<span class="line-num">72</span>   <span class="ruby-identifier">super_candidate</span> = <span class="ruby-keyword">super</span>( <span class="ruby-identifier">string</span> )
<span class="line-num">73</span>   <span class="ruby-identifier">candidate</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">parameterize</span>
<span class="line-num">74</span>   <span class="ruby-identifier">candidate</span> = <span class="ruby-identifier">super_candidate</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">candidate</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">candidate</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">super_candidate</span>
<span class="line-num">75</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">candidate</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\d+$/</span>
<span class="line-num">76</span>     <span class="ruby-identifier">candidate</span> = <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp">/[^\p{Word}0-9\-_]+/</span>, <span class="ruby-string">&quot;-&quot;</span> ).<span class="ruby-identifier">downcase</span>
<span class="line-num">77</span>   
<span class="line-num">78</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">candidate</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\d+$/</span>
<span class="line-num">79</span>       <span class="ruby-identifier">candidate</span> = [<span class="ruby-string">&quot;project&quot;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">candidate</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>( <span class="ruby-string">&quot;-&quot;</span> )
<span class="line-num">80</span>     <span class="ruby-keyword">end</span>
<span class="line-num">81</span>   <span class="ruby-keyword">end</span>
<span class="line-num">82</span>   <span class="ruby-identifier">candidate</span>
<span class="line-num">83</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-notify_trusting_members_about_changes_if_rules_changed">
            
              <b>notify_trusting_members_about_changes_if_rules_changed</b>()
            
            <a href="../classes/Project.html#method-i-notify_trusting_members_about_changes_if_rules_changed" name="method-i-notify_trusting_members_about_changes_if_rules_changed" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-notify_trusting_members_about_changes_if_rules_changed_source')" id="l_method-i-notify_trusting_members_about_changes_if_rules_changed_source">show</a>
                

                

                
              </p>
              <div id="method-i-notify_trusting_members_about_changes_if_rules_changed_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1129</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">notify_trusting_members_about_changes_if_rules_changed</span>
<span class="line-num">1130</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">prefers_user_trust?</span>
<span class="line-num">1131</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefers_user_trust_changed?</span>
<span class="line-num">1132</span>     <span class="ruby-identifier">notify_trusting_members_about_changes_later</span>
<span class="line-num">1133</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">1134</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1135</span>   <span class="ruby-constant">RULE_PREFERENCES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pref</span><span class="ruby-operator">|</span>
<span class="line-num">1136</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">preference_changes</span>[<span class="ruby-identifier">pref</span>]
<span class="line-num">1137</span>       <span class="ruby-identifier">notify_trusting_members_about_changes_later</span>
<span class="line-num">1138</span>       <span class="ruby-keyword">break</span>
<span class="line-num">1139</span>     <span class="ruby-keyword">end</span>
<span class="line-num">1140</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1141</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-notify_trusting_members_about_changes_later">
            
              <b>notify_trusting_members_about_changes_later</b>()
            
            <a href="../classes/Project.html#method-i-notify_trusting_members_about_changes_later" name="method-i-notify_trusting_members_about_changes_later" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-notify_trusting_members_about_changes_later_source')" id="l_method-i-notify_trusting_members_about_changes_later_source">show</a>
                

                

                
              </p>
              <div id="method-i-notify_trusting_members_about_changes_later_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1119</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">notify_trusting_members_about_changes_later</span>
<span class="line-num">1120</span>   <span class="ruby-identifier">unique_hash</span> = <span class="ruby-identifier">notify_trusting_members_about_changes_unique_hash</span>
<span class="line-num">1121</span>   <span class="ruby-identifier">job</span> = <span class="ruby-constant">Delayed</span><span class="ruby-operator">::</span><span class="ruby-constant">Job</span>.<span class="ruby-identifier">where</span>( <span class="ruby-value">unique_hash:</span> <span class="ruby-identifier">unique_hash</span>.<span class="ruby-identifier">to_s</span> ).<span class="ruby-identifier">first</span>
<span class="line-num">1122</span>   <span class="ruby-identifier">job</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Project</span>.<span class="ruby-identifier">delay</span>(
<span class="line-num">1123</span>     <span class="ruby-value">priority:</span> <span class="ruby-constant">INTEGRITY_PRIORITY</span>,
<span class="line-num">1124</span>     <span class="ruby-value">unique_hash:</span> <span class="ruby-identifier">unique_hash</span>
<span class="line-num">1125</span>   ).<span class="ruby-identifier">notify_trusting_members_about_changes</span>( <span class="ruby-identifier">id</span> )
<span class="line-num">1126</span>   <span class="ruby-identifier">job</span>.<span class="ruby-identifier">update</span>( <span class="ruby-value">run_at:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">hour</span>.<span class="ruby-identifier">from_now</span> )
<span class="line-num">1127</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-notify_trusting_members_about_changes_unique_hash">
            
              <b>notify_trusting_members_about_changes_unique_hash</b>()
            
            <a href="../classes/Project.html#method-i-notify_trusting_members_about_changes_unique_hash" name="method-i-notify_trusting_members_about_changes_unique_hash" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-notify_trusting_members_about_changes_unique_hash_source')" id="l_method-i-notify_trusting_members_about_changes_unique_hash_source">show</a>
                

                

                
              </p>
              <div id="method-i-notify_trusting_members_about_changes_unique_hash_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1115</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">notify_trusting_members_about_changes_unique_hash</span>
<span class="line-num">1116</span>   { <span class="ruby-value">&quot;Project::notify_trusting_members_about_changes&quot;:</span> <span class="ruby-identifier">id</span> }
<span class="line-num">1117</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-observations_url_params">
            
              <b>observations_url_params</b>(options = {})
            
            <a href="../classes/Project.html#method-i-observations_url_params" name="method-i-observations_url_params" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-observations_url_params_source')" id="l_method-i-observations_url_params_source">show</a>
                

                

                
              </p>
              <div id="method-i-observations_url_params_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">424</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">observations_url_params</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">425</span>   <span class="ruby-identifier">params</span> = { }
<span class="line-num">426</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_time</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_time</span>
<span class="line-num">427</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefers_range_by_date?</span>
<span class="line-num">428</span>       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(
<span class="line-num">429</span>         <span class="ruby-value">d1:</span> <span class="ruby-identifier">preferred_start_date_or_time</span>.<span class="ruby-identifier">to_s</span>,
<span class="line-num">430</span>         <span class="ruby-value">d2:</span> <span class="ruby-identifier">preferred_end_date_or_time</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">431</span>       )
<span class="line-num">432</span>     <span class="ruby-keyword">else</span>
<span class="line-num">433</span>       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(
<span class="line-num">434</span>         <span class="ruby-value">d1:</span> <span class="ruby-identifier">preferred_start_date_or_time</span>.<span class="ruby-identifier">iso8601</span>,
<span class="line-num">435</span>         <span class="ruby-value">d2:</span> <span class="ruby-identifier">preferred_end_date_or_time</span>.<span class="ruby-identifier">iso8601</span>
<span class="line-num">436</span>       )
<span class="line-num">437</span>     <span class="ruby-keyword">end</span>
<span class="line-num">438</span>   <span class="ruby-keyword">end</span>
<span class="line-num">439</span>   <span class="ruby-identifier">taxon_ids</span> = []
<span class="line-num">440</span>   <span class="ruby-identifier">place_ids</span> = [ <span class="ruby-identifier">place_id</span> ]
<span class="line-num">441</span>   <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span>
<span class="line-num">442</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operator</span>
<span class="line-num">443</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;in_taxon?&quot;</span>
<span class="line-num">444</span>       <span class="ruby-identifier">taxon_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">445</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span>
<span class="line-num">446</span>       <span class="ruby-identifier">place_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">operand_id</span>
<span class="line-num">447</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;on_list?&quot;</span>
<span class="line-num">448</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:list_id</span>] = <span class="ruby-identifier">project_list</span>.<span class="ruby-identifier">id</span>
<span class="line-num">449</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;identified?&quot;</span>
<span class="line-num">450</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:identified</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">451</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;georeferenced?&quot;</span>
<span class="line-num">452</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">||=</span> []
<span class="line-num">453</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;geo&quot;</span>
<span class="line-num">454</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;has_a_photo?&quot;</span>
<span class="line-num">455</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">||=</span> []
<span class="line-num">456</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;photos&quot;</span>
<span class="line-num">457</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;has_a_sound?&quot;</span>
<span class="line-num">458</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">||=</span> []
<span class="line-num">459</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:has</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;sounds&quot;</span>
<span class="line-num">460</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;captive?&quot;</span>
<span class="line-num">461</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:captive</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">462</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;wild?&quot;</span>
<span class="line-num">463</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:captive</span>] = <span class="ruby-keyword">false</span>
<span class="line-num">464</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;verifiable?&quot;</span>
<span class="line-num">465</span>       <span class="ruby-identifier">params</span>[<span class="ruby-value">:verifiable</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">466</span>     <span class="ruby-keyword">end</span>
<span class="line-num">467</span>   <span class="ruby-keyword">end</span>
<span class="line-num">468</span>   <span class="ruby-identifier">taxon_ids</span> = <span class="ruby-identifier">taxon_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">469</span>   <span class="ruby-identifier">place_ids</span> = <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">470</span>   <span class="ruby-comment"># the new obs search sets some defaults we want to override</span>
<span class="line-num">471</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:verifiable</span>] = <span class="ruby-string">&quot;any&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:verifiable</span>]
<span class="line-num">472</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:place_id</span>] = <span class="ruby-string">&quot;any&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">473</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:extended</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">taxon_ids</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">50</span>
<span class="line-num">474</span>     <span class="ruby-identifier">params</span> = { <span class="ruby-value">apply_project_rules_for:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> }
<span class="line-num">475</span>   <span class="ruby-keyword">else</span>
<span class="line-num">476</span>     <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">taxon_ids:</span> <span class="ruby-identifier">taxon_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">taxon_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">477</span>     <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_ids</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">place_ids</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">478</span>   <span class="ruby-keyword">end</span>
<span class="line-num">479</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:concat_ids</span>]
<span class="line-num">480</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:taxon_ids</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:taxon_ids</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:taxon_ids</span>].<span class="ruby-identifier">try</span>(<span class="ruby-value">:class</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
<span class="line-num">481</span>     <span class="ruby-identifier">params</span>[<span class="ruby-value">:place_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:place_id</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:place_id</span>].<span class="ruby-identifier">try</span>(<span class="ruby-value">:class</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
<span class="line-num">482</span>   <span class="ruby-keyword">end</span>
<span class="line-num">483</span>   <span class="ruby-identifier">params</span>
<span class="line-num">484</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-one_year_time_span">
            
              <b>one_year_time_span</b>()
            
            <a href="../classes/Project.html#method-i-one_year_time_span" name="method-i-one_year_time_span" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-one_year_time_span_source')" id="l_method-i-one_year_time_span_source">show</a>
                

                

                
              </p>
              <div id="method-i-one_year_time_span_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">229</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">one_year_time_span</span>
<span class="line-num">230</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_time</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_time</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">366</span>.<span class="ruby-identifier">days</span>
<span class="line-num">231</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:end_time</span>, <span class="ruby-string">&quot;must be less than one year after the start time&quot;</span>)
<span class="line-num">232</span>   <span class="ruby-keyword">end</span>
<span class="line-num">233</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-place_with_boundary">
            
              <b>place_with_boundary</b>()
            
            <a href="../classes/Project.html#method-i-place_with_boundary" name="method-i-place_with_boundary" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-place_with_boundary_source')" id="l_method-i-place_with_boundary_source">show</a>
                

                

                
              </p>
              <div id="method-i-place_with_boundary_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">222</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">place_with_boundary</span>
<span class="line-num">223</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">place_id</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">224</span>   <span class="ruby-keyword">unless</span> <span class="ruby-constant">PlaceGeometry</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">place_id:</span> <span class="ruby-identifier">place_id</span>).<span class="ruby-identifier">exists?</span>
<span class="line-num">225</span>     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:place_id</span>, <span class="ruby-string">&quot;must be set and have a boundary for a bioblitz&quot;</span>)
<span class="line-num">226</span>   <span class="ruby-keyword">end</span>
<span class="line-num">227</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-posts_count">
            
              <b>posts_count</b>()
            
            <a href="../classes/Project.html#method-i-posts_count" name="method-i-posts_count" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-posts_count_source')" id="l_method-i-posts_count_source">show</a>
                

                

                
              </p>
              <div id="method-i-posts_count_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">356</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">posts_count</span>
<span class="line-num">357</span>   <span class="ruby-identifier">posts</span>.<span class="ruby-identifier">count</span>
<span class="line-num">358</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-preferred_end_date_or_time">
            
              <b>preferred_end_date_or_time</b>()
            
            <a href="../classes/Project.html#method-i-preferred_end_date_or_time" name="method-i-preferred_end_date_or_time" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-preferred_end_date_or_time_source')" id="l_method-i-preferred_end_date_or_time_source">show</a>
                

                

                
              </p>
              <div id="method-i-preferred_end_date_or_time_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">265</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">preferred_end_date_or_time</span>
<span class="line-num">266</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">end_time</span>
<span class="line-num">267</span>   <span class="ruby-identifier">time</span> = <span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">in_time_zone</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">time_zone</span>)
<span class="line-num">268</span>   <span class="ruby-identifier">prefers_range_by_date?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">time</span>.<span class="ruby-identifier">iso8601</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;T&#39;</span>).<span class="ruby-identifier">first</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">time</span>
<span class="line-num">269</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-preferred_start_date_or_time">
            
              <b>preferred_start_date_or_time</b>()
            
            <a href="../classes/Project.html#method-i-preferred_start_date_or_time" name="method-i-preferred_start_date_or_time" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-preferred_start_date_or_time_source')" id="l_method-i-preferred_start_date_or_time_source">show</a>
                

                

                
              </p>
              <div id="method-i-preferred_start_date_or_time_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">259</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">preferred_start_date_or_time</span>
<span class="line-num">260</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">start_time</span>
<span class="line-num">261</span>   <span class="ruby-identifier">time</span> = <span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">in_time_zone</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">time_zone</span>)
<span class="line-num">262</span>   <span class="ruby-identifier">prefers_range_by_date?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">time</span>.<span class="ruby-identifier">iso8601</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;T&#39;</span>).<span class="ruby-identifier">first</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">time</span>
<span class="line-num">263</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-project_observation_rule_terms">
            
              <b>project_observation_rule_terms</b>()
            
            <a href="../classes/Project.html#method-i-project_observation_rule_terms" name="method-i-project_observation_rule_terms" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-project_observation_rule_terms_source')" id="l_method-i-project_observation_rule_terms_source">show</a>
                

                

                
              </p>
              <div id="method-i-project_observation_rule_terms_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">344</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">project_observation_rule_terms</span>
<span class="line-num">345</span>   <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">por</span><span class="ruby-operator">|</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">terms</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;|&#39;</span>)
<span class="line-num">346</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-project_observations_count">
            
              <b>project_observations_count</b>()
            
            <a href="../classes/Project.html#method-i-project_observations_count" name="method-i-project_observations_count" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-project_observations_count_source')" id="l_method-i-project_observations_count_source">show</a>
                

                

                
              </p>
              <div id="method-i-project_observations_count_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">348</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">project_observations_count</span>
<span class="line-num">349</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">350</span>     <span class="ruby-constant">INatAPIService</span>.<span class="ruby-identifier">observations</span>( <span class="ruby-identifier">collection_search_parameters</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-value">per_page:</span> <span class="ruby-value">0</span> ) ).<span class="ruby-identifier">try</span>(<span class="ruby-value">:total_results</span>)
<span class="line-num">351</span>   <span class="ruby-keyword">else</span>
<span class="line-num">352</span>     <span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">count</span>
<span class="line-num">353</span>   <span class="ruby-keyword">end</span>
<span class="line-num">354</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-remove_times_from_non_bioblitzes">
            
              <b>remove_times_from_non_bioblitzes</b>()
            
            <a href="../classes/Project.html#method-i-remove_times_from_non_bioblitzes" name="method-i-remove_times_from_non_bioblitzes" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-remove_times_from_non_bioblitzes_source')" id="l_method-i-remove_times_from_non_bioblitzes_source">show</a>
                

                

                
              </p>
              <div id="method-i-remove_times_from_non_bioblitzes_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">366</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_times_from_non_bioblitzes</span>
<span class="line-num">367</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">bioblitz?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">is_new_project?</span>
<span class="line-num">368</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">start_time</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">369</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">end_time</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">370</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-reset_last_aggregated_at">
            
              <b>reset_last_aggregated_at</b>()
            
            <a href="../classes/Project.html#method-i-reset_last_aggregated_at" name="method-i-reset_last_aggregated_at" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-reset_last_aggregated_at_source')" id="l_method-i-reset_last_aggregated_at_source">show</a>
                

                

                
              </p>
              <div id="method-i-reset_last_aggregated_at_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">360</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset_last_aggregated_at</span>
<span class="line-num">361</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">will_save_change_to_start_time?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">will_save_change_to_end_time?</span>
<span class="line-num">362</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_aggregated_at</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">363</span>   <span class="ruby-keyword">end</span>
<span class="line-num">364</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rule_place">
            
              <b>rule_place</b>()
            
            <a href="../classes/Project.html#method-i-rule_place" name="method-i-rule_place" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-rule_place_source')" id="l_method-i-rule_place_source">show</a>
                

                

                
              </p>
              <div id="method-i-rule_place_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">323</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rule_place</span>
<span class="line-num">324</span>   <span class="ruby-ivar">@rule_place</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">rule_places</span>.<span class="ruby-identifier">first</span>
<span class="line-num">325</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rule_place_ids">
            
              <b>rule_place_ids</b>()
            
            <a href="../classes/Project.html#method-i-rule_place_ids" name="method-i-rule_place_ids" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-rule_place_ids_source')" id="l_method-i-rule_place_ids_source">show</a>
                

                

                
              </p>
              <div id="method-i-rule_place_ids_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">408</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rule_place_ids</span>
<span class="line-num">409</span>   <span class="ruby-identifier">rule_place_ids</span> = <span class="ruby-identifier">rule_places</span>.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:id</span> )
<span class="line-num">410</span>   [ <span class="ruby-identifier">place_id</span>, <span class="ruby-identifier">rule_place_ids</span> ].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
<span class="line-num">411</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rule_places">
            
              <b>rule_places</b>()
            
            <a href="../classes/Project.html#method-i-rule_places" name="method-i-rule_places" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-rule_places_source')" id="l_method-i-rule_places_source">show</a>
                

                

                
              </p>
              <div id="method-i-rule_places_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">327</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rule_places</span>
<span class="line-num">328</span>   <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">por</span><span class="ruby-operator">|</span> <span class="ruby-identifier">por</span>.<span class="ruby-identifier">operator</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;observed_in_place?&quot;</span> }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:operand</span>).<span class="ruby-identifier">compact</span>
<span class="line-num">329</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rule_taxa">
            
              <b>rule_taxa</b>()
            
            <a href="../classes/Project.html#method-i-rule_taxa" name="method-i-rule_taxa" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-rule_taxa_source')" id="l_method-i-rule_taxa_source">show</a>
                

                

                
              </p>
              <div id="method-i-rule_taxa_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">335</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rule_taxa</span>
<span class="line-num">336</span>   <span class="ruby-ivar">@rule_taxa</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">project_observation_rules</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">operator:</span> <span class="ruby-string">&quot;in_taxon?&quot;</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:operand</span>).<span class="ruby-identifier">compact</span>
<span class="line-num">337</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rule_taxon">
            
              <b>rule_taxon</b>()
            
            <a href="../classes/Project.html#method-i-rule_taxon" name="method-i-rule_taxon" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-rule_taxon_source')" id="l_method-i-rule_taxon_source">show</a>
                

                

                
              </p>
              <div id="method-i-rule_taxon_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">331</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rule_taxon</span>
<span class="line-num">332</span>   <span class="ruby-ivar">@rule_taxon</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">rule_taxa</span>.<span class="ruby-identifier">first</span>
<span class="line-num">333</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-sane_destroy">
            
              <b>sane_destroy</b>()
            
            <a href="../classes/Project.html#method-i-sane_destroy" name="method-i-sane_destroy" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-sane_destroy_source')" id="l_method-i-sane_destroy_source">show</a>
                

                

                
              </p>
              <div id="method-i-sane_destroy_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1063</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sane_destroy</span>
<span class="line-num">1064</span>   <span class="ruby-identifier">project_observations</span>.<span class="ruby-identifier">delete_all</span>
<span class="line-num">1065</span>   <span class="ruby-identifier">posts</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;id, parent_type, parent_id, user_id&quot;</span>).<span class="ruby-identifier">find_each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:destroy</span>)
<span class="line-num">1066</span>   <span class="ruby-identifier">destroy</span>
<span class="line-num">1067</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_observation_requirements_updated_at">
            
              <b>set_observation_requirements_updated_at</b>( options = {} )
            
            <a href="../classes/Project.html#method-i-set_observation_requirements_updated_at" name="method-i-set_observation_requirements_updated_at" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_observation_requirements_updated_at_source')" id="l_method-i-set_observation_requirements_updated_at_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_observation_requirements_updated_at_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">372</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_observation_requirements_updated_at</span>( <span class="ruby-identifier">options</span> = {} )
<span class="line-num">373</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_record?</span>
<span class="line-num">374</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observation_requirements_updated_at</span> = <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_WAIT_PERIOD</span>.<span class="ruby-identifier">ago</span>
<span class="line-num">375</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">376</span>   <span class="ruby-keyword">end</span>
<span class="line-num">377</span>   <span class="ruby-identifier">old_params</span> = <span class="ruby-constant">Project</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">collection_search_parameters</span>
<span class="line-num">378</span>   <span class="ruby-identifier">new_params</span> = <span class="ruby-identifier">collection_search_parameters</span>
<span class="line-num">379</span>   <span class="ruby-identifier">pu_scope</span> = <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:stored_preferences</span>).<span class="ruby-identifier">where</span>(
<span class="line-num">380</span>     <span class="ruby-string">&quot;preferences.name = &#39;curator_coordinate_access_for&#39; AND preferences.value IN (?)&quot;</span>,
<span class="line-num">381</span>     [
<span class="line-num">382</span>       <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_FOR_TAXON</span>,
<span class="line-num">383</span>       <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_FOR_ANY</span>
<span class="line-num">384</span>     ]
<span class="line-num">385</span>   )
<span class="line-num">386</span>   <span class="ruby-identifier">changed_from_trad_to_collection</span> = <span class="ruby-identifier">project_type_changed?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">387</span>     <span class="ruby-identifier">changes</span>[<span class="ruby-value">:project_type</span>].<span class="ruby-identifier">first</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">388</span>     <span class="ruby-node">%w(collection umbrella)</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">changes</span>[<span class="ruby-value">:project_type</span>].<span class="ruby-identifier">last</span> )
<span class="line-num">389</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_params</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">new_params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">prefers_user_trust_changed?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:force</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">changed_from_trad_to_collection</span>
<span class="line-num">390</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;set_observation_requirements_updated_at: no change&quot;</span>
<span class="line-num">391</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">pu_scope</span>.<span class="ruby-identifier">exists?</span>
<span class="line-num">392</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;set_observation_requirements_updated_at: trusting users exist, setting observation_requirements_updated_at to now&quot;</span>
<span class="line-num">393</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observation_requirements_updated_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
<span class="line-num">394</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">changed_from_trad_to_collection</span>
<span class="line-num">395</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;set_observation_requirements_updated_at: trad proj changing to a new-style project and there are no trusting users, backdating observation_requirements_updated_at&quot;</span>
<span class="line-num">396</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observation_requirements_updated_at</span> = <span class="ruby-constant">ProjectUser</span><span class="ruby-operator">::</span><span class="ruby-constant">CURATOR_COORDINATE_ACCESS_WAIT_PERIOD</span>.<span class="ruby-identifier">ago</span>
<span class="line-num">397</span>   <span class="ruby-keyword">else</span>
<span class="line-num">398</span>     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;set_observation_requirements_updated_at: requirements changed but no trusting users, no change&quot;</span>
<span class="line-num">399</span>   <span class="ruby-keyword">end</span>
<span class="line-num">400</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_updated_at_if_preferences_changed">
            
              <b>set_updated_at_if_preferences_changed</b>()
            
            <a href="../classes/Project.html#method-i-set_updated_at_if_preferences_changed" name="method-i-set_updated_at_if_preferences_changed" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-set_updated_at_if_preferences_changed_source')" id="l_method-i-set_updated_at_if_preferences_changed_source">show</a>
                

                

                
              </p>
              <div id="method-i-set_updated_at_if_preferences_changed_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">304</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_updated_at_if_preferences_changed</span>
<span class="line-num">305</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">preferences</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;prefers_#{p}_changed?&quot;</span>) }
<span class="line-num">306</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updated_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
<span class="line-num">307</span>   <span class="ruby-keyword">end</span>
<span class="line-num">308</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-should_generate_new_friendly_id-3F">
            
              <b>should_generate_new_friendly_id?</b>()
            
            <a href="../classes/Project.html#method-i-should_generate_new_friendly_id-3F" name="method-i-should_generate_new_friendly_id-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-should_generate_new_friendly_id-3F_source')" id="l_method-i-should_generate_new_friendly_id-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-should_generate_new_friendly_id-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">624</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">should_generate_new_friendly_id?</span>
<span class="line-num">625</span>   <span class="ruby-identifier">will_save_change_to_title?</span>
<span class="line-num">626</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-slug_candidates">
            
              <b>slug_candidates</b>()
            
            <a href="../classes/Project.html#method-i-slug_candidates" name="method-i-slug_candidates" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-slug_candidates_source')" id="l_method-i-slug_candidates_source">show</a>
                

                

                
              </p>
              <div id="method-i-slug_candidates_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">628</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">slug_candidates</span>
<span class="line-num">629</span>   [
<span class="line-num">630</span>     <span class="ruby-value">:title</span>,
<span class="line-num">631</span>     [<span class="ruby-value">:title</span>, <span class="ruby-value">:id</span>]
<span class="line-num">632</span>   ]
<span class="line-num">633</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-split_large_array">
            
              <b>split_large_array</b>(list)
            
            <a href="../classes/Project.html#method-i-split_large_array" name="method-i-split_large_array" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-split_large_array_source')" id="l_method-i-split_large_array_source">show</a>
                

                

                
              </p>
              <div id="method-i-split_large_array_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">913</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">split_large_array</span>(<span class="ruby-identifier">list</span>)
<span class="line-num">914</span>   <span class="ruby-identifier">list_count</span> = (<span class="ruby-identifier">list</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">/</span> <span class="ruby-value">3.0</span>).<span class="ruby-identifier">ceil</span>
<span class="line-num">915</span>   <span class="ruby-identifier">list</span>.<span class="ruby-identifier">in_groups_of</span>(<span class="ruby-identifier">list_count</span>)
<span class="line-num">916</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-start_time-3D">
            
              <b>start_time=</b>(value)
            
            <a href="../classes/Project.html#method-i-start_time-3D" name="method-i-start_time-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-start_time-3D_source')" id="l_method-i-start_time-3D_source">show</a>
                

                

                
              </p>
              <div id="method-i-start_time-3D_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">239</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">start_time=</span>(<span class="ruby-identifier">value</span>)
<span class="line-num">240</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
<span class="line-num">241</span>     <span class="ruby-keyword">super</span>(<span class="ruby-constant">Chronic</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">value</span>))
<span class="line-num">242</span>   <span class="ruby-keyword">else</span>
<span class="line-num">243</span>     <span class="ruby-keyword">super</span>
<span class="line-num">244</span>   <span class="ruby-keyword">end</span>
<span class="line-num">245</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-strip_title">
            
              <b>strip_title</b>()
            
            <a href="../classes/Project.html#method-i-strip_title" name="method-i-strip_title" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-strip_title_source')" id="l_method-i-strip_title_source">show</a>
                

                

                
              </p>
              <div id="method-i-strip_title_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">271</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">strip_title</span>
<span class="line-num">272</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>
<span class="line-num">273</span>   <span class="ruby-keyword">true</span>
<span class="line-num">274</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_s">
            
              <b>to_s</b>()
            
            <a href="../classes/Project.html#method-i-to_s" name="method-i-to_s" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-to_s_source')" id="l_method-i-to_s_source">show</a>
                

                

                
              </p>
              <div id="method-i-to_s_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">235</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_s</span>
<span class="line-num">236</span>   <span class="ruby-node">&quot;&lt;Project #{id} #{title}&gt;&quot;</span>
<span class="line-num">237</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-tracking_code_allowed-3F">
            
              <b>tracking_code_allowed?</b>(code)
            
            <a href="../classes/Project.html#method-i-tracking_code_allowed-3F" name="method-i-tracking_code_allowed-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-tracking_code_allowed-3F_source')" id="l_method-i-tracking_code_allowed-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-tracking_code_allowed-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">402</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tracking_code_allowed?</span>(<span class="ruby-identifier">code</span>)
<span class="line-num">403</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">404</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tracking_codes</span>.<span class="ruby-identifier">blank?</span>
<span class="line-num">405</span>   <span class="ruby-identifier">tracking_codes</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">strip</span>}.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">code</span>)
<span class="line-num">406</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_counts">
            
              <b>update_counts</b>()
            
            <a href="../classes/Project.html#method-i-update_counts" name="method-i-update_counts" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_counts_source')" id="l_method-i-update_counts_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_counts_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">941</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_counts</span>
<span class="line-num">942</span>   <span class="ruby-identifier">update_users_observations_counts</span>
<span class="line-num">943</span>   <span class="ruby-identifier">update_users_taxa_counts</span>
<span class="line-num">944</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_users_observations_counts">
            
              <b>update_users_observations_counts</b>(options = {})
            
            <a href="../classes/Project.html#method-i-update_users_observations_counts" name="method-i-update_users_observations_counts" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_users_observations_counts_source')" id="l_method-i-update_users_observations_counts_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_users_observations_counts_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">946</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_users_observations_counts</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num">947</span>   <span class="ruby-constant">Project</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
<span class="line-num">948</span>     <span class="ruby-identifier">user_ids</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-operator">?</span> [ <span class="ruby-identifier">options</span>[<span class="ruby-value">:user_id</span>] ] <span class="ruby-operator">:</span>
<span class="line-num">949</span>       <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:user_id</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>
<span class="line-num">950</span>     <span class="ruby-identifier">user_ids</span>.<span class="ruby-identifier">in_groups_of</span>(<span class="ruby-value">500</span>, <span class="ruby-keyword">false</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uids</span><span class="ruby-operator">|</span>
<span class="line-num">951</span>       <span class="ruby-comment"># matching the node.js iNaturalistAPI filters/aggregations for obs counts</span>
<span class="line-num">952</span>       <span class="ruby-identifier">result</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_search</span>(
<span class="line-num">953</span>         <span class="ruby-value">filters:</span> [
<span class="line-num">954</span>           { <span class="ruby-value">term:</span> { <span class="ruby-value">&quot;project_ids.keyword&quot;:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> } },
<span class="line-num">955</span>           { <span class="ruby-value">terms:</span> { <span class="ruby-value">&quot;user.id.keyword&quot;:</span> <span class="ruby-identifier">uids</span> } }
<span class="line-num">956</span>         ],
<span class="line-num">957</span>         <span class="ruby-value">size:</span> <span class="ruby-value">0</span>,
<span class="line-num">958</span>         <span class="ruby-value">aggregate:</span> {
<span class="line-num">959</span>           <span class="ruby-value">top_observers:</span> { <span class="ruby-value">terms:</span> { <span class="ruby-value">field:</span> <span class="ruby-string">&quot;user.id&quot;</span>, <span class="ruby-value">size:</span> <span class="ruby-value">100000</span> } } }
<span class="line-num">960</span>       )
<span class="line-num">961</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>
<span class="line-num">962</span>         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>.<span class="ruby-identifier">top_observers</span>.<span class="ruby-identifier">buckets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
<span class="line-num">963</span>           <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>, <span class="ruby-value">user_id:</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">:key</span>]).
<span class="line-num">964</span>             <span class="ruby-identifier">update_all</span>(<span class="ruby-value">observations_count:</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">doc_count</span>)
<span class="line-num">965</span>         <span class="ruby-keyword">end</span>
<span class="line-num">966</span>       <span class="ruby-keyword">end</span>
<span class="line-num">967</span>     <span class="ruby-keyword">end</span>
<span class="line-num">968</span>   <span class="ruby-keyword">end</span>
<span class="line-num">969</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-update_users_taxa_counts">
            
              <b>update_users_taxa_counts</b>(options = {})
            
            <a href="../classes/Project.html#method-i-update_users_taxa_counts" name="method-i-update_users_taxa_counts" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-update_users_taxa_counts_source')" id="l_method-i-update_users_taxa_counts_source">show</a>
                

                

                
              </p>
              <div id="method-i-update_users_taxa_counts_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num"> 971</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_users_taxa_counts</span>(<span class="ruby-identifier">options</span> = {})
<span class="line-num"> 972</span>   <span class="ruby-constant">Project</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
<span class="line-num"> 973</span>     <span class="ruby-comment"># set all counts to zero</span>
<span class="line-num"> 974</span>     <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value">taxa_count:</span> <span class="ruby-value">0</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:user_id</span>]
<span class="line-num"> 975</span>     <span class="ruby-identifier">user_ids</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-operator">?</span> [ <span class="ruby-identifier">options</span>[<span class="ruby-value">:user_id</span>] ] <span class="ruby-operator">:</span>
<span class="line-num"> 976</span>       <span class="ruby-identifier">project_users</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:user_id</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>
<span class="line-num"> 977</span>     <span class="ruby-identifier">user_ids</span>.<span class="ruby-identifier">in_groups_of</span>(<span class="ruby-value">500</span>, <span class="ruby-keyword">false</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uids</span><span class="ruby-operator">|</span>
<span class="line-num"> 978</span>       <span class="ruby-comment"># matching the node.js iNaturalistAPI filters/aggregations for species counts</span>
<span class="line-num"> 979</span>       <span class="ruby-identifier">filters</span> = [
<span class="line-num"> 980</span>         { <span class="ruby-value">term:</span> { <span class="ruby-value">&quot;project_ids.keyword&quot;:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> } },
<span class="line-num"> 981</span>         { <span class="ruby-value">range:</span> { <span class="ruby-value">&quot;taxon.rank_level&quot;:</span> { <span class="ruby-value">lte:</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">SPECIES_LEVEL</span> } } },
<span class="line-num"> 982</span>         { <span class="ruby-value">range:</span> { <span class="ruby-value">&quot;taxon.rank_level&quot;:</span> { <span class="ruby-value">gte:</span> <span class="ruby-constant">Taxon</span><span class="ruby-operator">::</span><span class="ruby-constant">SUBSPECIES_LEVEL</span> } } },
<span class="line-num"> 983</span>         { <span class="ruby-value">terms:</span> { <span class="ruby-value">&quot;user.id.keyword&quot;:</span> <span class="ruby-identifier">uids</span> } }
<span class="line-num"> 984</span>       ]
<span class="line-num"> 985</span>       <span class="ruby-identifier">result</span> = <span class="ruby-constant">Observation</span>.<span class="ruby-identifier">elastic_search</span>(
<span class="line-num"> 986</span>         <span class="ruby-value">filters:</span> <span class="ruby-identifier">filters</span>,
<span class="line-num"> 987</span>         <span class="ruby-value">size:</span> <span class="ruby-value">0</span>,
<span class="line-num"> 988</span>         <span class="ruby-value">aggregate:</span> {
<span class="line-num"> 989</span>           <span class="ruby-value">user_taxa:</span> {
<span class="line-num"> 990</span>             <span class="ruby-value">terms:</span> { <span class="ruby-value">field:</span> <span class="ruby-string">&quot;user.id&quot;</span>, <span class="ruby-value">size:</span> <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">length</span>, <span class="ruby-value">order:</span> { <span class="ruby-value">distinct_taxa:</span> <span class="ruby-string">&quot;desc&quot;</span> } },
<span class="line-num"> 991</span>             <span class="ruby-value">aggs:</span> {
<span class="line-num"> 992</span>               <span class="ruby-value">distinct_taxa:</span> {
<span class="line-num"> 993</span>                 <span class="ruby-value">cardinality:</span> {
<span class="line-num"> 994</span>                   <span class="ruby-value">field:</span> <span class="ruby-string">&quot;taxon.min_species_ancestry&quot;</span>, <span class="ruby-value">precision_threshold:</span> <span class="ruby-value">10000</span> } } } } }
<span class="line-num"> 995</span>       )
<span class="line-num"> 996</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>
<span class="line-num"> 997</span>         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">aggregations</span>.<span class="ruby-identifier">user_taxa</span>.<span class="ruby-identifier">buckets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
<span class="line-num"> 998</span>           <span class="ruby-constant">ProjectUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">project_id:</span> <span class="ruby-identifier">id</span>, <span class="ruby-value">user_id:</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">:key</span>]).
<span class="line-num"> 999</span>             <span class="ruby-identifier">update_all</span>(<span class="ruby-value">taxa_count:</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">distinct_taxa</span>.<span class="ruby-identifier">value</span>)
<span class="line-num">1000</span>         <span class="ruby-keyword">end</span>
<span class="line-num">1001</span>       <span class="ruby-keyword">end</span>
<span class="line-num">1002</span>     <span class="ruby-keyword">end</span>
<span class="line-num">1003</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1004</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-users_can_add-3F">
            
              <b>users_can_add?</b>()
            
            <a href="../classes/Project.html#method-i-users_can_add-3F" name="method-i-users_can_add-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-users_can_add-3F_source')" id="l_method-i-users_can_add-3F_source">show</a>
                

                

                
              </p>
              <div id="method-i-users_can_add-3F_source" class="dyn-source">
                <pre>    <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">922</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">users_can_add?</span>
<span class="line-num">923</span>   <span class="ruby-identifier">preferred_submission_model</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SUBMISSION_BY_ANYONE</span>
<span class="line-num">924</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-within_umbrella_ids">
            
              <b>within_umbrella_ids</b>()
            
            <a href="../classes/Project.html#method-i-within_umbrella_ids" name="method-i-within_umbrella_ids" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-within_umbrella_ids_source')" id="l_method-i-within_umbrella_ids_source">show</a>
                

                

                
              </p>
              <div id="method-i-within_umbrella_ids_source" class="dyn-source">
                <pre>     <span class="ruby-comment"># File app/models/project.rb</span>
<span class="line-num">1111</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">within_umbrella_ids</span>
<span class="line-num">1112</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">project_observation_rules_as_operand</span>.<span class="ruby-identifier">map</span>( <span class="ruby-operator">&amp;</span><span class="ruby-value">:ruler_id</span> )
<span class="line-num">1113</span> <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
